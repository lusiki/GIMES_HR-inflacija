---
title: "Analiza medijske pokrivenosti sigurnosti i stabilnosti u Hrvatskoj"
subtitle: "Semantička analiza, konstrukcija indeksa i vremenske dinamike"
author: "GIMES Research"
date: today
format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    theme: cosmo
    code-fold: true
    code-summary: "Prikaži kod"
    fig-width: 11
    fig-height: 7
    df-print: paged
    embed-resources: true
execute:
  warning: false
  message: false
  echo: false
lang: hr
---

```{r setup}
#| label: setup
#| include: false

# Core data manipulation
library(data.table)
library(lubridate)
library(stringi)

# Visualization
library(ggplot2)
library(scales)
library(plotly)
library(corrplot)
library(patchwork)

# Tables and output
library(knitr)
library(kableExtra)
library(openxlsx)

# Time series
library(zoo)
library(forecast)

# Project management
library(here)

colors_gimes <- c(
  "primary"   = "#2C3E50",
  "secondary" = "#E74C3C",
  "accent"    = "#3498DB",
  "success"   = "#27AE60",
  "warning"   = "#F39C12",
  "danger"    = "#C0392B",
  "light"     = "#ECF0F1",
  "purple"    = "#9B59B6",
  "teal"      = "#1ABC9C",
  "muted"     = "#7F8C8D"
)

# Topic specific colors
colors_gimes["crime"] <- "#E74C3C"
colors_gimes["disaster"] <- "#F39C12"
colors_gimes["emergency"] <- "#1ABC9C"

options(scipen = 999)

theme_gimes <- function() {
  theme_minimal(base_size = 12) +
    theme(
      plot.title = element_text(face = "bold", size = 14, color = colors_gimes["primary"]),
      plot.subtitle = element_text(size = 10, color = "gray40"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      axis.text = element_text(size = 9),
      strip.text = element_text(face = "bold", size = 10)
    )
}

theme_set(theme_gimes())
```

# Uvod

U ovom izvještaju se predstavlja sveobuhvatna analiza medijske pokrivenosti sigurnosti i stabilnosti u Hrvatskoj. Analizom se obuhvaća praćenje kriminaliteta, prometnih nesreća, požara, prirodnih katastrofa, rada hitnih službi i institucionalnog odgovora na sigurnosne prijetnje temeljem članaka iz hrvatskih online medija.

## Motivacija i kontekst

Sigurnost i stabilnost predstavljaju temeljne preduvjete za funkcioniranje društva i gospodarstva. Ovim izvještajem se nastoji odgovoriti na ključna pitanja:

1. Kako se medijsko izvještavanje o sigurnosnim temama razvijalo kroz vrijeme?
2. Koje su kategorije sigurnosnih prijetnji najzastupljenije u hrvatskim medijima?
3. Postoje li sezonski obrasci u izvještavanju o određenim vrstama incidenata?
4. Kako se različiti aspekti sigurnosti međusobno odnose?

## Struktura izvještaja

U izvještaju se obrađuju sljedeće teme: metodologija identifikacije relevantnih članaka, eksploratorni pregled dataseta, semantička taksonomija sigurnosnih pojmova, konstrukcija specijaliziranih indeksa, vizualizacija indeksa, sektorska analiza, volatilnost i momentum te koncentracija tema.

```{r load-data}
#| label: load-data

#dt <- as.data.table(read.xlsx(here("data", "security_filtered.xlsx")))
dt <- as.data.table(read.xlsx("C:/Users/lsikic/Desktop/security_filtered.xlsx"))

# Date conversion
if (is.numeric(dt$DATE)) {
  dt[, DATE := as.Date(DATE, origin = "1899-12-30")]
} else {
  dt[, DATE := as.Date(DATE)]
}

# Numeric conversions
if ("text_length" %in% names(dt)) dt[, text_length := as.numeric(text_length)]
if ("REACH" %in% names(dt)) dt[, REACH := as.numeric(REACH)]
if ("INTERACTIONS" %in% names(dt)) dt[, INTERACTIONS := as.numeric(INTERACTIONS)]

# Time variables (include both weekly and quarterly)
dt[, `:=`(
  date = DATE,
  year = year(DATE),
  month = month(DATE),
  week = isoweek(DATE),
  quarter = quarter(DATE),
  yearmonth = floor_date(DATE, "month"),
  yearweek = floor_date(DATE, "week"),
  yearquarter = floor_date(DATE, "quarter")
)]

# Store date range
date_min <- min(dt$date, na.rm = TRUE)
date_max <- max(dt$date, na.rm = TRUE)

cat("Učitano", format(nrow(dt), big.mark = ","), "članaka\n")
cat("Vremenski raspon:", format(date_min, "%d.%m.%Y"), "do", format(date_max, "%d.%m.%Y"), "\n")
```

# Metodologija identifikacije članaka

## Pregled procesa filtriranja

Identifikacija relevantnih članaka se provodi kroz sedmostupanjski proces filtriranja koji kombinira strukturne kriterije, ključne riječi i kontekstualnu validaciju. Proces osigurava da u analizu ulaze samo članci koji su stvarno relevantni za tematiku sigurnosti i stabilnosti u hrvatskom kontekstu.

::: {.callout-note collapse="true" title="Detaljna metodologija filtriranja"}

**Filter 1: Tip izvora**

Odabiru se samo web izvori kako bi se osigurala konzistentnost formata i dostupnost punog teksta članka.

**Filter 2: Relevantni news portali**

Koristi se lista verificiranih hrvatskih news portala kategoriziranih u pet skupina: nacionalni mediji, poslovni mediji, regionalni mediji, specijalizirani mediji (uključujući policija.hr, vatrogasci.hr, morh.hr) i opinion portali.

**Filter 3: Minimalna duljina teksta**

Članci moraju sadržavati minimalno 500 znakova u punom tekstu.

**Filter 4: Naslov članka**

Naslov članka mora sadržavati sigurnosne pojmove: kriminal, nesreće, požari, katastrofe, hitne službe, terorizam.

**Filter 5: Core sigurnosni pojmovi**

Puni tekst članka mora sadržavati core sigurnosne pojmove s institucionalnim okvirom (policija, DORH, USKOK, vatrogasci, HGSS).

**Filter 6: Isključivanje irelevantnog sadržaja**

Isključuju se članci o sportu, zabavi i fikcionalnom kriminalu (serije, filmovi), osim ako sadrže snažne override pojmove.

**Filter 7: Hrvatski kontekst**

Članci moraju sadržavati reference na hrvatske sigurnosne institucije, gradove i lokacije.

:::

# Eksploratorni pregled podataka

## Osnovne statistike

```{r basic-stats}
#| label: basic-stats

stats_summary <- data.table(
  Metrika = c(
    "Ukupan broj članaka",
    "Vremenski raspon",
    "Broj dana",
    "Prosječno članaka dnevno",
    "Broj izvora (portala)",
    "Broj kategorija izvora"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%d.%m.%Y"), "do", format(max(dt$date), "%d.%m.%Y")),
    as.character(as.numeric(max(dt$date) - min(dt$date))),
    round(nrow(dt) / as.numeric(max(dt$date) - min(dt$date)), 2),
    length(unique(dt$FROM)),
    length(unique(dt$source_category))
  )
)

kable(stats_summary, col.names = c("Metrika", "Vrijednost"),
      caption = "Osnovne statistike dataseta") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Distribucija po kategorijama izvora

```{r source-category}
#| label: source-category
#| fig-cap: "Distribucija članaka po kategorijama izvora"

cat_summary <- dt[, .(
  N = .N,
  Postotak = round(.N / nrow(dt) * 100, 1)
), by = source_category][order(-N)]

ggplot(cat_summary, aes(x = reorder(source_category, N), y = N, fill = source_category)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(format(N, big.mark = ","), "\n(", Postotak, "%)")), 
            hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_manual(values = c("national" = colors_gimes["primary"],
                               "business" = colors_gimes["accent"],
                               "regional" = colors_gimes["success"],
                               "specialized" = colors_gimes["warning"],
                               "opinion" = colors_gimes["purple"])) +
  labs(
    title = "Broj članaka po kategoriji izvora",
    subtitle = "Specijalizirani izvori uključuju policija.hr, vatrogasci.hr, morh.hr",
    x = NULL,
    y = "Broj članaka"
  )
```

## Top 20 izvora

```{r top-sources}
#| label: top-sources
#| fig-cap: "20 najaktivnijih izvora"

top_sources <- dt[, .(N = .N), by = FROM][order(-N)][1:20]

ggplot(top_sources, aes(x = reorder(FROM, N), y = N)) +
  geom_col(fill = colors_gimes["primary"]) +
  geom_text(aes(label = format(N, big.mark = ",")), hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Top 20 izvora po broju članaka o sigurnosti",
    x = NULL,
    y = "Broj članaka"
  )
```

## Distribucija duljine teksta

```{r text-length}
#| label: text-length
#| fig-cap: "Distribucija duljine članaka"

if ("text_length" %in% names(dt)) {
  ggplot(dt, aes(x = text_length)) +
    geom_histogram(bins = 50, fill = colors_gimes["primary"], alpha = 0.8, color = "white") +
    geom_vline(xintercept = median(dt$text_length, na.rm = TRUE), 
               color = colors_gimes["secondary"], linetype = "dashed", linewidth = 1) +
    annotate("text", x = median(dt$text_length, na.rm = TRUE) + 500, 
             y = Inf, vjust = 2, hjust = 0,
             label = paste("Medijan:", format(round(median(dt$text_length, na.rm = TRUE)), big.mark = ",")),
             color = colors_gimes["secondary"], fontface = "bold") +
    scale_x_continuous(labels = comma) +
    scale_y_continuous(labels = comma) +
    labs(
      title = "Distribucija duljine članaka",
      subtitle = "Broj znakova u punom tekstu",
      x = "Broj znakova",
      y = "Broj članaka"
    )
}
```

# Semantička taksonomija

## Hijerarhijska struktura pojmova

Semantički rječnik se temelji na pojmovima identificiranima u procesu filtriranja članaka. Pojmovi se definiraju pomoću korijena riječi (stem) kako bi se osigurala šira morfološka pokrivenost hrvatskog jezika. Taksonomija se organizira u 12 kategorija koje obuhvaćaju različite aspekte sigurnosnih prijetnji i institucionalnog odgovora u hrvatskom kontekstu.

::: {.callout-note collapse="true" title="Detaljna metodologija semantičke taksonomije"}

**Princip konstrukcije rječnika:**

1. Kategorije predstavljaju konceptualno različite aspekte sigurnosti
2. Regex uzorci se koriste za fleksibilno prepoznavanje morfoloških varijanti
3. Korijenski oblici osiguravaju prepoznavanje svih padežnih i glagolskih oblika

**Morfološka pokrivenost:**

Za hrvatski jezik koji ima bogatu morfologiju, koriste se korijenski oblici s opcionalnim nastavcima: `ubojstv[a-zčćžšđ]*` prepoznaje ubojstvo, ubojstva, ubojstvom. Alternativni oblici za palatalizaciju: `[sš]`, `[cč]`, `[zž]}`. Wildcard znakovi: `.{0,15}` dopušta do 15 bilo kojih znakova između riječi.

**Formula za brojanje:**

$$
\text{count}_{c,d} = \sum_{p \in P_c} \text{matches}(p, d)
$$

gdje je $P_c$ skup regex uzoraka za kategoriju $c$, a $d$ je tekst dokumenta.

:::

```{r semantic-dictionary}
#| label: semantic-dictionary

semantic_terms <- list(
  
  nasilni_kriminal = c(
    "ubojstv[a-zčćžšđ]*",
    "ubij[a-zčćžšđ]*",
    "umorst[a-zčćžšđ]*",
    "(fizi[cč]ki|no[zž]em|oru[zž]jem).{0,10}napad",
    "brutalan.{0,5}napad",
    "silovanj[a-zčćžšđ]*",
    "seksualn[a-zčćžšđ]*.{0,10}(napad|nasilj|zlostavljanj)",
    "obiteljsk[a-zčćžšđ]*.{0,10}nasilj",
    "nasilj[a-zčćžšđ]*.{0,10}obitelji"
  ),
  
  imovinski_kriminal = c(
    "pljačk[a-zčćžšđ]*",
    "razbojni[sš]tv[a-zčćžšđ]*",
    "kra[dđ][a-zčćžšđ]*",
    "proval[a-zčćžšđ]*",
    "provalnik[a-zčćžšđ]*",
    "vandaliz[a-zčćžšđ]*",
    "pale[zž][a-zčćžšđ]*",
    "(oružana|bankovna).{0,5}pljačk"
  ),
  
  organizirani_kriminal = c(
    "organiziran[a-zčćžšđ]*.{0,10}kriminal",
    "kriminaln[a-zčćžšđ]*.{0,10}(skupin|organ|mre[zž])",
    "krijum[cč]arenj[a-zčćžšđ]*",
    "trgovin[a-zčćžšđ]*.{0,10}ljudima",
    "narko.?(kartel|bos|mafij|diler)",
    "mafija[sš]k[a-zčćžšđ]*",
    "reketarenj[a-zčćžšđ]*",
    "drog[a-zčćžšđ]*",
    "narkotik[a-zčćžšđ]*"
  ),
  
  uhicenja_pritvori = c(
    "uhi[cć]en[a-zčćžšđ]*",
    "priveden[a-zčćžšđ]*",
    "pritvor[a-zčćžšđ]*",
    "istra[zž]n[a-zčćžšđ]*.{0,10}zatvor",
    "osumnji[cč]en[a-zčćžšđ]*",
    "policijsk[a-zčćžšđ]*.{0,10}(akcij|racija|potjera)"
  ),
  
  tuziteljstvo_sudstvo = c(
    "\\bdorh\\b",
    "dr[zž]avn[a-zčćžšđ]*.{0,10}odvjetni[sš]tv",
    "tu[zž]iteljstv[a-zčćžšđ]*",
    "\\buskok\\b",
    "\\bpnuskok\\b",
    "kaznen[a-zčćžšđ]*.{0,10}prijav",
    "optu[zž]nic[a-zčćžšđ]*",
    "pravomo[cć]n[a-zčćžšđ]*.{0,10}presud",
    "[zž]upanijski.{0,5}sud",
    "op[cć]inski.{0,5}sud"
  ),
  
  prometne_nesrece = c(
    "prometn[a-zčćžšđ]*.{0,10}nesre[cć]",
    "sudar[a-zčćžšđ]*",
    "slijetanj[a-zčćžšđ]*",
    "(poginuo|poginula|smrtno stradao).{0,10}promet",
    "te[sš]k[a-zčćžšđ]*.{0,10}prometn",
    "alkohol.{0,10}volan",
    "pijan.{0,10}volan",
    "autocest[a-zčćžšđ]*",
    "dr[zž]avn[a-zčćžšđ]*.{0,10}cest"
  ),
  
  pozari = c(
    "po[zž]ar[a-zčćžšđ]*",
    "[sš]umski.{0,5}po[zž]ar",
    "stambeni.{0,5}po[zž]ar",
    "vatrogasc[a-zčćžšđ]*",
    "\\bjvp\\b",
    "\\bdvd\\b",
    "ga[sš]enj[a-zčćžšđ]*.{0,10}po[zž]ar",
    "izgorjel[a-zčćžšđ]*",
    "izbio.{0,5}po[zž]ar"
  ),
  
  prirodne_katastrofe = c(
    "potres[a-zčćžšđ]*",
    "magnitud[a-zčćžšđ]*",
    "richter[a-zčćžšđ]*",
    "seizmolo[sš]k[a-zčćžšđ]*",
    "poplav[a-zčćžšđ]*",
    "izlijevanj[a-zčćžšđ]*.{0,10}rijeke",
    "bujic[a-zčćžšđ]*",
    "oluj[a-zčćžšđ]*",
    "nevrijem[a-zčćžšđ]*",
    "klizi[sš]t[a-zčćžšđ]*",
    "odron[a-zčćžšđ]*"
  ),
  
  hitne_sluzbe = c(
    "\\bhgss\\b",
    "hrvatska gorska slu[zž]ba",
    "sto[zž]er.{0,10}civilne za[sš]tite",
    "civiln[a-zčćžšđ]*.{0,10}za[sš]tit",
    "evakuacij[a-zčćžšđ]*",
    "spa[sš]avanj[a-zčćžšđ]*",
    "interventn[a-zčćžšđ]*",
    "hitn[a-zčćžšđ]*.{0,10}(pomo[cć]|slu[zž]b)"
  ),
  
  terorizam = c(
    "teroriz[a-zčćžšđ]*",
    "terorist[a-zčćžšđ]*",
    "radikalizacij[a-zčćžšđ]*",
    "eksplozij[a-zčćžšđ]*",
    "detonacij[a-zčćžšđ]*",
    "bomb[a-zčćžšđ]*",
    "podmetnuta.{0,5}bomb"
  ),
  
  cyber_kriminal = c(
    "cyber.{0,5}(napad|kriminal|sigurnost)",
    "hakersk[a-zčćžšđ]*.{0,10}napad",
    "kra[dđ][a-zčćžšđ]*.{0,10}podatak",
    "ransomware",
    "phishing",
    "malware",
    "kibernetsk[a-zčćžšđ]*"
  ),
  
  zrtve_stete = c(
    "(smrtn|smrtno).{0,5}stradal",
    "[zž]rtv[a-zčćžšđ]*",
    "ozlije[dđ]en[a-zčćžšđ]*",
    "ranjen[a-zčćžšđ]*",
    "poginul[a-zčćžšđ]*",
    "[zž]ivotno.{0,5}ugro[zž]en",
    "te[sš]k[a-zčćžšđ]*.{0,10}ozljed",
    "materijalna.{0,5}[sš]tet",
    "procjena.{0,5}[sš]tet",
    "sanacija.{0,5}[sš]tet"
  )
)

category_display <- c(
  "nasilni_kriminal" = "Nasilni kriminal",
  "imovinski_kriminal" = "Imovinski kriminal",
  "organizirani_kriminal" = "Organizirani kriminal",
  "uhicenja_pritvori" = "Uhićenja i pritvori",
  "tuziteljstvo_sudstvo" = "Tužiteljstvo i sudstvo",
  "prometne_nesrece" = "Prometne nesreće",
  "pozari" = "Požari",
  "prirodne_katastrofe" = "Prirodne katastrofe",
  "hitne_sluzbe" = "Hitne službe",
  "terorizam" = "Terorizam",
  "cyber_kriminal" = "Cyber kriminal",
  "zrtve_stete" = "Žrtve i štete"
)

term_summary <- data.table(
  Kategorija = names(semantic_terms),
  Broj_pojmova = sapply(semantic_terms, length),
  Primjeri = sapply(semantic_terms, function(x) paste(head(x, 2), collapse = ", "))
)
term_summary[, Kategorija_display := category_display[Kategorija]]

kable(term_summary[, .(Kategorija_display, Broj_pojmova, Primjeri)], 
      col.names = c("Kategorija", "Broj pojmova", "Primjeri regex uzoraka"),
      caption = "Pregled rječnika semantičkih pojmova za sigurnost") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Brojanje semantičkih pojmova

```{r count-semantic-terms}
#| label: count-semantic-terms

count_terms <- function(text, patterns) {
  if (is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) {
    stri_count_regex(text_lower, p)
  }))
}

for (cat_name in names(semantic_terms)) {
  col_name <- paste0("count_", cat_name)
  dt[, (col_name) := sapply(FULL_TEXT, count_terms, patterns = semantic_terms[[cat_name]])]
}

dt[, count_all_semantic := rowSums(.SD), .SDcols = patterns("^count_")]
```

## Dinamika semantičkih kategorija

```{r monthly-semantic}
#| label: monthly-semantic

semantic_cols <- names(dt)[grepl("^count_", names(dt))]

monthly_semantic <- dt[, c(
  .(N = .N),
  lapply(.SD, sum, na.rm = TRUE),
  lapply(.SD, mean, na.rm = TRUE) |> setNames(paste0(names(.SD), "_avg"))
), by = yearmonth, .SDcols = semantic_cols][order(yearmonth)]

monthly_semantic[, total_mentions := count_all_semantic]
```

```{r semantic-time-series}
#| label: semantic-time-series
#| fig-cap: "Dinamika semantičkih kategorija kroz vrijeme"
#| fig-height: 12

semantic_long <- melt(
  monthly_semantic[, .(yearmonth, 
                       count_nasilni_kriminal,
                       count_imovinski_kriminal,
                       count_organizirani_kriminal,
                       count_uhicenja_pritvori,
                       count_tuziteljstvo_sudstvo,
                       count_prometne_nesrece,
                       count_pozari,
                       count_prirodne_katastrofe,
                       count_hitne_sluzbe,
                       count_terorizam,
                       count_cyber_kriminal,
                       count_zrtve_stete)],
  id.vars = "yearmonth",
  variable.name = "kategorija",
  value.name = "broj"
)

category_labels <- c(
  "count_nasilni_kriminal" = "Nasilni kriminal",
  "count_imovinski_kriminal" = "Imovinski kriminal",
  "count_organizirani_kriminal" = "Organizirani kriminal",
  "count_uhicenja_pritvori" = "Uhićenja/Pritvori",
  "count_tuziteljstvo_sudstvo" = "Tužiteljstvo/Sudstvo",
  "count_prometne_nesrece" = "Prometne nesreće",
  "count_pozari" = "Požari",
  "count_prirodne_katastrofe" = "Prirodne katastrofe",
  "count_hitne_sluzbe" = "Hitne službe",
  "count_terorizam" = "Terorizam",
  "count_cyber_kriminal" = "Cyber kriminal",
  "count_zrtve_stete" = "Žrtve/Štete"
)

semantic_long[, kategorija_label := category_labels[as.character(kategorija)]]

ggplot(semantic_long, aes(x = yearmonth, y = broj, color = kategorija_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~kategorija_label, ncol = 3, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_brewer(palette = "Set3") +
  labs(
    title = "Dinamika semantičkih kategorija sigurnosti kroz vrijeme",
    subtitle = "Mjesečni broj spominjanja po kategoriji pojmova",
    x = NULL,
    y = "Broj spominjanja",
    color = NULL
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
  )
```

# Konstrukcija indeksa

### Violent Crime Index (VCI)

VCI kvantificira intenzitet medijskog diskursa o nasilnim kaznenim djelima u hrvatskim medijima. Konstrukcija se temelji na prebrojavanju pojavljivanja korijena riječi koje signaliziraju nasilni kriminal, kao što su ubojstv, silovanj, nasilj, napad i slično. Suma tih pojavljivanja normalizira se brojem članaka kako bi se dobila prosječna mjesečna frekvencija pojmova nasilnog kriminala. Rezultat se skalira na raspon 0 do 100 standardnom min max normalizacijom. Povišene vrijednosti VCI indeksa indiciraju razdoblja intenzivnog medijskog izvještavanja o nasilnom kriminalu.

::: {.callout-note collapse="true"}
## Detaljna metodologija VCI indeksa

**Formula:**

$$
\text{VCI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{nasilni,t}}{N_t}\right)
$$

**Uključeni pojmovi:** ubojstvo, fizički napad, napad nožem/oružjem, silovanje, seksualno nasilje, obiteljsko nasilje

**Interpretacija:** Visoke vrijednosti ukazuju na intenzivan medijski diskurs o nasilnom kriminalu.

:::

### Property Crime Index (PCI)

PCI mjeri intenzitet medijskog diskursa o imovinskom kriminalu uključujući krađe, provale, pljačke i vandalizam. Indeks se konstruira prebrojavanjem pojavljivanja relevantnih pojmova normaliziranih ukupnim brojem članaka u mjesecu. Visoke vrijednosti indiciraju pojačano izvještavanje o imovinskim kaznenim djelima.

::: {.callout-note collapse="true"}
## Detaljna metodologija PCI indeksa

**Formula:**

$$
\text{PCI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{imovinski,t}}{N_t}\right)
$$

**Uključeni pojmovi:** pljačka, razbojništvo, krađa, provale, vandalizam, palež

:::

### Organized Crime Index (OCI)

OCI prati intenzitet medijskog diskursa o organiziranom kriminalu, krijumčarenju, trgovini ljudima i narkomafiji. Konstrukcija slijedi istu metodologiju normalizacije broja pojavljivanja relevantnih pojmova. Povišene vrijednosti mogu indicirati velike policijske akcije protiv organiziranih kriminalnih skupina.

::: {.callout-note collapse="true"}
## Detaljna metodologija OCI indeksa

**Formula:**

$$
\text{OCI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{organizirani,t}}{N_t}\right)
$$

**Uključeni pojmovi:** organizirani kriminal, krijumčarenje, trgovina ljudima, narkokartel, mafija, droga

:::

### Prosecution and Arrests Index (PAI)

PAI mjeri intenzitet diskursa o uhićenjima, pritvorima i radu pravosudnih institucija. Indeks kombinira pojmove vezane uz policijske akcije (uhićenja, pritvori) i tužiteljske aktivnosti (DORH, USKOK, optužnice). Visoke vrijednosti signaliziraju intenzivne policijske i pravosudne aktivnosti.

::: {.callout-note collapse="true"}
## Detaljna metodologija PAI indeksa

**Formula:**

$$
\text{PAI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{uhicenja,t} + \text{count}_{tuziteljstvo,t}}{N_t}\right)
$$

**Uključeni pojmovi:** uhićen, priveden, pritvor, DORH, USKOK, PNUSKOK, optužnica, kaznena prijava, presuda

:::

### Traffic Accident Index (TAI)

TAI prati intenzitet medijskog diskursa o prometnim nesrećama i sigurnosti u prometu. Indeks pokazuje izražene sezonske obrasce s vrhovima tijekom ljetne sezone i blagdana kada je promet intenzivniji.

::: {.callout-note collapse="true"}
## Detaljna metodologija TAI indeksa

**Formula:**

$$
\text{TAI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{prometne,t}}{N_t}\right)
$$

**Uključeni pojmovi:** prometna nesreća, sudar, slijetanje, poginuo u prometu, alkohol za volanom, autocesta

:::

### Fire Index (FRI)

FRI mjeri intenzitet diskursa o požarima i vatrogasnim intervencijama. Indeks pokazuje snažan sezonski obrazac s vrhovima u ljetnim mjesecima kada su šumski požari najučestaliji.

::: {.callout-note collapse="true"}
## Detaljna metodologija FRI indeksa

**Formula:**

$$
\text{FRI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{pozari,t}}{N_t}\right)
$$

**Uključeni pojmovi:** požar, šumski požar, stambeni požar, vatrogasci, JVP, DVD, gašenje požara

:::

### Natural Disaster Index (NDI)

NDI prati intenzitet diskursa o potresima, poplavama, olujama i drugim prirodnim nepogodama. Vrhovi koincidiraju s velikim prirodnim katastrofama poput petrinjskog potresa 2020. godine.

::: {.callout-note collapse="true"}
## Detaljna metodologija NDI indeksa

**Formula:**

$$
\text{NDI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{katastrofe,t}}{N_t}\right)
$$

**Uključeni pojmovi:** potres, magnituda, Richter, seizmološki, poplava, bujica, oluja, nevrijeme, klizište, odron

:::

### Emergency Services Index (ESI)

ESI mjeri intenzitet diskursa o radu hitnih službi uključujući HGSS, civilnu zaštitu i intervencije spašavanja. Povišene vrijednosti indiciraju razdoblja pojačanih intervencija i kriznih situacija.

::: {.callout-note collapse="true"}
## Detaljna metodologija ESI indeksa

**Formula:**

$$
\text{ESI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{hitne,t}}{N_t}\right)
$$

**Uključeni pojmovi:** HGSS, Hrvatska gorska služba spašavanja, civilna zaštita, evakuacija, spašavanje

:::

### Terrorism Index (TRI)

TRI prati intenzitet diskursa o terorizmu, radikalizaciji i sigurnosnim prijetnjama. Indeks je generalno nizak u hrvatskom kontekstu s povremenim skokovima vezanim uz međunarodne događaje.

::: {.callout-note collapse="true"}
## Detaljna metodologija TRI indeksa

**Formula:**

$$
\text{TRI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{terorizam,t}}{N_t}\right)
$$

**Uključeni pojmovi:** terorizam, teroristi, radikalizacija, eksplozija, bomba

:::

### Cyber Crime Index (CYI)

CYI mjeri intenzitet diskursa o cyber kriminalu, hakerskim napadima i digitalnoj sigurnosti. Trend je rastući s obzirom na digitalizaciju društva i sve veću učestalost cyber prijetnji.

::: {.callout-note collapse="true"}
## Detaljna metodologija CYI indeksa

**Formula:**

$$
\text{CYI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{cyber,t}}{N_t}\right)
$$

**Uključeni pojmovi:** cyber napad, hakerski napad, krađa podataka, ransomware, phishing, malware

:::

### Composite Security Index (CSI)

CSI predstavlja kompozitni indeks sigurnosti koji agregira sve pojedinačne indekse u jednu mjeru ukupnog sigurnosnog diskursa. Izračunava se kao jednostavni prosjek svih 11 specijaliziranih indeksa. Visoke vrijednosti indiciraju razdoblja intenzivnog medijskog izvještavanja o sigurnosnim temama općenito.

::: {.callout-note collapse="true"}
## Detaljna metodologija CSI indeksa

**Formula:**

$$
\text{CSI}_t = \frac{1}{11} \sum_{i=1}^{11} \text{Indeks}_{i,t}
$$

**Interpretacija vrijednosti:**

Raspon 0 do 25 indicira nisku razinu sigurnosnog diskursa. Raspon 25 do 50 indicira umjerenu razinu. Raspon 50 do 75 indicira visoku razinu. Raspon 75 do 100 indicira vrlo visoku razinu tipičnu za krizna razdoblja i velike incidente.

:::

## Opis indeksa

```{r index-table-summary}
#| label: index-table-summary

index_desc <- data.table(
  Indeks = c("VCI", "PCI", "OCI", "PAI", "TAI", "FRI", "NDI", "ESI", "TRI", "CYI", "CSI"),
  Naziv = c("Violent Crime Index", "Property Crime Index", "Organized Crime Index", 
            "Prosecution and Arrests Index", "Traffic Accident Index", "Fire Index",
            "Natural Disaster Index", "Emergency Services Index", "Terrorism Index",
            "Cyber Crime Index", "Composite Security Index"),
  Opis = c("Nasilni kriminal (ubojstva, napadi, nasilje)",
           "Imovinski kriminal (krađe, provale, pljačke)",
           "Organizirani kriminal i krijumčarenje",
           "Uhićenja, pritvori i pravosudne aktivnosti",
           "Prometne nesreće i sigurnost u prometu",
           "Požari i vatrogasne intervencije",
           "Prirodne katastrofe (potresi, poplave, oluje)",
           "Rad hitnih službi i spašavanje",
           "Terorizam i radikalizacija",
           "Cyber kriminal i digitalna sigurnost",
           "Kompozitni indeks svih kategorija")
)

kable(index_desc, caption = "Pregled konstruiranih indeksa") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

```{r index-calculation}
#| label: index-calculation

index_data <- dt[, .(
  volume = .N,
  avg_length = mean(text_length, na.rm = TRUE),
  avg_reach = if ("REACH" %in% names(.SD)) mean(REACH, na.rm = TRUE) else NA_real_,
  
  sem_nasilni = sum(count_nasilni_kriminal, na.rm = TRUE),
  sem_imovinski = sum(count_imovinski_kriminal, na.rm = TRUE),
  sem_organizirani = sum(count_organizirani_kriminal, na.rm = TRUE),
  sem_uhicenja = sum(count_uhicenja_pritvori, na.rm = TRUE),
  sem_tuziteljstvo = sum(count_tuziteljstvo_sudstvo, na.rm = TRUE),
  sem_prometne = sum(count_prometne_nesrece, na.rm = TRUE),
  sem_pozari = sum(count_pozari, na.rm = TRUE),
  sem_katastrofe = sum(count_prirodne_katastrofe, na.rm = TRUE),
  sem_hitne = sum(count_hitne_sluzbe, na.rm = TRUE),
  sem_terorizam = sum(count_terorizam, na.rm = TRUE),
  sem_cyber = sum(count_cyber_kriminal, na.rm = TRUE),
  sem_zrtve = sum(count_zrtve_stete, na.rm = TRUE),
  sem_total = sum(count_all_semantic, na.rm = TRUE)
), by = yearmonth][order(yearmonth)]

normalize <- function(x) {
  if (all(is.na(x))) return(rep(50, length(x)))
  min_x <- min(x, na.rm = TRUE)
  max_x <- max(x, na.rm = TRUE)
  if (max_x == min_x) return(rep(50, length(x)))
  (x - min_x) / (max_x - min_x) * 100
}

index_data[, `:=`(
  VCI = normalize(sem_nasilni / volume),
  PCI = normalize(sem_imovinski / volume),
  OCI = normalize(sem_organizirani / volume),
  PAI = normalize((sem_uhicenja + sem_tuziteljstvo) / volume),
  TAI = normalize(sem_prometne / volume),
  FRI = normalize(sem_pozari / volume),
  NDI = normalize(sem_katastrofe / volume),
  ESI = normalize(sem_hitne / volume),
  TRI = normalize(sem_terorizam / volume),
  CYI = normalize(sem_cyber / volume),
  VDI = normalize(sem_zrtve / volume)
)]

index_data[, CSI := (VCI + PCI + OCI + PAI + TAI + FRI + NDI + ESI + TRI + CYI + VDI) / 11]

index_cols <- c("VCI", "PCI", "OCI", "PAI", "TAI", "FRI", "NDI", "ESI", "TRI", "CYI", "VDI", "CSI")
for (col in index_cols) {
  ma_col <- paste0(col, "_MA3")
  index_data[, (ma_col) := frollmean(get(col), n = 3, align = "center")]
}
```

# Vizualizacija indeksa

## Glavni indeksi

```{r csi-plot}
#| label: csi-plot
#| fig-cap: "Composite Security Index (CSI)"
#| fig-height: 7

ggplot(index_data, aes(x = yearmonth)) +
  geom_ribbon(aes(ymin = 0, ymax = CSI), fill = colors_gimes["secondary"], alpha = 0.3) +
  geom_line(aes(y = CSI), color = colors_gimes["secondary"], linewidth = 0.8, alpha = 0.5) +
  geom_line(aes(y = CSI_MA3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = CSI_MA3), color = colors_gimes["primary"], size = 2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20)) +
  labs(
    title = "Composite Security Index (CSI)",
    subtitle = "Prosjek svih kategorija sigurnosti (0 do 100) | Tamna linija = 3 mj. klizni prosjek",
    x = NULL,
    y = "CSI"
  )
```

## Indeksi kriminala

```{r crime-indices-plot}
#| label: crime-indices-plot
#| fig-cap: "Indeksi kriminala: VCI, PCI, OCI, PAI"
#| fig-height: 8

p_vci <- ggplot(index_data, aes(x = yearmonth, y = VCI)) +
  geom_line(color = colors_gimes["crime"], linewidth = 1) +
  labs(title = "Violent Crime Index (VCI)", x = NULL, y = "Indeks (0 do 100)")

p_pci <- ggplot(index_data, aes(x = yearmonth, y = PCI)) +
  geom_line(color = colors_gimes["warning"], linewidth = 1) +
  labs(title = "Property Crime Index (PCI)", x = NULL, y = "Indeks (0 do 100)")

p_oci <- ggplot(index_data, aes(x = yearmonth, y = OCI)) +
  geom_line(color = colors_gimes["purple"], linewidth = 1) +
  labs(title = "Organized Crime Index (OCI)", x = NULL, y = "Indeks (0 do 100)")

p_pai <- ggplot(index_data, aes(x = yearmonth, y = PAI)) +
  geom_line(color = colors_gimes["primary"], linewidth = 1) +
  labs(title = "Prosecution and Arrests Index (PAI)", x = NULL, y = "Indeks (0 do 100)")

(p_vci | p_pci) / (p_oci | p_pai)
```

## Indeksi nesreća i katastrofa

```{r disaster-indices-plot}
#| label: disaster-indices-plot
#| fig-cap: "Indeksi nesreća i katastrofa: TAI, FRI, NDI, ESI"
#| fig-height: 8

p_tai <- ggplot(index_data, aes(x = yearmonth, y = TAI)) +
  geom_line(color = colors_gimes["accent"], linewidth = 1) +
  labs(title = "Traffic Accident Index (TAI)", x = NULL, y = "Indeks (0 do 100)")

p_fri <- ggplot(index_data, aes(x = yearmonth, y = FRI)) +
  geom_line(color = colors_gimes["disaster"], linewidth = 1) +
  labs(title = "Fire Index (FRI)", x = NULL, y = "Indeks (0 do 100)")

p_ndi <- ggplot(index_data, aes(x = yearmonth, y = NDI)) +
  geom_line(color = colors_gimes["secondary"], linewidth = 1) +
  labs(title = "Natural Disaster Index (NDI)", x = NULL, y = "Indeks (0 do 100)")

p_esi <- ggplot(index_data, aes(x = yearmonth, y = ESI)) +
  geom_line(color = colors_gimes["emergency"], linewidth = 1) +
  labs(title = "Emergency Services Index (ESI)", x = NULL, y = "Indeks (0 do 100)")

(p_tai | p_fri) / (p_ndi | p_esi)
```

## Indeksi terorizma i cyber kriminala

```{r special-indices-plot}
#| label: special-indices-plot
#| fig-cap: "Terrorism Index (TRI) i Cyber Crime Index (CYI)"
#| fig-height: 5

p_tri <- ggplot(index_data, aes(x = yearmonth, y = TRI)) +
  geom_line(color = colors_gimes["danger"], linewidth = 1) +
  labs(title = "Terrorism Index (TRI)", x = NULL, y = "Indeks (0 do 100)")

p_cyi <- ggplot(index_data, aes(x = yearmonth, y = CYI)) +
  geom_line(color = colors_gimes["teal"], linewidth = 1) +
  labs(title = "Cyber Crime Index (CYI)", x = NULL, y = "Indeks (0 do 100)")

p_tri | p_cyi
```

## Tablica indeksa

```{r index-table}
#| label: index-table

index_table <- index_data[, .(
  Mjesec = format(yearmonth, "%b %Y"),
  `Broj članaka` = format(volume, big.mark = ","),
  CSI = round(CSI, 1),
  VCI = round(VCI, 1),
  TAI = round(TAI, 1),
  FRI = round(FRI, 1),
  NDI = round(NDI, 1),
  PAI = round(PAI, 1)
)]

kable(tail(index_table, 12), 
      caption = "Indeksi sigurnosti: zadnjih 12 mjeseci",
      align = c("l", "r", rep("r", 6))) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
  row_spec(0, bold = TRUE, background = colors_gimes["primary"], color = "white")
```

# Sektorska analiza

## Dinamika po sektorima

```{r sector-dynamics}
#| label: sector-dynamics
#| fig-cap: "Dinamika sigurnosnih kategorija po sektorima"
#| fig-height: 10

sector_monthly <- dt[, .(
  N = .N,
  nasilni = sum(count_nasilni_kriminal, na.rm = TRUE),
  imovinski = sum(count_imovinski_kriminal, na.rm = TRUE),
  prometne = sum(count_prometne_nesrece, na.rm = TRUE),
  pozari = sum(count_pozari, na.rm = TRUE),
  katastrofe = sum(count_prirodne_katastrofe, na.rm = TRUE)
), by = .(yearmonth, source_category)][order(yearmonth)]

sector_long <- melt(sector_monthly, 
                    id.vars = c("yearmonth", "source_category", "N"),
                    variable.name = "kategorija",
                    value.name = "broj")

sector_labels <- c(
  "nasilni" = "Nasilni kriminal",
  "imovinski" = "Imovinski kriminal",
  "prometne" = "Prometne nesreće",
  "pozari" = "Požari",
  "katastrofe" = "Prirodne katastrofe"
)

sector_long[, kategorija_label := sector_labels[as.character(kategorija)]]

ggplot(sector_long, aes(x = yearmonth, y = broj, color = source_category)) +
  geom_line(linewidth = 0.8) +
  facet_wrap(~kategorija_label, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c("national" = colors_gimes["primary"],
                                "business" = colors_gimes["accent"],
                                "regional" = colors_gimes["success"],
                                "specialized" = colors_gimes["warning"],
                                "opinion" = colors_gimes["purple"])) +
  labs(
    title = "Dinamika sigurnosnih kategorija po tipu izvora",
    x = NULL,
    y = "Broj spominjanja",
    color = "Tip izvora"
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
  )
```

## Heatmapa sektorske aktivnosti

```{r heatmap}
#| label: heatmap
#| fig-cap: "Heatmapa intenziteta sigurnosnih kategorija kroz vrijeme"
#| fig-height: 10

heatmap_data <- index_data[, .(yearmonth, VCI, PCI, OCI, PAI, TAI, FRI, NDI, ESI, TRI, CYI, VDI)]

heatmap_long <- melt(heatmap_data, 
                     id.vars = "yearmonth",
                     variable.name = "indeks",
                     value.name = "vrijednost")

index_labels_full <- c(
  "VCI" = "Nasilni kriminal",
  "PCI" = "Imovinski kriminal",
  "OCI" = "Organizirani kriminal",
  "PAI" = "Uhićenja/Progon",
  "TAI" = "Prometne nesreće",
  "FRI" = "Požari",
  "NDI" = "Prirodne katastrofe",
  "ESI" = "Hitne službe",
  "TRI" = "Terorizam",
  "CYI" = "Cyber kriminal",
  "VDI" = "Žrtve/Štete"
)

heatmap_long[, indeks_label := index_labels_full[as.character(indeks)]]

ggplot(heatmap_long, aes(x = yearmonth, y = reorder(indeks_label, vrijednost), fill = vrijednost)) +
  geom_tile() +
  scale_fill_viridis_c(option = "inferno", name = "Intenzitet") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b %y") +
  labs(
    title = "Heatmapa intenziteta sigurnosnih kategorija",
    subtitle = "Tamnije boje indiciraju viši intenzitet medijskog diskursa",
    x = NULL,
    y = NULL
  ) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    axis.text.y = element_text(size = 9),
    legend.position = "right"
  )
```

## Korelacijska struktura

```{r correlation-matrix}
#| label: correlation-matrix
#| fig-cap: "Korelacijska matrica indeksa sigurnosti"
#| fig-height: 10

cor_vars <- c("VCI", "PCI", "OCI", "PAI", "TAI", "FRI", "NDI", "ESI", "TRI", "CYI", "VDI", "CSI")
cor_data <- index_data[, .SD, .SDcols = cor_vars]
cor_matrix <- cor(cor_data, use = "pairwise.complete.obs")

corrplot(cor_matrix,
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.8,
         addCoef.col = "black",
         number.cex = 0.6,
         col = colorRampPalette(c(colors_gimes["accent"], "white", colors_gimes["secondary"]))(100),
         title = "Korelacijska matrica indeksa sigurnosti",
         mar = c(0, 0, 2, 0))
```

# Volatilnost i momentum

## Konstrukcija volatilnosti i momentuma

```{r volatility-momentum}
#| label: volatility-momentum

index_data[, `:=`(
  CSI_vol_3m = frollapply(CSI, n = 3, FUN = sd, align = "right"),
  CSI_mom_1m = CSI - shift(CSI, 1),
  CSI_mom_3m = CSI - shift(CSI, 3)
)]

index_data[, `:=`(
  CSI_vol_3m_z = (CSI_vol_3m - mean(CSI_vol_3m, na.rm = TRUE)) / sd(CSI_vol_3m, na.rm = TRUE),
  CSI_mom_1m_z = (CSI_mom_1m - mean(CSI_mom_1m, na.rm = TRUE)) / sd(CSI_mom_1m, na.rm = TRUE),
  CSI_mom_3m_z = (CSI_mom_3m - mean(CSI_mom_3m, na.rm = TRUE)) / sd(CSI_mom_3m, na.rm = TRUE)
)]
```

```{r volatility-plot}
#| label: volatility-plot
#| fig-cap: "CSI volatilnost i momentum"
#| fig-height: 10

p_vol <- ggplot(index_data, aes(x = yearmonth, y = CSI_vol_3m)) +
  geom_line(color = colors_gimes["secondary"], linewidth = 1) +
  geom_hline(yintercept = mean(index_data$CSI_vol_3m, na.rm = TRUE), 
             linetype = "dashed", color = colors_gimes["muted"]) +
  labs(title = "CSI volatilnost (3M rolling SD)", x = NULL, y = "Volatilnost")

p_mom1 <- ggplot(index_data, aes(x = yearmonth, y = CSI_mom_1m)) +
  geom_col(aes(fill = CSI_mom_1m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["danger"])) +
  geom_hline(yintercept = 0, color = "gray50") +
  labs(title = "CSI momentum (M/M)", x = NULL, y = "Promjena")

p_mom3 <- ggplot(index_data, aes(x = yearmonth, y = CSI_mom_3m)) +
  geom_col(aes(fill = CSI_mom_3m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["danger"])) +
  geom_hline(yintercept = 0, color = "gray50") +
  labs(title = "CSI momentum (3M)", x = NULL, y = "Promjena")

p_vol / p_mom1 / p_mom3
```

```{r standardized-plot}
#| label: standardized-plot
#| fig-cap: "Standardizirani indeksi volatilnosti i momentuma"
#| fig-height: 6

std_long <- melt(
  index_data[, .(yearmonth, 
                 `Volatilnost (3M)` = CSI_vol_3m_z,
                 `Momentum (1M)` = CSI_mom_1m_z,
                 `Momentum (3M)` = CSI_mom_3m_z)],
  id.vars = "yearmonth",
  variable.name = "mjera",
  value.name = "z_vrijednost"
)

ggplot(std_long[!is.na(z_vrijednost)], aes(x = yearmonth, y = z_vrijednost, color = mjera)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_line(linewidth = 1) +
  scale_color_manual(values = c(
    "Volatilnost (3M)" = colors_gimes["secondary"],
    "Momentum (1M)" = colors_gimes["accent"],
    "Momentum (3M)" = colors_gimes["success"]
  )) +
  labs(
    title = "Standardizirani indeksi volatilnosti i momentuma (CSI)",
    subtitle = "Z vrijednosti omogućuju usporedbu različitih mjera",
    x = NULL,
    y = "Z vrijednost",
    color = NULL
  )
```

# Koncentracija tema

## Konstrukcija mjera koncentracije

::: {.callout-note collapse="true" title="Metodologija HHI indeksa"}

Herfindahl Hirschman Index (HHI) mjeri koncentraciju tema u medijskom prostoru. Izračunava se kao suma kvadrata udjela svake kategorije. Vrijednosti bliže 1 indiciraju visoku koncentraciju (dominacija jedne teme), dok vrijednosti bliže 0 indiciraju ravnomjerniju raspodjelu pozornosti.

**Formula:**

$$
\text{HHI}_t = \sum_{i=1}^{n} s_{i,t}^2
$$

gdje je $s_{i,t}$ udio kategorije $i$ u ukupnom broju spominjanja u mjesecu $t$.

:::

```{r hhi-calculation}
#| label: hhi-calculation

hhi_data <- monthly_semantic[, .(
  yearmonth,
  share_nasilni = count_nasilni_kriminal / count_all_semantic,
  share_imovinski = count_imovinski_kriminal / count_all_semantic,
  share_organizirani = count_organizirani_kriminal / count_all_semantic,
  share_uhicenja = count_uhicenja_pritvori / count_all_semantic,
  share_tuziteljstvo = count_tuziteljstvo_sudstvo / count_all_semantic,
  share_prometne = count_prometne_nesrece / count_all_semantic,
  share_pozari = count_pozari / count_all_semantic,
  share_katastrofe = count_prirodne_katastrofe / count_all_semantic,
  share_hitne = count_hitne_sluzbe / count_all_semantic,
  share_terorizam = count_terorizam / count_all_semantic,
  share_cyber = count_cyber_kriminal / count_all_semantic,
  share_zrtve = count_zrtve_stete / count_all_semantic
)]

share_cols <- names(hhi_data)[grepl("^share_", names(hhi_data))]
hhi_data[, HHI := rowSums(.SD^2, na.rm = TRUE), .SDcols = share_cols]

threshold <- 0.05
hhi_data[, n_active := rowSums(.SD > threshold, na.rm = TRUE), .SDcols = share_cols]

hhi_data[, HHI_MA3 := frollmean(HHI, n = 3, align = "center")]
```

```{r hhi-plot}
#| label: hhi-plot
#| fig-cap: "Koncentracija tema (HHI) i broj aktivnih kategorija"
#| fig-height: 8

p_hhi <- ggplot(hhi_data, aes(x = yearmonth)) +
  geom_line(aes(y = HHI), color = colors_gimes["muted"], linewidth = 0.8) +
  geom_line(aes(y = HHI_MA3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  labs(title = "Herfindahl Hirschman Index (HHI)", 
       subtitle = "Mjera koncentracije tema | Tamna linija = 3M klizni prosjek",
       x = NULL, y = "HHI")

p_active <- ggplot(hhi_data, aes(x = yearmonth, y = n_active)) +
  geom_line(color = colors_gimes["accent"], linewidth = 1) +
  labs(title = "Broj aktivnih kategorija", 
       subtitle = "Kategorije s udjelom većim od 5%",
       x = NULL, y = "Broj kategorija")

p_hhi / p_active
```

# Korelacije između indeksa

```{r correlation-table}
#| label: correlation-table

csi_correlations <- data.table(
  Indeks = cor_vars[cor_vars != "CSI"],
  Korelacija_s_CSI = sapply(cor_vars[cor_vars != "CSI"], function(x) {
    round(cor(index_data[[x]], index_data$CSI, use = "complete.obs"), 3)
  })
)[order(-Korelacija_s_CSI)]

kable(csi_correlations, 
      col.names = c("Indeks", "Korelacija s CSI"),
      caption = "Korelacije pojedinačnih indeksa s Composite Security Index") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

# Export

```{r export-excel}
#| label: export-excel

wb <- createWorkbook()

export_indices <- index_data[, .(
  Datum = yearmonth,
  Godina = year(yearmonth),
  Mjesec = month(yearmonth),
  Broj_clanaka = volume,
  CSI = round(CSI, 2),
  CSI_MA3 = round(CSI_MA3, 2),
  VCI = round(VCI, 2),
  PCI = round(PCI, 2),
  OCI = round(OCI, 2),
  PAI = round(PAI, 2),
  TAI = round(TAI, 2),
  FRI = round(FRI, 2),
  NDI = round(NDI, 2),
  ESI = round(ESI, 2),
  TRI = round(TRI, 2),
  CYI = round(CYI, 2),
  VDI = round(VDI, 2)
)]

addWorksheet(wb, "Indeksi")
writeData(wb, "Indeksi", export_indices)

header_style <- createStyle(
  textDecoration = "bold",
  fgFill = "#2C3E50",
  fontColour = "white",
  halign = "center"
)
addStyle(wb, "Indeksi", header_style, rows = 1, cols = 1:ncol(export_indices))
setColWidths(wb, "Indeksi", cols = 1:ncol(export_indices), widths = "auto")

semantic_export <- monthly_semantic[, .(
  Datum = yearmonth,
  Broj_clanaka = N,
  Nasilni_kriminal = count_nasilni_kriminal,
  Imovinski_kriminal = count_imovinski_kriminal,
  Organizirani_kriminal = count_organizirani_kriminal,
  Uhicenja_pritvori = count_uhicenja_pritvori,
  Tuziteljstvo_sudstvo = count_tuziteljstvo_sudstvo,
  Prometne_nesrece = count_prometne_nesrece,
  Pozari = count_pozari,
  Prirodne_katastrofe = count_prirodne_katastrofe,
  Hitne_sluzbe = count_hitne_sluzbe,
  Terorizam = count_terorizam,
  Cyber_kriminal = count_cyber_kriminal,
  Zrtve_stete = count_zrtve_stete,
  Ukupno = count_all_semantic
)]

addWorksheet(wb, "Semanticke_kategorije")
writeData(wb, "Semanticke_kategorije", semantic_export)
addStyle(wb, "Semanticke_kategorije", header_style, rows = 1, cols = 1:ncol(semantic_export))
setColWidths(wb, "Semanticke_kategorije", cols = 1:ncol(semantic_export), widths = "auto")

dynamics_export <- index_data[, .(
  Datum = yearmonth,
  CSI_original = round(CSI, 2),
  CSI_vol_3m = round(CSI_vol_3m, 2),
  CSI_mom_1m = round(CSI_mom_1m, 2),
  CSI_mom_3m = round(CSI_mom_3m, 2)
)]

addWorksheet(wb, "Dinamike")
writeData(wb, "Dinamike", dynamics_export)
addStyle(wb, "Dinamike", header_style, rows = 1, cols = 1:ncol(dynamics_export))
setColWidths(wb, "Dinamike", cols = 1:ncol(dynamics_export), widths = "auto")

cor_export <- as.data.table(cor_matrix, keep.rownames = "Indeks")

addWorksheet(wb, "Korelacije")
writeData(wb, "Korelacije", cor_export)
addStyle(wb, "Korelacije", header_style, rows = 1, cols = 1:ncol(cor_export))
setColWidths(wb, "Korelacije", cols = 1:ncol(cor_export), widths = "auto")

output_path <- here("output", "gimes_security_indices.xlsx")
dir.create(here("output"), showWarnings = FALSE, recursive = TRUE)
saveWorkbook(wb, output_path, overwrite = TRUE)

message("Excel datoteka spremljena: ", output_path)
```

# Sažetak

```{r summary-findings}
#| label: summary-findings

peak_month <- index_data[which.max(CSI), yearmonth]
peak_value <- index_data[which.max(CSI), CSI]

all_indices <- c("VCI", "PCI", "OCI", "PAI", "TAI", "FRI", "NDI", "ESI", "TRI", "CYI", "VDI")
category_means <- colMeans(index_data[, .SD, .SDcols = all_indices], na.rm = TRUE)
dominant_category <- names(which.max(category_means))

findings <- data.table(
  Nalaz = c(
    "Ukupno analiziranih članaka",
    "Vremenski raspon analize",
    "Broj izvora",
    "",
    "Vrh CSI indeksa",
    "Vrijednost vrha",
    "",
    "Dominantna kategorija",
    "Prosječna vrijednost",
    "",
    "Prosječni CSI",
    "Standardna devijacija CSI"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%m/%Y"), " do ", format(max(dt$date), "%m/%Y")),
    as.character(length(unique(dt$FROM))),
    "",
    format(peak_month, "%B %Y"),
    round(peak_value, 1),
    "",
    index_labels_full[dominant_category],
    round(category_means[dominant_category], 1),
    "",
    round(mean(index_data$CSI, na.rm = TRUE), 1),
    round(sd(index_data$CSI, na.rm = TRUE), 1)
  )
)

kable(findings, caption = "Sažetak ključnih nalaza analize") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(c(4, 7, 10), background = colors_gimes["light"])
```

---

*Izvještaj generiran: `r Sys.time()`*

*GIMES Research | Analiza medijske pokrivenosti sigurnosti i stabilnosti v2.0*
