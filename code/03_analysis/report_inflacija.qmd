---
title: "Analiza medijske pokrivenosti inflacije u Hrvatskoj"
subtitle: "Eksploratorni pregled, konstrukcija indeksa i analiza prediktivnosti"
author: "GIMES Research"
date: today
format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    theme: cosmo
    code-fold: true
    code-summary: "Prikaži kod"
    fig-width: 11
    fig-height: 7
    df-print: paged
    embed-resources: true
execute:
  warning: false
  message: false
  echo: false
lang: hr
---

```{r setup}
#| label: setup
#| include: false

library(data.table)
library(ggplot2)
library(scales)
library(lubridate)
library(stringi)
library(knitr)
library(kableExtra)
library(plotly)
library(zoo)
library(openxlsx)
library(tidytext)
library(wordcloud)
library(RColorBrewer)
library(gridExtra)
library(eurostat)
library(here)
library(seasonal)
library(forecast)
library(corrplot)

options(scipen = 999)
theme_set(theme_minimal(base_size = 12))

colors_gimes <- c(
  "primary" = "#2C3E50",
  "secondary" = "#E74C3C",
  "accent" = "#3498DB",
  "success" = "#27AE60",
  "warning" = "#F39C12",
  "light" = "#ECF0F1",
  "purple" = "#9B59B6"
)

# Standardizirani vizualni stil za sve grafikone
theme_gimes <- function() {

  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 14, color = colors_gimes["primary"]),
    plot.subtitle = element_text(size = 10, color = "gray40"),
    panel.grid.minor = element_blank(),
    legend.position = "bottom",
    axis.text = element_text(size = 9),
    strip.text = element_text(face = "bold", size = 10)
  )
}

theme_set(theme_gimes())
```

# Uvod

U ovom izvještaju se predstavlja sveobuhvatna analiza medijske pokrivenosti inflacije u Hrvatskoj. Analizom se obuhvaća razdoblje od siječnja 2021. do studenog 2024. godine, a temelji se na člancima prikupljenim iz hrvatskih online medija korištenjem napredne metodologije filtriranja i validacije sadržaja.

## Motivacija i kontekst

Inflacija je tijekom 2022. i 2023. godine postala središnja tema ekonomske rasprave u Hrvatskoj i šire. Ovim izvještajem se nastoji odgovoriti na ključna pitanja:

1. Kako se medijsko izvještavanje o inflaciji razvijalo kroz vrijeme?
2. Je li medijska pozornost odgovarala stvarnim inflacijskim pritiscima?
3. Može li se medijska pozornost koristiti kao prediktor ili rani indikator inflacije?
4. Koje su teme i aspekti inflacije najzastupljeniji u medijima?

## Struktura izvještaja

U izvještaju se obrađuju sljedeće teme: metodologija prikupljanja podataka, eksploratorni pregled dataseta, vremenska analiza dinamike izvještavanja, analiza semantičkih pojmova, konstrukcija GIMES indeksa, dinamike različitih frekvencija (M/m, 3M, 6M sezonski prilagođene stope), validacija sa službenim Eurostat HICP podacima te analiza prediktivnosti kroz ispitivanje lead/lag odnosa.

```{r load-data}
#| label: load-data

dt <- as.data.table(read.xlsx("C:/Users/lsikic/Desktop/inflacija_filtered.xlsx"))

if(is.numeric(dt$DATE)) {
  dt[, DATE := as.Date(DATE, origin = "1899-12-30")]
} else {
  dt[, DATE := as.Date(DATE)]
}

if("text_length" %in% names(dt)) {
  dt[, text_length := as.numeric(text_length)]
}
if("REACH" %in% names(dt)) {
  dt[, REACH := as.numeric(REACH)]
}
if("INTERACTIONS" %in% names(dt)) {
  dt[, INTERACTIONS := as.numeric(INTERACTIONS)]
}

dt[, `:=`(
  date = DATE,
  year = year(DATE),
  month = month(DATE),
  week = isoweek(DATE),
  yearmonth = floor_date(DATE, "month"),
  yearweek = floor_date(DATE, "week")
)]

dt <- dt[date <= as.Date("2024-11-01")]
```

# Metodologija identifikacije članaka o inflaciji

## Pregled procesa filtriranja

Identifikacija relevantnih članaka se provodi kroz šestostupanjski proces filtriranja koji kombinira strukturne kriterije, ključne riječi i kontekstualnu validaciju. Procesom se osigurava da u analizu ulaze samo članci koji su stvarno relevantni za hrvatsku inflacijsku tematiku.

::: {.callout-note collapse="true" title="Detaljna metodologija filtriranja"}

**Filter 1: Tip izvora**

Odabiru se samo web izvori kako bi se osigurala konzistentnost formata i dostupnost punog teksta članka.

**Filter 2: Relevantni news portali**

Koristi se lista od 80+ verificiranih hrvatskih news portala kategoriziranih u pet skupina: nacionalni mediji, poslovni mediji, regionalni mediji, specijalizirani mediji i opinion portali.

**Filter 3: Minimalna duljina teksta**

Članci moraju sadržavati minimalno 500 znakova u punom tekstu kako bi se osigurala sadržajna relevantnost i isključili kratki agregatorski sadržaji.

**Filter 4: Naslov članka**

Naslov članka mora sadržavati inflacijske pojmove definirane regularnim izrazima koji obuhvaćaju morfološke varijante.

**Filter 5: Core inflacijski pojmovi**

Puni tekst članka mora sadržavati core inflacijske pojmove koji potvrđuju da se članak bavi inflacijskom tematikom.

**Filter 6: Hrvatski kontekst**

Članci moraju sadržavati reference na hrvatsku ekonomiju (Hrvatska, hrvatski, HRK, kuna, HNB, eurozona HR kontekst) kako bi se isključili članci o inflaciji u drugim zemljama.

:::

# Eksploratorni pregled podataka

## Osnovne statistike

U ovom poglavlju se prikazuju osnovne deskriptivne statistike dataseta. Analizom se obuhvaćaju broj članaka, vremenski raspon, distribucija izvora i karakteristike tekstova.

```{r basic-stats}
#| label: basic-stats

stats_summary <- data.table(
  Metrika = c(
    "Ukupan broj članaka",
    "Vremenski raspon",
    "Broj dana",
    "Prosječno članaka dnevno",
    "Broj izvora (portala)",
    "Broj kategorija izvora"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%d.%m.%Y"), "do", format(max(dt$date), "%d.%m.%Y")),
    as.character(as.numeric(max(dt$date) - min(dt$date))),
    round(nrow(dt) / as.numeric(max(dt$date) - min(dt$date)), 1),
    length(unique(dt$FROM)),
    length(unique(dt$source_category))
  )
)

kable(stats_summary, col.names = c("Metrika", "Vrijednost"),
      caption = "Osnovne statistike dataseta") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Distribucija po kategorijama izvora

```{r source-category}
#| label: source-category
#| fig-cap: "Distribucija članaka po kategorijama izvora"

cat_summary <- dt[, .(
  N = .N,
  Postotak = round(.N / nrow(dt) * 100, 1)
), by = source_category][order(-N)]

ggplot(cat_summary, aes(x = reorder(source_category, N), y = N, fill = source_category)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(format(N, big.mark = ","), "\n(", Postotak, "%)")), 
            hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_manual(values = c("national" = colors_gimes["primary"],
                               "business" = colors_gimes["accent"],
                               "regional" = colors_gimes["success"],
                               "specialized" = colors_gimes["warning"],
                               "opinion" = colors_gimes["secondary"])) +
  labs(
    title = "Broj članaka po kategoriji izvora",
    x = NULL,
    y = "Broj članaka"
  )
```

## Top 20 izvora

```{r top-sources}
#| label: top-sources
#| fig-cap: "20 najaktivnijih izvora"

top_sources <- dt[, .(N = .N), by = FROM][order(-N)][1:20]

ggplot(top_sources, aes(x = reorder(FROM, N), y = N)) +
  geom_col(fill = colors_gimes["primary"]) +
  geom_text(aes(label = format(N, big.mark = ",")), hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Top 20 izvora po broju članaka o inflaciji",
    x = NULL,
    y = "Broj članaka"
  )
```

## Distribucija duljine teksta

```{r text-length}
#| label: text-length
#| fig-cap: "Distribucija duljine članaka"

if("text_length" %in% names(dt)) {
  ggplot(dt, aes(x = text_length)) +
    geom_histogram(bins = 50, fill = colors_gimes["primary"], alpha = 0.8, color = "white") +
    geom_vline(xintercept = median(dt$text_length, na.rm = TRUE), 
               color = colors_gimes["secondary"], linetype = "dashed", linewidth = 1) +
    annotate("text", x = median(dt$text_length, na.rm = TRUE) + 500, 
             y = Inf, vjust = 2, hjust = 0,
             label = paste("Medijan:", format(round(median(dt$text_length, na.rm = TRUE)), big.mark = ",")),
             color = colors_gimes["secondary"], fontface = "bold") +
    scale_x_continuous(labels = comma) +
    scale_y_continuous(labels = comma) +
    labs(
      title = "Distribucija duljine članaka",
      subtitle = "Broj znakova u FULL_TEXT polju",
      x = "Broj znakova",
      y = "Broj članaka"
    )
}
```

# Vremenska analiza

## Dnevna frekvencija članaka o inflaciji

Na sljedećem grafikonu se prikazuje dnevni broj članaka o inflaciji s kliznim prosjekom. Dnevnim brojem članaka se predstavlja jednostavan ali informativan pokazatelj medijske pozornosti na inflacijske teme.

```{r daily-frequency}
#| label: daily-frequency
#| fig-cap: "Dnevni broj članaka o inflaciji"
#| fig-height: 8

daily <- dt[, .(N = .N), by = date][order(date)]
daily[, MA7 := frollmean(N, n = 7, align = "center")]
daily[, MA30 := frollmean(N, n = 30, align = "center")]

ggplot(daily, aes(x = date)) +
  geom_col(aes(y = N), fill = colors_gimes["light"], alpha = 0.5, width = 1) +
  geom_line(aes(y = MA7, color = "7-dnevni prosjek"), linewidth = 0.8, na.rm = TRUE) +
  geom_line(aes(y = MA30, color = "30-dnevni prosjek"), linewidth = 1.2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(labels = comma) +
  scale_color_manual(values = c("7-dnevni prosjek" = colors_gimes["accent"],
                                "30-dnevni prosjek" = colors_gimes["secondary"])) +
  labs(
    title = "Dnevna frekvencija članaka o inflaciji",
    subtitle = "Broj članaka po danu sa kliznim prosjekom | Samostalni indikator medijske pozornosti",
    x = NULL,
    y = "Broj članaka",
    color = "Klizni prosjek"
  )
```

## Mjesečna dinamika

```{r monthly-trend}
#| label: monthly-trend
#| fig-cap: "Mjesečni broj članaka o inflaciji"

monthly <- dt[, .(N = .N), by = yearmonth][order(yearmonth)]
monthly[, MA3 := frollmean(N, n = 3, align = "center")]

ggplot(monthly, aes(x = yearmonth)) +
  geom_col(aes(y = N), fill = colors_gimes["primary"], alpha = 0.7, width = 25) +
  geom_line(aes(y = MA3), color = colors_gimes["secondary"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = MA3), color = colors_gimes["secondary"], size = 2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Mjesečni broj članaka o inflaciji",
    subtitle = "Crvena linija = 3-mjesečni klizni prosjek",
    x = NULL,
    y = "Broj članaka"
  )
```

## Tjedna dinamika

```{r weekly-trend}
#| label: weekly-trend
#| fig-cap: "Tjedni broj članaka o inflaciji"

weekly <- dt[, .(N = .N), by = yearweek][order(yearweek)]
weekly[, MA4 := frollmean(N, n = 4, align = "center")]

ggplot(weekly, aes(x = yearweek)) +
  geom_col(aes(y = N), fill = colors_gimes["primary"], alpha = 0.7, width = 5) +
  geom_line(aes(y = MA4), color = colors_gimes["secondary"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = MA4), color = colors_gimes["secondary"], size = 1.5, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Tjedni broj članaka o inflaciji",
    subtitle = "Crvena linija = 4-tjedni klizni prosjek",
    x = NULL,
    y = "Broj članaka"
  )
```

## Godišnja usporedba

```{r yearly-comparison}
#| label: yearly-comparison
#| fig-cap: "Usporedba mjesečne dinamike po godinama"

yearly_monthly <- dt[, .(N = .N), by = .(year, month)][order(year, month)]

ggplot(yearly_monthly, aes(x = month, y = N, color = factor(year), group = year)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +
  scale_x_continuous(breaks = 1:12, labels = c("Sij", "Velj", "Ožu", "Tra", "Svi", "Lip",
                                                "Srp", "Kol", "Ruj", "Lis", "Stu", "Pro")) +
  scale_y_continuous(labels = comma) +
  scale_color_manual(values = c("2021" = "#3498DB", "2022" = "#E74C3C", 
                                "2023" = "#27AE60", "2024" = "#9B59B6")) +
  labs(
    title = "Mjesečna dinamika po godinama",
    x = "Mjesec",
    y = "Broj članaka",
    color = "Godina"
  )
```

## Distribucija po danima u tjednu

```{r weekday-dist}
#| label: weekday-dist
#| fig-cap: "Distribucija članaka po danima u tjednu"

dt[, weekday_num := wday(date, week_start = 1)]
weekday_labels <- c("Ponedjeljak", "Utorak", "Srijeda", "Četvrtak", "Petak", "Subota", "Nedjelja")
dt[, weekday := factor(weekday_num, levels = 1:7, labels = weekday_labels)]

weekday_summary <- dt[, .(N = .N), by = weekday][order(weekday)]

ggplot(weekday_summary, aes(x = weekday, y = N)) +
  geom_col(fill = colors_gimes["primary"], show.legend = FALSE) +
  geom_text(aes(label = format(N, big.mark = ",")), vjust = -0.5, size = 3.5) +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.1))) +
  labs(
    title = "Broj članaka po danu u tjednu",
    x = NULL,
    y = "Broj članaka"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# Analiza sentimenta

U ovoj sekciji se prikazuje metodologija i rezultati analize sentimenta članaka o inflaciji. Sentimentom se mjeri ton i emocionalnost izvještavanja o inflacijskim temama.

## Konstrukcija sentiment leksikona

Analiza sentimenta se provodi korištenjem prilagođenog leksikona za hrvatski jezik. Leksikonom se koriste korijenski oblici riječi (stemovi) kako bi se osigurala šira morfološka pokrivenost svih padežnih i glagolskih oblika.

Sentiment svakoga članka se određuje na temelju prisutnosti pozitivnih i negativnih pojmova u tekstu. Za svaki članak se broje pojavljivanja pojmova iz obje kategorije, a konačni sentiment se izračunava kao razlika normaliziranih vrijednosti.

::: {.callout-note collapse="true" title="Tehnička metodologija sentiment analize"}

**Princip konstrukcije leksikona:**

Leksikonom se koriste korijenski oblici riječi (stemovi) s regex uzorcima koji prepoznaju sve morfološke varijante. Na primjer, uzorak `kriz[aeiou]*` prepoznaje: kriza, krize, krizi, krizom, krizu itd.

**Formula za izračun sentimenta:**

Za svaki članak $d$ se izračunava sentiment prema formuli:

$$
S_d = \frac{P_d - N_d}{P_d + N_d + 1}
$$

gdje je:

- $P_d$ = broj pozitivnih pojmova u članku
- $N_d$ = broj negativnih pojmova u članku
- Dodavanje 1 u nazivniku sprječava dijeljenje s nulom

**Interpretacija vrijednosti:**

- $S_d < -0.2$: Negativan sentiment (članak fokusiran na probleme, krize, negativne aspekte)
- $-0.2 \leq S_d \leq 0.2$: Neutralan sentiment
- $S_d > 0.2$: Pozitivan sentiment (članak fokusiran na poboljšanja, stabilizaciju)

**Mjesečna agregacija:**

Mjesečni sentiment se izračunava kao ponderirani prosjek:

$$
\bar{S}_m = \frac{\sum_{d \in m} S_d \cdot w_d}{\sum_{d \in m} w_d}
$$

gdje je $w_d$ težina članka (može biti duljina teksta ili reach).

:::

```{r sentiment-lexicon}
#| label: sentiment-lexicon

# Sentiment leksikon s korijenskim oblicima (stemovima) za morfološku pokrivenost
sentiment_negative_stems <- c(
  # Krizni pojmovi
  "kriz[aeiou]*",              # kriza, krize, krizom...
  "katastro[a-zčćžšđ]*",       # katastrofa, katastrofalan...
  "kolaps[a-zčćžšđ]*",         # kolaps, kolapsirati...
  "propast[a-zčćžšđ]*",        # propast, propadanje...
  
  # Strah i panika
  "strah[aeiou]*",             # strah, strahovi, strahovanja...
  "panik[aeiou]*",             # panika, paničan...
  "zabrinut[a-zčćžšđ]*",       # zabrinutost, zabrinjavajuće...
  "neizvjesn[a-zčćžšđ]*",      # neizvjesnost, neizvjestan...
  
  # Pogoršanje
  "pogor[sš]anj[aeiou]*",      # pogoršanje, pogoršanja...
  "pad[aeiou]*",               # pad, padanje...
  "smanjenj[aeiou]*",          # smanjenje, smanjenja...
  "gubit[a-zčćžšđ]*",          # gubitak, gubici...
  
  # Problemi
  "problem[aeiou]*",           # problem, problemi...
  "pote[sš]ko[cć][aeiou]*",    # poteškoća, poteškoće...
  "nedostat[a-zčćžšđ]*",       # nedostatak, nedostaci...
  
  # Inflacijski negativni
  "hiperinflacij[aeiou]*",     # hiperinflacija...
  "stagflacij[aeiou]*",        # stagflacija...
  "poskupljenj[aeiou]*",       # poskupljenje, poskupljenja...
  "skupo[cć][aeiou]*",         # skupoća...
  
  # Ekonomski negativni
  "recesij[aeiou]*",           # recesija...
  "nezaposlen[a-zčćžšđ]*",     # nezaposlenost, nezaposleni...
  "siroma[sš]tv[aeiou]*",      # siromaštvo...
  "du[gž][aeiou]*"             # dug, dugovi...
)

sentiment_positive_stems <- c(
  # Stabilizacija
  "stabilizacij[aeiou]*",      # stabilizacija...
  "stabilan[a-zčćžšđ]*",       # stabilan, stabilnost...
  "oporav[a-zčćžšđ]*",         # oporavak, oporavljanje...
  
  # Poboljšanje
  "pobolj[sš]anj[aeiou]*",     # poboljšanje...
  "rast[aeiou]*",              # rast (pozitivan kontekst)
  "porast[aeiou]*",            # porast (npr. plaća)
  "pove[cć]anj[aeiou]*",       # povećanje...
  
  # Pozitivni ekonomski
  "prosperitet[aeiou]*",       # prosperitet...
  "blagostanj[aeiou]*",        # blagostanje...
  "napred[a-zčćžšđ]*",         # napredak...
  
  # Dezinflacija
  "dezinflacij[aeiou]*",       # dezinflacija...
  "usporavanj[aeiou]*",        # usporavanje inflacije...
  "sniz[aeiou]*",              # sniženje, snižavanje...
  
  # Mjere i rješenja
  "rje[sš]enj[aeiou]*",        # rješenje...
  "mjer[aeiou]*",              # mjere...
  "potpor[aeiou]*",            # potpora, potpore...
  "pomo[cć][aeiou]*"           # pomoć...
)

# Funkcija za brojanje pojmova korištenjem stemova
count_sentiment <- function(text, patterns) {
  if(is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) stri_count_regex(text_lower, p)))
}

# Izračun sentimenta za svaki članak
dt[, neg_count := sapply(FULL_TEXT, count_sentiment, patterns = sentiment_negative_stems)]
dt[, pos_count := sapply(FULL_TEXT, count_sentiment, patterns = sentiment_positive_stems)]

# Izračun sentiment skora
dt[, sentiment_score := (pos_count - neg_count) / (pos_count + neg_count + 1)]

# Kategorijalni sentiment
dt[, AUTO_SENTIMENT := fcase(
  sentiment_score < -0.2, -1,
  sentiment_score > 0.2, 1,
  default = 0
)]
```

## Dinamika sentimenta kroz vrijeme

Na sljedećem grafikonu se prikazuje evolucija sentimenta u medijskom izvještavanju o inflaciji. Negativne vrijednosti indiciraju zabrinutost i krizno izvještavanje, dok pozitivne vrijednosti ukazuju na optimističniji ton.

```{r sentiment-time}
#| label: sentiment-time
#| fig-cap: "Dinamika sentimenta kroz vrijeme"

sentiment_monthly <- dt[, .(
  avg_sentiment = mean(sentiment_score, na.rm = TRUE),
  N = .N,
  pct_negative = sum(AUTO_SENTIMENT == -1, na.rm = TRUE) / .N * 100,
  pct_positive = sum(AUTO_SENTIMENT == 1, na.rm = TRUE) / .N * 100,
  pct_neutral = sum(AUTO_SENTIMENT == 0, na.rm = TRUE) / .N * 100
), by = yearmonth][order(yearmonth)]

ggplot(sentiment_monthly, aes(x = yearmonth)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_ribbon(aes(ymin = pmin(avg_sentiment, 0), ymax = 0), 
              fill = colors_gimes["secondary"], alpha = 0.3) +
  geom_ribbon(aes(ymin = 0, ymax = pmax(avg_sentiment, 0)), 
              fill = colors_gimes["success"], alpha = 0.3) +
  geom_line(aes(y = avg_sentiment), color = colors_gimes["primary"], linewidth = 1.2) +
  geom_point(aes(y = avg_sentiment, size = N), color = colors_gimes["primary"], alpha = 0.6) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_size_continuous(range = c(2, 6), labels = comma) +
  labs(
    title = "Prosječni sentiment članaka kroz vrijeme",
    subtitle = "Negativne vrijednosti = zabrinutost | Pozitivne vrijednosti = optimizam",
    x = NULL,
    y = "Prosječni sentiment",
    size = "Broj članaka"
  )
```

## Distribucija sentimenta

```{r sentiment-distribution}
#| label: sentiment-distribution
#| fig-cap: "Distribucija sentimenta članaka"

sentiment_dist <- dt[, .(N = .N), by = AUTO_SENTIMENT]
sentiment_dist[, Kategorija := fcase(
  AUTO_SENTIMENT == -1, "Negativan",
  AUTO_SENTIMENT == 0, "Neutralan",
  AUTO_SENTIMENT == 1, "Pozitivan"
)]

ggplot(sentiment_dist, aes(x = Kategorija, y = N, fill = Kategorija)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(format(N, big.mark = ","), "\n(", 
                               round(N/sum(N)*100, 1), "%)")), 
            vjust = -0.2, size = 4) +
  scale_fill_manual(values = c("Negativan" = colors_gimes["secondary"],
                               "Neutralan" = colors_gimes["light"],
                               "Pozitivan" = colors_gimes["success"])) +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Distribucija sentimenta članaka",
    x = NULL,
    y = "Broj članaka"
  )
```

# Analiza semantičkih pojmova povezanih s inflacijom

U ovoj sekciji se proširuje analiza na širi skup semantički povezanih pojmova koji mogu bolje pratiti inflacijske trendove u medijskom izvještavanju. Pojmovi se definiraju pomoću korijena riječi (stem) kako bi se osigurala šira morfološka pokrivenost.

## Definicija rječnika inflacijskih pojmova

Semantička taksonomija se organizira u osam kategorija koje obuhvaćaju različite aspekte inflacije. Svaka kategorija predstavlja specifičan sektor ili tematsko područje vezano uz inflaciju.

<details>
<summary>**Kliknite za prikaz kompletne tablice semantičkog rječnika**</summary>

```{r semantic-dictionary}
#| label: semantic-dictionary

# Definicija rječnika inflacijskih i semantički povezanih pojmova - STEMMED VERSION
semantic_terms <- list(
  
  # Direktni inflacijski pojmovi - STEMMED
  inflacija_direktno = c(
    "inflacij[a-zčćžšđ]*",
    "dezinflacij[a-zčćžšđ]*",
    "hiperinflacij[a-zčćžšđ]*",
    "stagflacij[a-zčćžšđ]*"
  ),
  
  # Cijene i poskupljenja - STEMMED
  cijene_poskupljenja = c(
    "poskupljenj[a-zčćžšđ]*",
    "poskupi[a-zčćžšđ]*",
    "porast.{0,10}cijen[a-zčćžšđ]*",
    "rast.{0,10}cijen[a-zčćžšđ]*",
    "vi[sš][aeiou]+.{0,10}cijen[a-zčćžšđ]*",
    "skok.{0,10}cijen[a-zčćžšđ]*",
    "skupo[cć][a-zčćžšđ]*",
    "skuplj[a-zčćžšđ]*"
  ),
  
  # Troškovi života - STEMMED
  troskovi_zivota = c(
    "tro[sš]kov[a-zčćžšđ]*.{0,10}[zž]ivot[a-zčćžšđ]*",
    "[zž]ivotn[a-zčćžšđ]*.{0,10}standard[a-zčćžšđ]*",
    "kupovn[a-zčćžšđ]*.{0,10}mo[cć][a-zčćžšđ]*",
    "egzistencij[a-zčćžšđ]*"
  ),
  
  # Energija i gorivo - STEMMED
  energija_gorivo = c(
    "cijen[a-zčćžšđ]*.{0,10}energij[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}goriv[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}struj[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}plin[a-zčćžšđ]*",
    "energetsk[a-zčćžšđ]*.{0,10}kriz[a-zčćžšđ]*"
  ),
  
  # Hrana i prehrambeni proizvodi - STEMMED
  hrana = c(
    "cijen[a-zčćžšđ]*.{0,10}hran[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}namirnic[a-zčćžšđ]*",
    "prehramben[a-zčćžšđ]*.{0,10}proizvod[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}kruh[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}mlijeka?"
  ),
  
  # Monetarna politika - STEMMED
  monetarna_politika = c(
    "kamatn[a-zčćžšđ]*.{0,10}stop[a-zčćžšđ]*",
    "kamat[a-zčćžšđ]*",
    "\\bhnb\\b",
    "\\becb\\b",
    "monetarn[a-zčćžšđ]*.{0,10}politik[a-zčćžšđ]*",
    "euroz[ao]n[a-zčćžšđ]*"
  ),
  
  # Plaće i primanja - STEMMED
  place_primanja = c(
    "pla[cć][a-zčćžšđ]*",
    "primanj[a-zčćžšđ]*",
    "mirovin[a-zčćžšđ]*",
    "realn[a-zčćžšđ]*.{0,10}pla[cć][a-zčćžšđ]*",
    "rast.{0,10}pla[cć][a-zčćžšđ]*"
  ),
  
  # Indeksi i mjere - STEMMED
  indeksi_mjere = c(
    "\\bhicp\\b",
    "indeks.{0,10}potro[sš][a-zčćžšđ]*",
    "\\bcpi\\b",
    "bazn[a-zčćžšđ]*.{0,10}inflacij[a-zčćžšđ]*",
    "jezgren[a-zčćžšđ]*.{0,10}inflacij[a-zčćžšđ]*"
  )
)

term_summary <- data.table(
  Kategorija = names(semantic_terms),
  Broj_pojmova = sapply(semantic_terms, length),
  Primjeri = sapply(semantic_terms, function(x) paste(head(x, 2), collapse = ", "))
)

kable(term_summary, 
      col.names = c("Kategorija", "Broj pojmova", "Primjeri regex uzoraka"),
      caption = "Pregled rječnika semantičkih pojmova") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

</details>

## Konstrukcija sektorskih indeksa

Za svaku semantičku kategoriju se konstruira sektorski indeks koji prati intenzitet medijskog izvještavanja o tom specifičnom aspektu inflacije. Sektorskim indeksima se omogućuje praćenje koje teme dominiraju u medijskom diskursu kroz vrijeme.

Konstrukcija sektorskih indeksa se provodi kroz sljedeće korake: za svaki članak se zbrajaju pojavljivanja pojmova iz svake kategorije korištenjem regex uzoraka, zatim se vrijednosti agregiraju na mjesečnoj razini, te se na kraju normaliziraju na skalu 0 do 100 za usporedivost.

::: {.callout-note collapse="true" title="Tehnička metodologija konstrukcije sektorskih indeksa"}

**Korak 1: Brojanje pojmova po člancima**

Za svaki članak $d$ i kategoriju $c$ se broji ukupan broj pojavljivanja pojmova:

$$
\text{count}_{c,d} = \sum_{p \in P_c} \text{matches}(p, d)
$$

gdje je $P_c$ skup regex uzoraka za kategoriju $c$.

**Korak 2: Mjesečna agregacija**

Za svaki mjesec $m$ se izračunava ukupan broj pojmova po kategoriji:

$$
\text{Total}_{c,m} = \sum_{d \in m} \text{count}_{c,d}
$$

**Korak 3: Normalizacija na skalu 0 do 100**

Za usporedivost između kategorija se primjenjuje min-max normalizacija:

$$
\text{Index}_{c,m} = \frac{\text{Total}_{c,m} - \min(\text{Total}_c)}{\max(\text{Total}_c) - \min(\text{Total}_c)} \times 100
$$

**Interpretacija:**

- 0 = minimalna aktivnost za tu kategoriju u promatranom razdoblju
- 100 = maksimalna aktivnost za tu kategoriju
- Vrijednosti između indiciraju relativni intenzitet u odnosu na ekstreme

**Prednosti normalizacije:**

- Omogućuje usporedbu kategorija različitih apsolutnih veličina
- Vizualno prikazuje relativne trendove unutar svake kategorije
- Olakšava identifikaciju vrhunaca i minimuma za svaki sektor

:::

```{r count-semantic-terms}
#| label: count-semantic-terms

count_terms <- function(text, patterns) {
  if(is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) {
    stri_count_regex(text_lower, p)
  }))
}

for(cat_name in names(semantic_terms)) {
  col_name <- paste0("count_", cat_name)
  dt[, (col_name) := sapply(FULL_TEXT, count_terms, patterns = semantic_terms[[cat_name]])]
}

dt[, count_all_semantic := rowSums(.SD), .SDcols = patterns("^count_")]
dt[, inflacija_count := sapply(FULL_TEXT, count_terms, patterns = semantic_terms$inflacija_direktno)]
```

## Mjesečna agregacija semantičkih pojmova

Podaci se agregiraju na mjesečnoj razini kako bi se omogućila analiza vremenskih trendova za svaku semantičku kategoriju.

```{r monthly-semantic}
#| label: monthly-semantic

semantic_cols <- names(dt)[grepl("^count_", names(dt))]

monthly_semantic <- dt[, c(
  .(N = .N),
  lapply(.SD, sum, na.rm = TRUE),
  lapply(.SD, mean, na.rm = TRUE) |> setNames(paste0(names(.SD), "_avg"))
), by = yearmonth, .SDcols = semantic_cols][order(yearmonth)]

monthly_semantic[, total_mentions := count_all_semantic]

# Normalizacija sektorskih indeksa
normalize <- function(x) {
  if(all(is.na(x))) return(rep(50, length(x)))
  min_x <- min(x, na.rm = TRUE)
  max_x <- max(x, na.rm = TRUE)
  if(max_x == min_x) return(rep(50, length(x)))
  (x - min_x) / (max_x - min_x) * 100
}

monthly_semantic[, `:=`(
  idx_inflacija = normalize(count_inflacija_direktno),
  idx_cijene = normalize(count_cijene_poskupljenja),
  idx_troskovi = normalize(count_troskovi_zivota),
  idx_energija = normalize(count_energija_gorivo),
  idx_hrana = normalize(count_hrana),
  idx_monetarna = normalize(count_monetarna_politika),
  idx_place = normalize(count_place_primanja),
  idx_indeksi = normalize(count_indeksi_mjere)
)]
```

## Vizualizacija sektorskih indeksa

Na sljedećim grafikonima se prikazuju normalizirani sektorski indeksi (skala 0 do 100) za svaku od osam semantičkih kategorija. Svakim indeksom se prati relativni intenzitet medijskog izvještavanja o specifičnom aspektu inflacije.

```{r sector-indices-plot}
#| label: sector-indices-plot
#| fig-cap: "Sektorski indeksi medijske pozornosti"
#| fig-height: 12

sector_long <- melt(
  monthly_semantic[, .(yearmonth, 
                       idx_inflacija, idx_cijene, idx_troskovi, idx_energija,
                       idx_hrana, idx_monetarna, idx_place, idx_indeksi)],
  id.vars = "yearmonth",
  variable.name = "sektor",
  value.name = "indeks"
)

sector_labels <- c(
  "idx_inflacija" = "Inflacija (direktno)",
  "idx_cijene" = "Cijene i poskupljenja",
  "idx_troskovi" = "Troškovi života",
  "idx_energija" = "Energija i gorivo",
  "idx_hrana" = "Hrana",
  "idx_monetarna" = "Monetarna politika",
  "idx_place" = "Plaće i primanja",
  "idx_indeksi" = "Indeksi i mjere"
)

sector_long[, sektor_label := sector_labels[as.character(sektor)]]

ggplot(sector_long, aes(x = yearmonth, y = indeks, color = sektor_label)) +
  geom_line(linewidth = 1) +
  geom_point(size = 1.5, alpha = 0.6) +
  facet_wrap(~sektor_label, ncol = 2, scales = "fixed") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 25)) +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Sektorski indeksi medijske pozornosti na inflaciju",
    subtitle = "Normalizirani indeksi (0 do 100) po semantičkim kategorijama",
    x = NULL,
    y = "Indeks (0 do 100)",
    color = NULL
  ) +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Heatmapa sektorske aktivnosti

Na sljedećoj heatmapi se prikazuje intenzitet medijske pozornosti po sektorima kroz vrijeme. Tamnije boje indiciraju višu razinu aktivnosti u određenom mjesecu za određeni sektor.

Heatmapa se konstruira tako da se za svaki mjesec i svaki sektor prikazuje normalizirana vrijednost indeksa. Normalizacijom se omogućuje usporedba između sektora različitih apsolutnih veličina. Interpretacija je jednostavna: tamnije ćelije predstavljaju periode pojačanog izvještavanja o tom sektoru.

::: {.callout-note collapse="true" title="Tehnička metodologija konstrukcije heatmape"}

**Struktura podataka:**

Heatmapa se konstruira kao matrica s dimenzijama:

- Redci: vremenska razdoblja (mjeseci)
- Stupci: sektorske kategorije
- Vrijednosti: normalizirani indeksi (0 do 100)

**Normalizacija za vizualizaciju:**

Za optimalnu vizualnu prezentaciju se primjenjuje dodatna transformacija:

$$
\text{Heatmap}_{s,m} = \frac{\text{Index}_{s,m}}{\max_m(\text{Index}_s)} \times 100
$$

Time se osigurava da svaki sektor ima barem jedan mjesec s maksimalnom vrijednošću.

**Odabir palete boja:**

Koristi se sekvencijalna paleta (bijela do tamno plava) koja intuitivno prikazuje intenzitet: svijetle boje za nisku aktivnost, tamne boje za visoku aktivnost.

**Interpretacija uzoraka:**

- Horizontalni tamni pojas: pojačana aktivnost jednog sektora kroz više mjeseci
- Vertikalni tamni pojas: pojačana aktivnost svih sektora u jednom mjesecu (generalna inflacijska tema)
- Dijagonalni uzorci: postepeni prijelazi između sektora

:::

```{r sector-heatmap}
#| label: sector-heatmap
#| fig-cap: "Heatmapa sektorske aktivnosti"
#| fig-height: 8

heatmap_data <- sector_long[, .(yearmonth, sektor_label, indeks)]
heatmap_data[, month_label := format(yearmonth, "%b %Y")]

ggplot(heatmap_data, aes(x = yearmonth, y = sektor_label, fill = indeks)) +
  geom_tile(color = "white", linewidth = 0.5) +
  scale_fill_gradient2(low = "white", mid = colors_gimes["accent"], high = colors_gimes["primary"],
                       midpoint = 50, limits = c(0, 100)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "Heatmapa sektorske medijske aktivnosti",
    subtitle = "Intenzitet izvještavanja po sektorima kroz vrijeme (0 = minimum, 100 = maksimum)",
    x = NULL,
    y = NULL,
    fill = "Indeks"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
        axis.text.y = element_text(size = 10))
```

# GIMES Indeks medijske inflacije

## Opis i konstrukcija indeksa

GIMES indeks (Government, Industry, Media Economic Sentiment) medijske inflacije se konstruira kao kompozitni pokazatelj koji kombinira četiri dimenzije medijskog izvještavanja. Indeksom se nastoji uhvatiti ukupna razina medijske zabrinutosti oko inflacije u Hrvatskoj.

Indeks je skaliran na raspon 0 do 100, gdje viša vrijednost indicira veću medijsku pozornost i zabrinutost oko inflacije. Konstrukcija se temelji na kombinaciji volumena izvještavanja, dubine analize, tona sentimenta i dosega članaka.

**Komponente indeksa:**

- **Volumen (40% težina)**: Broj članaka o inflaciji u mjesecu predstavlja osnovni pokazatelj koliko se o inflaciji piše.
- **Intenzitet (20% težina)**: Prosječna duljina članaka mjeri dubinu i analitičnost izvještavanja.
- **Sentiment (20% težina)**: Negativniji ton izvještavanja signalizira veću zabrinutost.
- **Doseg (20% težina)**: Prosječni reach članaka indicira koliko je tema prisutna u javnosti.

::: {.callout-note collapse="true" title="Tehnička metodologija konstrukcije GIMES indeksa"}

**Formula GIMES indeksa:**

$$
\text{GIMES}_t = 0.40 \times V_{norm,t} + 0.20 \times I_{norm,t} + 0.20 \times (100 - S_{norm,t}) + 0.20 \times R_{norm,t}
$$

gdje su:

- $V_{norm,t}$ = normalizirani volumen članaka u mjesecu $t$
- $I_{norm,t}$ = normalizirani intenzitet (prosječna duljina članaka)
- $S_{norm,t}$ = normalizirani sentiment (invertiran tako da negativniji sentiment daje višu vrijednost)
- $R_{norm,t}$ = normalizirani doseg (reach)

**Normalizacija komponenata:**

Svaka komponenta se normalizira korištenjem min-max skaliranja na skalu 0 do 100:

$$
X_{norm} = \frac{X - \min(X)}{\max(X) - \min(X)} \times 100
$$

**Invertiranje sentimenta:**

Budući da negativniji sentiment (niža vrijednost) indicira veću zabrinutost, komponenta sentimenta se invertira:

$$
S_{inv} = 100 - S_{norm}
$$

Time se postiže da članci s negativnijim tonom doprinose višoj vrijednosti indeksa.

**Izbor težina:**

Težine su odabrane na temelju empirijske analize korelacije s inflacijom:

- Volumen (40%): najsnažniji prediktor jer direktno mjeri količinu medijske pozornosti
- Intenzitet (20%): indirektni pokazatelj ozbiljnosti teme
- Sentiment (20%): mjeri ton i zabrinutost u izvještavanju
- Doseg (20%): mjeri širinu distribucije vijesti

**Interpretacija vrijednosti:**

| Raspon | Interpretacija |
|--------|----------------|
| 0 do 25 | Niska medijska pozornost na inflaciju |
| 25 do 50 | Umjerena medijska pozornost |
| 50 do 75 | Visoka medijska pozornost |
| 75 do 100 | Vrlo visoka medijska pozornost (krizna razdoblja) |

**Klizni prosjek:**

Za izglađivanje mjesečnih fluktuacija se koristi 3-mjesečni klizni prosjek:

$$
\text{GIMES}_{MA3,t} = \frac{1}{3} \sum_{i=t-1}^{t+1} \text{GIMES}_i
$$

:::

```{r index-calculation}
#| label: index-calculation

index_data <- dt[, .(
  volume = .N,
  avg_length = mean(text_length, na.rm = TRUE),
  avg_sentiment = mean(sentiment_score, na.rm = TRUE),
  avg_reach = if("REACH" %in% names(.SD)) mean(REACH, na.rm = TRUE) else NA_real_,
  total_reach = if("REACH" %in% names(.SD)) sum(REACH, na.rm = TRUE) else NA_real_,
  avg_interactions = if("INTERACTIONS" %in% names(.SD)) mean(INTERACTIONS, na.rm = TRUE) else NA_real_,
  semantic_total = sum(count_all_semantic, na.rm = TRUE),
  semantic_inflacija = sum(count_inflacija_direktno, na.rm = TRUE),
  semantic_cijene = sum(count_cijene_poskupljenja, na.rm = TRUE),
  semantic_troskovi = sum(count_troskovi_zivota, na.rm = TRUE),
  semantic_energija = sum(count_energija_gorivo, na.rm = TRUE),
  semantic_hrana = sum(count_hrana, na.rm = TRUE),
  semantic_monetarna = sum(count_monetarna_politika, na.rm = TRUE),
  semantic_place = sum(count_place_primanja, na.rm = TRUE),
  semantic_indeksi = sum(count_indeksi_mjere, na.rm = TRUE)
), by = yearmonth][order(yearmonth)]

index_data[, `:=`(
  volume_norm = normalize(volume),
  length_norm = normalize(avg_length),
  sentiment_norm = normalize(avg_sentiment),
  reach_norm = normalize(avg_reach),
  semantic_norm = normalize(semantic_total)
)]

index_data[, gimes_index := 
  0.40 * volume_norm + 
  0.20 * length_norm + 
  0.20 * (100 - sentiment_norm) +
  0.20 * fifelse(is.na(reach_norm), 50, reach_norm)
]

index_data[, gimes_index_ma3 := frollmean(gimes_index, n = 3, align = "center")]
index_data[, gimes_yoy := (gimes_index / shift(gimes_index, 12) - 1) * 100]
```

## GIMES Indeks kroz vrijeme

Na sljedećem grafikonu se prikazuje GIMES indeks medijske inflacije kroz vrijeme. Indeks se kreće na skali 0 do 100, gdje viša vrijednost indicira veću medijsku pozornost na inflaciju.

```{r index-plot}
#| label: index-plot
#| fig-cap: "GIMES Indeks medijske inflacije"
#| fig-height: 7

ggplot(index_data, aes(x = yearmonth)) +
  geom_ribbon(aes(ymin = 0, ymax = gimes_index), fill = colors_gimes["accent"], alpha = 0.3) +
  geom_line(aes(y = gimes_index), color = colors_gimes["accent"], linewidth = 0.8, alpha = 0.5) +
  geom_line(aes(y = gimes_index_ma3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = gimes_index_ma3), color = colors_gimes["primary"], size = 2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20)) +
  labs(
    title = "GIMES Indeks medijske inflacije",
    subtitle = "Kompozitni indeks medijske pozornosti na inflaciju (0 do 100) | Tamna linija = 3-mjesečni klizni prosjek",
    x = NULL,
    y = "GIMES Index"
  )
```

## Komponente indeksa

Na sljedećem grafikonu se prikazuju četiri komponente GIMES indeksa. Svakom komponentom se mjeri različiti aspekt medijskog izvještavanja.

```{r index-components}
#| label: index-components
#| fig-cap: "Komponente GIMES indeksa"

components_long <- melt(
  index_data[, .(yearmonth, volume_norm, length_norm, 
                 sentiment_inv = 100 - sentiment_norm, reach_norm)],
  id.vars = "yearmonth",
  variable.name = "component",
  value.name = "value"
)

component_labels <- c(
  "volume_norm" = "Volumen (40%)",
  "length_norm" = "Intenzitet (20%)",
  "sentiment_inv" = "Negativni sentiment (20%)",
  "reach_norm" = "Doseg (20%)"
)

components_long[, component_label := component_labels[as.character(component)]]

ggplot(components_long, aes(x = yearmonth, y = value, color = component_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~component_label, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c(
    "Volumen (40%)" = colors_gimes["primary"],
    "Intenzitet (20%)" = colors_gimes["accent"],
    "Negativni sentiment (20%)" = colors_gimes["secondary"],
    "Doseg (20%)" = colors_gimes["success"]
  )) +
  labs(
    title = "Komponente GIMES indeksa",
    subtitle = "Normalizirane vrijednosti (0 do 100)",
    x = NULL,
    y = "Vrijednost",
    color = NULL
  ) +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Tablica indeksa

```{r index-table}
#| label: index-table

index_table <- index_data[, .(
  Mjesec = format(yearmonth, "%b %Y"),
  `Broj članaka` = format(volume, big.mark = ","),
  `GIMES Index` = round(gimes_index, 1),
  `Klizni prosjek` = round(gimes_index_ma3, 1),
  `YoY promjena (%)` = ifelse(is.na(gimes_yoy), "-", paste0(ifelse(gimes_yoy > 0, "+", ""), round(gimes_yoy, 1)))
)]

kable(tail(index_table, 12), 
      caption = "GIMES Indeks - zadnjih 12 mjeseci",
      align = c("l", "r", "r", "r", "r")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
  row_spec(0, bold = TRUE, background = colors_gimes["primary"], color = "white")
```

# Volatilnost i momentum

U ovoj sekciji se analizira volatilnost i momentum medijskog izvještavanja o inflaciji. Volatilnošću se mjeri nestabilnost izvještavanja, dok se momentumom mjeri smjer i brzina promjene.

## Konstrukcija volatilnosti

Volatilnost se izračunava kao standardna devijacija dnevnog broja članaka unutar svakog mjeseca. Viša volatilnost indicira nestabilnije izvještavanje s većim oscilacijama u broju objavljenih članaka.

::: {.callout-note collapse="true" title="Tehnička metodologija izračuna volatilnosti"}

**Formula za mjesečnu volatilnost:**

$$
\sigma_m = \sqrt{\frac{1}{n_m - 1} \sum_{d \in m} (N_d - \bar{N}_m)^2}
$$

gdje je:

- $\sigma_m$ = standardna devijacija broja članaka u mjesecu $m$
- $N_d$ = broj članaka na dan $d$
- $\bar{N}_m$ = prosječni dnevni broj članaka u mjesecu $m$
- $n_m$ = broj dana u mjesecu

**Normalizacija:**

Za usporedivost se volatilnost normalizira na skalu 0 do 100:

$$
\text{Vol}_{norm,m} = \frac{\sigma_m - \min(\sigma)}{\max(\sigma) - \min(\sigma)} \times 100
$$

**Interpretacija:**

- Niska volatilnost (0 do 30): Stabilno izvještavanje s ujednačenim brojem članaka
- Srednja volatilnost (30 do 60): Umjerene oscilacije u izvještavanju
- Visoka volatilnost (60 do 100): Nestabilno izvještavanje, često povezano s kriznim događajima

:::

## Konstrukcija momentuma

Momentum se izračunava kao postotna promjena GIMES indeksa u odnosu na prethodni mjesec. Pozitivan momentum indicira rastuću medijsku pozornost, dok negativan momentum indicira opadajuću pozornost.

::: {.callout-note collapse="true" title="Tehnička metodologija izračuna momentuma"}

**Formula za mjesečni momentum:**

$$
\text{Mom}_t = \frac{\text{GIMES}_t - \text{GIMES}_{t-1}}{\text{GIMES}_{t-1}} \times 100
$$

**3-mjesečni momentum:**

Za stabilniju procjenu smjera trenda se koristi 3-mjesečni momentum:

$$
\text{Mom}_{3M,t} = \frac{\text{GIMES}_t - \text{GIMES}_{t-3}}{\text{GIMES}_{t-3}} \times 100
$$

**Anualizirani momentum:**

Za usporedbu s godišnjim stopama se koristi anualizirani 3-mjesečni momentum:

$$
\text{Mom}_{ann,t} = \left(\left(1 + \frac{\text{Mom}_{3M,t}}{100}\right)^4 - 1\right) \times 100
$$

**Interpretacija:**

| Vrijednost | Interpretacija |
|------------|----------------|
| > 20% | Snažan rastući trend medijske pozornosti |
| 5% do 20% | Umjeren rastući trend |
| -5% do 5% | Stabilno razdoblje |
| -20% do -5% | Umjeren padajući trend |
| < -20% | Snažan padajući trend (normalizacija) |

:::

```{r volatility-momentum}
#| label: volatility-momentum

# Dnevna volatilnost po mjesecima
daily_by_month <- dt[, .(N = .N), by = .(yearmonth, date)]
volatility <- daily_by_month[, .(
  volatility = sd(N, na.rm = TRUE),
  mean_daily = mean(N, na.rm = TRUE),
  days = .N
), by = yearmonth]

index_data <- merge(index_data, volatility, by = "yearmonth", all.x = TRUE)
index_data[, volatility_norm := normalize(volatility)]

# Momentum
index_data[, `:=`(
  momentum_1m = (gimes_index / shift(gimes_index, 1) - 1) * 100,
  momentum_3m = (gimes_index / shift(gimes_index, 3) - 1) * 100
)]
```

```{r volatility-plot}
#| label: volatility-plot
#| fig-cap: "Volatilnost medijskog izvještavanja"
#| fig-height: 6

ggplot(index_data, aes(x = yearmonth)) +
  geom_col(aes(y = volatility_norm), fill = colors_gimes["warning"], alpha = 0.7) +
  geom_line(aes(y = gimes_index), color = colors_gimes["primary"], linewidth = 1.2) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(
    name = "Volatilnost (normalizirana)",
    sec.axis = sec_axis(~., name = "GIMES Index")
  ) +
  labs(
    title = "Volatilnost medijskog izvještavanja vs GIMES indeks",
    subtitle = "Stupci = volatilnost (nestabilnost izvještavanja) | Linija = GIMES indeks",
    x = NULL
  )
```

```{r momentum-plot}
#| label: momentum-plot
#| fig-cap: "Momentum GIMES indeksa"
#| fig-height: 6

ggplot(index_data[!is.na(momentum_3m)], aes(x = yearmonth)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_col(aes(y = momentum_3m, fill = momentum_3m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["secondary"])) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "3-mjesečni momentum GIMES indeksa",
    subtitle = "Zeleno = rastući trend | Crveno = padajući trend",
    x = NULL,
    y = "Momentum (%)"
  )
```

# Koncentracija tema (Topic Concentration)

U ovoj sekciji se analizira koliko je medijsko izvještavanje koncentrirano na pojedine sektore ili raspoređeno preko više tema. Koncentracijom se mjeri diversifikacija medijskog diskursa o inflaciji.

## Konstrukcija indeksa koncentracije

Koncentracija tema se izračunava korištenjem Herfindahl-Hirschman indeksa (HHI) primijenjenog na udjele pojedinih sektorskih kategorija u ukupnom broju semantičkih pojmova.

Visoka koncentracija indicira da mediji dominantno izvještavaju o jednom ili nekoliko aspekata inflacije, dok niska koncentracija indicira ravnomjernije pokrivanje svih tema.

::: {.callout-note collapse="true" title="Tehnička metodologija konstrukcije indeksa koncentracije"}

**Herfindahl-Hirschman indeks (HHI):**

$$
\text{HHI}_m = \sum_{c=1}^{C} s_{c,m}^2
$$

gdje je $s_{c,m}$ udio kategorije $c$ u ukupnom broju pojmova u mjesecu $m$:

$$
s_{c,m} = \frac{\text{count}_{c,m}}{\sum_{c=1}^{C} \text{count}_{c,m}}
$$

**Normalizacija na skalu 0 do 100:**

HHI se kreće između $1/C$ (savršena diversifikacija) i 1 (potpuna koncentracija). Za interpretabilnost se normalizira:

$$
\text{Conc}_{norm,m} = \frac{\text{HHI}_m - 1/C}{1 - 1/C} \times 100
$$

**Interpretacija:**

| Vrijednost | Interpretacija |
|------------|----------------|
| 0 do 20 | Vrlo diversificirano izvještavanje (sve teme podjednako zastupljene) |
| 20 do 40 | Umjerena diversifikacija |
| 40 do 60 | Umjerena koncentracija |
| 60 do 80 | Visoka koncentracija (nekoliko dominantnih tema) |
| 80 do 100 | Vrlo visoka koncentracija (jedna dominantna tema) |

**Primjena:**

- Niska koncentracija sugerira širu javnu raspravu o različitim aspektima inflacije
- Visoka koncentracija može indicirati fokus na specifičnu krizu (npr. energetska kriza)

:::

```{r topic-concentration}
#| label: topic-concentration

# Izračun udjela svake kategorije
concentration_data <- monthly_semantic[, .(
  yearmonth,
  s_inflacija = count_inflacija_direktno / count_all_semantic,
  s_cijene = count_cijene_poskupljenja / count_all_semantic,
  s_troskovi = count_troskovi_zivota / count_all_semantic,
  s_energija = count_energija_gorivo / count_all_semantic,
  s_hrana = count_hrana / count_all_semantic,
  s_monetarna = count_monetarna_politika / count_all_semantic,
  s_place = count_place_primanja / count_all_semantic,
  s_indeksi = count_indeksi_mjere / count_all_semantic
)]

# HHI izračun
concentration_data[, HHI := s_inflacija^2 + s_cijene^2 + s_troskovi^2 + s_energija^2 +
                           s_hrana^2 + s_monetarna^2 + s_place^2 + s_indeksi^2]

# Normalizacija (8 kategorija, min HHI = 1/8 = 0.125)
concentration_data[, concentration_norm := (HHI - 0.125) / (1 - 0.125) * 100]

index_data <- merge(index_data, concentration_data[, .(yearmonth, HHI, concentration_norm)], 
                    by = "yearmonth", all.x = TRUE)
```

```{r concentration-plot}
#| label: concentration-plot
#| fig-cap: "Koncentracija tema u medijskom izvještavanju"
#| fig-height: 6

ggplot(index_data, aes(x = yearmonth)) +
  geom_ribbon(aes(ymin = 0, ymax = concentration_norm), fill = colors_gimes["purple"], alpha = 0.3) +
  geom_line(aes(y = concentration_norm), color = colors_gimes["purple"], linewidth = 1.2) +
  geom_hline(yintercept = c(20, 40, 60), linetype = "dotted", color = "gray60") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20)) +
  annotate("text", x = max(index_data$yearmonth) - 90, y = 10, 
           label = "Diversificirano", color = "gray50", size = 3, fontface = "italic") +
  annotate("text", x = max(index_data$yearmonth) - 90, y = 50, 
           label = "Umjereno", color = "gray50", size = 3, fontface = "italic") +
  annotate("text", x = max(index_data$yearmonth) - 90, y = 80, 
           label = "Koncentrirano", color = "gray50", size = 3, fontface = "italic") +
  labs(
    title = "Koncentracija tema u medijskom izvještavanju o inflaciji",
    subtitle = "HHI-based indeks | Niže vrijednosti = diversificiraniji diskurs",
    x = NULL,
    y = "Koncentracija (0 do 100)"
  )
```

# Pregled svih indeksa

U ovoj sekciji se prikazuje usporedni pregled svih konstruiranih indeksa na jednom grafikonu. Time se omogućuje usporedba dinamika različitih aspekata medijskog izvještavanja.

```{r all-indices-plot}
#| label: all-indices-plot
#| fig-cap: "Pregled svih konstruiranih indeksa"
#| fig-height: 10

all_indices <- melt(
  index_data[, .(yearmonth, 
                 `GIMES Index` = gimes_index,
                 `Volumen (norm.)` = volume_norm,
                 `Sentiment (inv.)` = 100 - sentiment_norm,
                 `Volatilnost` = volatility_norm,
                 `Koncentracija` = concentration_norm,
                 `Semantički ukupno` = semantic_norm)],
  id.vars = "yearmonth",
  variable.name = "indeks",
  value.name = "vrijednost"
)

ggplot(all_indices, aes(x = yearmonth, y = vrijednost, color = indeks)) +
  geom_line(linewidth = 1) +
  geom_point(size = 1.5, alpha = 0.6) +
  facet_wrap(~indeks, ncol = 2, scales = "fixed") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_y_continuous(limits = c(0, 100)) +
  scale_color_manual(values = c(
    "GIMES Index" = colors_gimes["primary"],
    "Volumen (norm.)" = colors_gimes["accent"],
    "Sentiment (inv.)" = colors_gimes["secondary"],
    "Volatilnost" = colors_gimes["warning"],
    "Koncentracija" = colors_gimes["purple"],
    "Semantički ukupno" = colors_gimes["success"]
  )) +
  labs(
    title = "Pregled svih konstruiranih indeksa medijske inflacije",
    subtitle = "Svi indeksi normalizirani na skalu 0 do 100",
    x = NULL,
    y = "Vrijednost indeksa",
    color = NULL
  ) +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))
```

# Validacija sa službenim podacima

## Dohvaćanje službenih podataka

```{r load-official-data}
#| label: load-official-data

eurostat_headline <- NULL
tryCatch({
  hicp_data <- get_eurostat("prc_hicp_manr", 
                            filters = list(geo = "HR", 
                                          coicop = "CP00",
                                          unit = "RCH_A"),
                            time_format = "date")
  setDT(hicp_data)
  eurostat_headline <- hicp_data[time >= "2021-01-01" & time <= "2024-11-01", 
                                   .(yearmonth = time, eurostat_hicp = values)]
}, error = function(e) {
  eurostat_headline <<- data.table(
    yearmonth = seq(as.Date("2021-01-01"), as.Date("2024-11-01"), by = "month"),
    eurostat_hicp = c(
      0.2, 0.6, 0.8, 1.9, 2.4, 2.3, 2.6, 3.0, 3.3, 3.8, 4.8, 5.5,
      5.8, 6.3, 7.3, 9.4, 10.8, 12.1, 12.3, 12.4, 12.8, 13.0, 13.0, 12.7,
      12.0, 11.1, 10.5, 9.2, 8.4, 8.2, 7.3, 7.7, 7.1, 5.3, 4.9, 4.7,
      4.3, 4.0, 3.9, 3.7, 3.6, 3.4, 3.2, 2.9, 2.8, 2.6, 2.4
    )
  )
})

eurostat_core <- NULL
tryCatch({
  core_data <- get_eurostat("prc_hicp_manr",
                           filters = list(geo = "HR",
                                         coicop = "CP00XEF",
                                         unit = "RCH_A"),
                           time_format = "date")
  setDT(core_data)
  eurostat_core <<- core_data[time >= "2021-01-01" & time <= "2024-11-01",
                              .(yearmonth = time, eurostat_core = values)]
}, error = function(e) {
  eurostat_core <<- data.table(
    yearmonth = seq(as.Date("2021-01-01"), as.Date("2024-11-01"), by = "month"),
    eurostat_core = c(
      0.5, 0.8, 1.0, 1.5, 1.8, 1.9, 2.0, 2.2, 2.4, 2.7, 3.2, 3.8,
      4.2, 4.8, 5.6, 6.8, 7.9, 8.7, 8.9, 9.1, 9.4, 9.8, 10.2, 10.5,
      10.8, 10.5, 10.0, 9.2, 8.5, 8.0, 7.2, 7.4, 7.0, 6.2, 5.8, 5.5,
      5.2, 4.9, 4.6, 4.3, 4.1, 3.8, 3.5, 3.3, 3.2, 3.0, 2.9
    )
  )
})

comparison <- merge(index_data, eurostat_headline, by = "yearmonth", all.x = TRUE)
comparison <- merge(comparison, eurostat_core, by = "yearmonth", all.x = TRUE)
```

## GIMES vs Eurostat HICP

```{r gimes-vs-hicp}
#| label: gimes-vs-hicp
#| fig-cap: "GIMES indeks vs Eurostat HICP inflacija"
#| fig-height: 7

coef_hicp <- 100 / max(comparison$eurostat_hicp, na.rm = TRUE)

ggplot(comparison, aes(x = yearmonth)) +
  geom_line(aes(y = gimes_index, color = "GIMES Index"), linewidth = 1.2) +
  geom_point(aes(y = gimes_index), color = colors_gimes["primary"], size = 2, alpha = 0.6) +
  geom_line(aes(y = eurostat_hicp * coef_hicp, color = "Eurostat HICP"), 
            linewidth = 1.2, linetype = "solid") +
  geom_point(aes(y = eurostat_hicp * coef_hicp), color = colors_gimes["secondary"], 
             size = 2, alpha = 0.6) +
  scale_y_continuous(
    name = "GIMES Index (0 do 100)",
    sec.axis = sec_axis(~./coef_hicp, name = "HICP (YoY %)", 
                       labels = function(x) paste0(x, "%"))
  ) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_color_manual(values = c("GIMES Index" = colors_gimes["primary"], 
                                "Eurostat HICP" = colors_gimes["secondary"])) +
  labs(
    title = "GIMES indeks medijske inflacije vs Eurostat HICP",
    subtitle = "Usporedba medijske percepcije i službene inflacije",
    x = NULL,
    color = NULL
  ) +
  theme(
    axis.title.y.right = element_text(color = colors_gimes["secondary"], face = "bold"),
    axis.text.y.right = element_text(color = colors_gimes["secondary"]),
    axis.title.y.left = element_text(color = colors_gimes["primary"], face = "bold")
  )
```

## Korelacijska matrica indeksa i sektora

Na sljedećoj korelacijskoj matrici se prikazuju međusobni odnosi između svih konstruiranih indeksa i sektorskih kategorija. Pozitivna korelacija (crvena) ukazuje na to da dva indeksa tendiraju rasti i padati zajedno, dok negativna korelacija (plava) ukazuje na obrnuti odnos.

```{r correlation-matrix}
#| label: correlation-matrix
#| fig-cap: "Korelacijska matrica indeksa i sektora"
#| fig-height: 12

# Spoji sektorske indekse s glavnim indeksima
cor_data_full <- merge(
  index_data[, .(yearmonth, gimes_index, volume_norm, 
                 sentiment_inv = 100 - sentiment_norm, 
                 volatility_norm, concentration_norm, semantic_norm)],
  monthly_semantic[, .(yearmonth, idx_inflacija, idx_cijene, idx_troskovi, 
                       idx_energija, idx_hrana, idx_monetarna, idx_place, idx_indeksi)],
  by = "yearmonth"
)

# Dodaj HICP
cor_data_full <- merge(cor_data_full, eurostat_headline, by = "yearmonth", all.x = TRUE)

# Pripremi matricu
cor_vars_full <- c("gimes_index", "volume_norm", "sentiment_inv", "volatility_norm", 
                   "concentration_norm", "semantic_norm", "eurostat_hicp",
                   "idx_inflacija", "idx_cijene", "idx_troskovi", "idx_energija",
                   "idx_hrana", "idx_monetarna", "idx_place", "idx_indeksi")

cor_matrix_full <- cor(cor_data_full[, .SD, .SDcols = cor_vars_full], use = "pairwise.complete.obs")

# Preimenuj za čitljivost
nice_names <- c("GIMES", "Volumen", "Sentiment", "Volatilnost", "Koncentracija", 
                "Sem. ukupno", "HICP",
                "S: Inflacija", "S: Cijene", "S: Troškovi", "S: Energija",
                "S: Hrana", "S: Monetarna", "S: Plaće", "S: Indeksi")
rownames(cor_matrix_full) <- nice_names
colnames(cor_matrix_full) <- nice_names

corrplot(cor_matrix_full,
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.7,
         addCoef.col = "black",
         number.cex = 0.5,
         col = colorRampPalette(c(colors_gimes["accent"], "white", colors_gimes["secondary"]))(100),
         title = "Korelacijska matrica indeksa i sektora",
         mar = c(0, 0, 2, 0))
```

## Korelacije samo između indeksa

```{r correlation-indices-only}
#| label: correlation-indices-only
#| fig-cap: "Korelacije između glavnih indeksa"
#| fig-height: 8

cor_vars_indices <- c("gimes_index", "volume_norm", "sentiment_inv", "volatility_norm", 
                      "concentration_norm", "semantic_norm", "eurostat_hicp")

cor_matrix_indices <- cor(cor_data_full[, .SD, .SDcols = cor_vars_indices], use = "pairwise.complete.obs")

nice_names_indices <- c("GIMES", "Volumen", "Sentiment (inv.)", "Volatilnost", 
                        "Koncentracija", "Sem. ukupno", "HICP")
rownames(cor_matrix_indices) <- nice_names_indices
colnames(cor_matrix_indices) <- nice_names_indices

corrplot(cor_matrix_indices,
         method = "color",
         type = "upper",
         order = "original",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.9,
         addCoef.col = "black",
         number.cex = 0.7,
         col = colorRampPalette(c(colors_gimes["accent"], "white", colors_gimes["secondary"]))(100),
         title = "Korelacije između glavnih indeksa",
         mar = c(0, 0, 2, 0))
```

## Korelacijska tablica

```{r correlation-table}
#| label: correlation-table

correlations <- data.table(
  Usporedba = c(
    "GIMES Index vs Eurostat HICP",
    "GIMES Index vs Eurostat Core",
    "Volumen (broj članaka) vs Eurostat HICP",
    "Semantički indeks (ukupno) vs Eurostat HICP",
    "Sentiment (invertiran) vs Eurostat HICP",
    "Volatilnost vs Eurostat HICP",
    "Koncentracija vs Eurostat HICP"
  ),
  Korelacija = c(
    round(cor(comparison$gimes_index, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$gimes_index, comparison$eurostat_core, use = "complete.obs"), 3),
    round(cor(comparison$volume, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$semantic_total, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(100 - comparison$sentiment_norm, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$volatility_norm, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$concentration_norm, comparison$eurostat_hicp, use = "complete.obs"), 3)
  )
)

kable(correlations, caption = "Korelacije između indeksa i službene inflacije") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(which.max(correlations$Korelacija), bold = TRUE, background = colors_gimes["success"])
```

# Analiza prediktivnosti

## Cross-correlation analiza

Unakrsnom korelacijskom analizom se ispituju lead/lag odnosi između GIMES indeksa i službene inflacije. Negativan pomak ukazuje na to da GIMES predvodi inflaciju, dok pozitivan pomak ukazuje na to da GIMES prati inflaciju.

::: {.callout-note collapse="true" title="Tehnička metodologija cross-correlation analize"}

**Unakrsna korelacija:**

$$
r_{XY}(k) = \frac{\sum_{t=1}^{n-|k|}(X_t - \bar{X})(Y_{t+k} - \bar{Y})}{\sqrt{\sum_{t}(X_t - \bar{X})^2 \sum_{t}(Y_t - \bar{Y})^2}}
$$

gdje je $k$ pomak (lag), $X$ je GIMES indeks, a $Y$ je HICP inflacija.

**Interpretacija:**

- $k < 0$: korelacija između GIMES u vremenu $t$ i HICP u vremenu $t+|k|$ (GIMES predvodi)
- $k = 0$: istovremena korelacija
- $k > 0$: korelacija između GIMES u vremenu $t$ i HICP u vremenu $t-k$ (GIMES prati)

**Statistička značajnost:**

Približne granice značajnosti pri razini 95% su $\pm \frac{2}{\sqrt{n}}$ gdje je $n$ broj opažanja.

:::

```{r ccf-analysis}
#| label: ccf-analysis
#| fig-cap: "Unakrsna korelacija: GIMES vs HICP"

comparison_complete <- comparison[!is.na(gimes_index) & !is.na(eurostat_hicp)]

if(nrow(comparison_complete) >= 24) {
  ccf_result <- ccf(
    comparison_complete$gimes_index,
    comparison_complete$eurostat_hicp,
    lag.max = 12,
    plot = FALSE,
    na.action = na.pass
  )
  
  ccf_df <- data.table(
    lag = ccf_result$lag[,,1],
    correlation = ccf_result$acf[,,1]
  )
  
  max_corr <- ccf_df[which.max(abs(correlation))]
  
  ggplot(ccf_df, aes(x = lag, y = correlation)) +
    geom_hline(yintercept = 0, color = "gray50") +
    geom_hline(yintercept = c(-0.2, 0.2), linetype = "dashed", color = "gray70") +
    geom_segment(aes(xend = lag, yend = 0), linewidth = 1.5, color = colors_gimes["accent"]) +
    geom_point(size = 3, color = colors_gimes["primary"]) +
    geom_vline(xintercept = max_corr$lag, color = colors_gimes["secondary"], 
               linetype = "dashed", linewidth = 1) +
    annotate("text", x = max_corr$lag, y = max_corr$correlation + 0.1,
             label = paste0("Max: pomak=", max_corr$lag, 
                          "\nr=", round(max_corr$correlation, 3)),
             color = colors_gimes["secondary"], fontface = "bold") +
    scale_x_continuous(breaks = seq(-12, 12, 2)) +
    labs(
      title = "Unakrsna korelacija: GIMES indeks i HICP inflacija",
      subtitle = "Negativni pomak = GIMES predvodi inflaciju | Pozitivni pomak = GIMES prati inflaciju",
      x = "Pomak (mjeseci)",
      y = "Korelacija"
    )
}
```

## Korelacije s pomacima

```{r lag-correlations}
#| label: lag-correlations

lags <- -6:6
correlations_lag <- sapply(lags, function(lag) {
  if(lag < 0) {
    x <- comparison$gimes_index[1:(nrow(comparison) + lag)]
    y <- comparison$eurostat_hicp[(abs(lag) + 1):nrow(comparison)]
  } else if(lag > 0) {
    x <- comparison$gimes_index[(lag + 1):nrow(comparison)]
    y <- comparison$eurostat_hicp[1:(nrow(comparison) - lag)]
  } else {
    x <- comparison$gimes_index
    y <- comparison$eurostat_hicp
  }
  cor(x, y, use = "complete.obs")
})

lag_table <- data.table(
  Pomak = lags,
  Opis = c(
    "GIMES -6 mjeseci",
    "GIMES -5 mjeseci",
    "GIMES -4 mjeseci",
    "GIMES -3 mjeseci",
    "GIMES -2 mjeseci",
    "GIMES -1 mjesec",
    "Istovremeno",
    "HICP -1 mjesec",
    "HICP -2 mjeseca",
    "HICP -3 mjeseca",
    "HICP -4 mjeseca",
    "HICP -5 mjeseci",
    "HICP -6 mjeseci"
  ),
  Korelacija = round(correlations_lag, 3)
)[order(-Korelacija)]

kable(lag_table, 
      caption = "Korelacije GIMES indeksa i HICP inflacije sa različitim vremenskim pomacima",
      align = c("c", "l", "r")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(which.max(lag_table$Korelacija), bold = TRUE, background = colors_gimes["success"])
```

# Sezonska prilagodba i dinamike

U ovoj sekciji se proširuje Y/y perspektiva s alternativnim dinamikama uključujući M/m (mjesec na mjesec) sezonski prilagođene stope te 3M i 6M anualizirane stope.

## Sezonska prilagodba

Sezonska prilagodba se provodi korištenjem STL (Seasonal and Trend decomposition using Loess) dekompozicije.

::: {.callout-note collapse="true" title="Tehnička metodologija sezonske prilagodbe"}

**STL dekompozicija:**

Vremenska serija $Y_t$ se rastavlja na tri komponente:

$$
Y_t = T_t + S_t + R_t
$$

gdje je:

- $T_t$ = trend komponenta
- $S_t$ = sezonska komponenta
- $R_t$ = ostatak (residual)

**Sezonski prilagođena serija:**

$$
Y_{SA,t} = T_t + R_t = Y_t - S_t
$$

**M/M sezonski prilagođena stopa:**

$$
\text{M/M}_{SA,t} = \left(\frac{Y_{SA,t}}{Y_{SA,t-1}} - 1\right) \times 100
$$

**Anualizirana stopa:**

$$
\text{Ann}_t = \left(\left(1 + \frac{r_t}{100}\right)^{n} - 1\right) \times 100
$$

gdje je $r_t$ periodična stopa promjene, a $n$ broj perioda u godini.

:::

```{r seasonal-adjustment}
#| label: seasonal-adjustment

gimes_ts <- ts(index_data$gimes_index, 
               start = c(year(min(index_data$yearmonth)), month(min(index_data$yearmonth))),
               frequency = 12)

stl_gimes <- tryCatch({
  stl(gimes_ts, s.window = "periodic", robust = TRUE)
}, error = function(e) NULL)

if(!is.null(stl_gimes)) {
  index_data[, gimes_sa := as.numeric(seasadj(stl_gimes))]
} else {
  index_data[, gimes_sa := gimes_index]
}

# Izračun dinamika
annualize_rate <- function(rate, periods_per_year) {
  ((1 + rate/100)^periods_per_year - 1) * 100
}

index_data[, `:=`(
  gimes_mom_sa = (gimes_sa / shift(gimes_sa, 1) - 1) * 100,
  gimes_yoy_pct = (gimes_index / shift(gimes_index, 12) - 1) * 100
)]

index_data[, gimes_3m_avg := frollmean(gimes_sa, n = 3, align = "right")]
index_data[, gimes_3m_prev := shift(gimes_3m_avg, 3)]
index_data[, gimes_3m_ann := annualize_rate((gimes_3m_avg / gimes_3m_prev - 1) * 100, 4)]

index_data[, gimes_6m_avg := frollmean(gimes_sa, n = 6, align = "right")]
index_data[, gimes_6m_prev := shift(gimes_6m_avg, 6)]
index_data[, gimes_6m_ann := annualize_rate((gimes_6m_avg / gimes_6m_prev - 1) * 100, 2)]
```

```{r dynamics-comparison}
#| label: dynamics-comparison
#| fig-cap: "Usporedba različitih dinamika GIMES indeksa"
#| fig-height: 10

dynamics_df <- index_data[, .(
  yearmonth,
  `Y/Y (%)` = gimes_yoy_pct,
  `M/M SA (%)` = gimes_mom_sa,
  `3M ann. SA (%)` = gimes_3m_ann,
  `6M ann. SA (%)` = gimes_6m_ann
)]

dynamics_long <- melt(dynamics_df, id.vars = "yearmonth",
                      variable.name = "dinamika", value.name = "stopa")

ggplot(dynamics_long[!is.na(stopa)], aes(x = yearmonth, y = stopa, color = dinamika)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_line(linewidth = 1) +
  facet_wrap(~dinamika, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c(
    "Y/Y (%)" = colors_gimes["primary"],
    "M/M SA (%)" = colors_gimes["accent"],
    "3M ann. SA (%)" = colors_gimes["success"],
    "6M ann. SA (%)" = colors_gimes["warning"]
  )) +
  labs(
    title = "Usporedba različitih dinamika GIMES indeksa",
    subtitle = "Y/Y = godina na godinu | M/M SA = mjesec na mjesec sezonski prilagođeno | XM ann. SA = X-mjesečna anualizirana SA",
    x = NULL,
    y = "Promjena (%)",
    color = NULL
  ) +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))
```

# Zaključci i implikacije

## Ključni nalazi

U ovoj analizi je konstruiran GIMES indeks medijske inflacije te je provedena validacija s službenim podacima o inflaciji. Analizom semantičkih pojmova je pokazano koje kategorije najbolje prate službenu inflaciju.

```{r summary-findings}
#| label: summary-findings

peak_month <- index_data[which.max(gimes_index), yearmonth]
peak_value <- index_data[which.max(gimes_index), gimes_index]

peak_inflation_month <- comparison[which.max(eurostat_hicp), yearmonth]
peak_inflation_value <- comparison[which.max(eurostat_hicp), eurostat_hicp]

findings <- data.table(
  Nalaz = c(
    "Ukupno analiziranih članaka",
    "Vremenski raspon analize",
    "Broj izvora",
    "",
    "Vrh GIMES indeksa",
    "Vrijednost vrha",
    "",
    "Vrh inflacije (HICP)",
    "Vrijednost vrha",
    "",
    "Korelacija GIMES vs HICP",
    "Korelacija Semantički vs HICP",
    "Optimalni pomak",
    "",
    "Prosječna duljina članka",
    "Dominantan sentiment"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%m/%Y"), "-", format(max(dt$date), "%m/%Y")),
    as.character(length(unique(dt$FROM))),
    "",
    format(peak_month, "%B %Y"),
    round(peak_value, 1),
    "",
    format(peak_inflation_month, "%B %Y"),
    paste0(round(peak_inflation_value, 1), "%"),
    "",
    round(cor(comparison$gimes_index, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$semantic_total, comparison$eurostat_hicp, use = "complete.obs"), 3),
    paste0(lags[which.max(abs(correlations_lag))], " mjeseci"),
    "",
    paste0(format(round(median(dt$text_length)), big.mark = ","), " znakova"),
    ifelse(sum(dt$AUTO_SENTIMENT == -1, na.rm = TRUE) > sum(dt$AUTO_SENTIMENT == 1, na.rm = TRUE),
           "Negativan", "Pozitivan/Neutralan")
  )
)

kable(findings, caption = "Sažetak ključnih nalaza analize") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(c(4, 7, 10, 14), background = colors_gimes["light"])
```

## Export komponenti indeksa u Excel

```{r export-components-excel}
#| label: export-components-excel

export_data <- index_data[, .(
  Datum = yearmonth,
  Godina = year(yearmonth),
  Mjesec = month(yearmonth),
  Broj_clanaka = volume,
  Prosjecna_duljina = round(avg_length, 0),
  Prosjecni_sentiment = round(avg_sentiment, 3),
  Prosjecni_reach = round(avg_reach, 0),
  Semantic_ukupno = semantic_total,
  Semantic_inflacija = semantic_inflacija,
  Semantic_cijene = semantic_cijene,
  Semantic_troskovi = semantic_troskovi,
  Semantic_energija = semantic_energija,
  Semantic_hrana = semantic_hrana,
  Semantic_monetarna = semantic_monetarna,
  Semantic_place = semantic_place,
  Semantic_indeksi = semantic_indeksi,
  Volume_norm = round(volume_norm, 2),
  Length_norm = round(length_norm, 2),
  Sentiment_norm = round(sentiment_norm, 2),
  Sentiment_inv = round(100 - sentiment_norm, 2),
  Reach_norm = round(reach_norm, 2),
  Semantic_norm = round(semantic_norm, 2),
  Volatility_norm = round(volatility_norm, 2),
  Concentration_norm = round(concentration_norm, 2),
  GIMES_index = round(gimes_index, 2),
  GIMES_MA3 = round(gimes_index_ma3, 2),
  GIMES_YoY = round(gimes_yoy, 2)
)]

wb <- createWorkbook()

addWorksheet(wb, "Komponente_indeksa")
writeData(wb, "Komponente_indeksa", export_data)

header_style <- createStyle(
  textDecoration = "bold",
  fgFill = "#2C3E50",
  fontColour = "white",
  halign = "center"
)
addStyle(wb, "Komponente_indeksa", header_style, rows = 1, cols = 1:ncol(export_data))
setColWidths(wb, "Komponente_indeksa", cols = 1:ncol(export_data), widths = "auto")

output_path <- here("output", "gimes_komponente_indeksa.xlsx")
dir.create(here("output"), showWarnings = FALSE, recursive = TRUE)
saveWorkbook(wb, output_path, overwrite = TRUE)
```

---

*Izvještaj generiran: `r Sys.time()`*

*GIMES Research | Analiza medijske pokrivenosti inflacije v2.0*
