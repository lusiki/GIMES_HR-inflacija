---
title: "Analiza medijske pokrivenosti inflacije u Hrvatskoj"
subtitle: "Eksploratorni pregled, konstrukcija indeksa i analiza prediktivnosti"
author: "GIMES Research"
date: today
format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    theme: cosmo
    code-fold: true
    code-summary: "Prikaži kod"
    fig-width: 11
    fig-height: 7
    df-print: paged
    embed-resources: true
execute:
  warning: false
  message: false
  echo: false
lang: hr
---

```{r setup}
#| label: setup
#| include: false

# Core data manipulation
library(data.table)
library(lubridate)
library(stringi)

# Visualization
library(ggplot2)
library(scales)
library(plotly)
library(corrplot)
library(patchwork)

# Tables and output
library(knitr)
library(kableExtra)
library(openxlsx)

# Time series
library(zoo)
library(forecast)

# Project management
library(here)

# Topic specific libraries
library(eurostat)

colors_gimes <- c(
  "primary"   = "#2C3E50",
  "secondary" = "#E74C3C",
  "accent"    = "#3498DB",
  "success"   = "#27AE60",
  "warning"   = "#F39C12",
  "danger"    = "#C0392B",
  "light"     = "#ECF0F1",
  "purple"    = "#9B59B6",
  "teal"      = "#1ABC9C",
  "muted"     = "#7F8C8D"
)

options(scipen = 999)

theme_gimes <- function() {
  theme_minimal(base_size = 12) +
    theme(
      plot.title = element_text(face = "bold", size = 14, color = colors_gimes["primary"]),
      plot.subtitle = element_text(size = 10, color = "gray40"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      axis.text = element_text(size = 9),
      strip.text = element_text(face = "bold", size = 10)
    )
}

theme_set(theme_gimes())
```

# Uvod

U ovom izvještaju se predstavlja sveobuhvatna analiza medijske pokrivenosti inflacije u Hrvatskoj. Analizom se obuhvaća praćenje inflacijskih tema, cijena, troškova života, energetskih cijena i monetarne politike temeljem članaka iz hrvatskih online medija.

## Motivacija i kontekst

Inflacija je tijekom 2022. i 2023. godine postala središnja tema ekonomske rasprave u Hrvatskoj i šire. Ovim izvještajem se nastoji odgovoriti na ključna pitanja:

1. Kako se medijsko izvještavanje o inflaciji razvijalo kroz vrijeme?
2. Je li medijska pozornost odgovarala stvarnim inflacijskim pritiscima?
3. Može li se medijska pozornost koristiti kao prediktor ili rani indikator inflacije?
4. Koje su teme i aspekti inflacije najzastupljeniji u medijima?

## Struktura izvještaja

U izvještaju se obrađuju sljedeće teme: metodologija identifikacije relevantnih članaka, eksploratorni pregled dataseta, semantička taksonomija inflacijskih pojmova, konstrukcija specijaliziranih indeksa, vizualizacija indeksa, sektorska analiza, sentiment analiza, volatilnost i momentum, koncentracija tema te validacija sa službenim Eurostat HICP podacima.

```{r load-data}
#| label: load-data

#dt <- as.data.table(read.xlsx(here("data", "inflation_filtered.xlsx")))
dt <- as.data.table(read.xlsx("C:/Users/lsikic/Desktop/inflacija_filtered.xlsx"))

# Date conversion
if (is.numeric(dt$DATE)) {
  dt[, DATE := as.Date(DATE, origin = "1899-12-30")]
} else {
  dt[, DATE := as.Date(DATE)]
}

# Numeric conversions
if ("text_length" %in% names(dt)) dt[, text_length := as.numeric(text_length)]
if ("REACH" %in% names(dt)) dt[, REACH := as.numeric(REACH)]
if ("INTERACTIONS" %in% names(dt)) dt[, INTERACTIONS := as.numeric(INTERACTIONS)]

# Time variables (include both weekly and quarterly)
dt[, `:=`(
  date = DATE,
  year = year(DATE),
  month = month(DATE),
  week = isoweek(DATE),
  quarter = quarter(DATE),
  yearmonth = floor_date(DATE, "month"),
  yearweek = floor_date(DATE, "week"),
  yearquarter = floor_date(DATE, "quarter")
)]

# Store date range
date_min <- min(dt$date, na.rm = TRUE)
date_max <- max(dt$date, na.rm = TRUE)

cat("Učitano", format(nrow(dt), big.mark = ","), "članaka\n")
cat("Vremenski raspon:", format(date_min, "%d.%m.%Y"), "do", format(date_max, "%d.%m.%Y"), "\n")
```

# Metodologija identifikacije članaka

## Pregled procesa filtriranja

Identifikacija relevantnih članaka se provodi kroz sedmostupanjski proces filtriranja koji kombinira strukturne kriterije, ključne riječi i kontekstualnu validaciju. Procesom se osigurava da u analizu ulaze samo članci koji su stvarno relevantni za hrvatsku inflacijsku tematiku.

::: {.callout-note collapse="true" title="Detaljna metodologija filtriranja"}

**Filter 1: Tip izvora**

Odabiru se samo web izvori kako bi se osigurala konzistentnost formata i dostupnost punog teksta članka.

**Filter 2: Relevantni news portali**

Koristi se lista verificiranih hrvatskih news portala kategoriziranih u pet skupina: nacionalni mediji, poslovni mediji, regionalni mediji, specijalizirani mediji i opinion portali.

**Filter 3: Minimalna duljina teksta**

Članci moraju sadržavati minimalno 500 znakova u punom tekstu kako bi se osigurala sadržajna relevantnost.

**Filter 4: Naslov članka**

Naslov članka mora sadržavati inflacijske pojmove definirane regularnim izrazima koji obuhvaćaju morfološke varijante.

**Filter 5: Core inflacijski pojmovi**

Puni tekst članka mora sadržavati core inflacijske pojmove koji potvrđuju da se članak bavi inflacijskom tematikom.

**Filter 6: Isključivanje irelevantnog sadržaja**

Isključuju se članci koji ne tretiraju inflaciju kao primarnu temu.

**Filter 7: Hrvatski kontekst**

Članci moraju sadržavati reference na hrvatsku ekonomiju (Hrvatska, hrvatski, HNB, eurozona HR kontekst).

:::

# Eksploratorni pregled podataka

## Osnovne statistike

```{r basic-stats}
#| label: basic-stats

stats_summary <- data.table(
  Metrika = c(
    "Ukupan broj članaka",
    "Vremenski raspon",
    "Broj dana",
    "Prosječno članaka dnevno",
    "Broj izvora (portala)",
    "Broj kategorija izvora"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%d.%m.%Y"), "do", format(max(dt$date), "%d.%m.%Y")),
    as.character(as.numeric(max(dt$date) - min(dt$date))),
    round(nrow(dt) / as.numeric(max(dt$date) - min(dt$date)), 1),
    length(unique(dt$FROM)),
    length(unique(dt$source_category))
  )
)

kable(stats_summary, col.names = c("Metrika", "Vrijednost"),
      caption = "Osnovne statistike dataseta") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Distribucija po kategorijama izvora

```{r source-category}
#| label: source-category
#| fig-cap: "Distribucija članaka po kategorijama izvora"

cat_summary <- dt[, .(
  N = .N,
  Postotak = round(.N / nrow(dt) * 100, 1)
), by = source_category][order(-N)]

ggplot(cat_summary, aes(x = reorder(source_category, N), y = N, fill = source_category)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(format(N, big.mark = ","), "\n(", Postotak, "%)")), 
            hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_manual(values = c("national" = colors_gimes["primary"],
                               "business" = colors_gimes["accent"],
                               "regional" = colors_gimes["success"],
                               "specialized" = colors_gimes["warning"],
                               "opinion" = colors_gimes["secondary"])) +
  labs(
    title = "Broj članaka po kategoriji izvora",
    x = NULL,
    y = "Broj članaka"
  )
```

## Top 20 izvora

```{r top-sources}
#| label: top-sources
#| fig-cap: "20 najaktivnijih izvora"

top_sources <- dt[, .(N = .N), by = FROM][order(-N)][1:20]

ggplot(top_sources, aes(x = reorder(FROM, N), y = N)) +
  geom_col(fill = colors_gimes["primary"]) +
  geom_text(aes(label = format(N, big.mark = ",")), hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Top 20 izvora po broju članaka o inflaciji",
    x = NULL,
    y = "Broj članaka"
  )
```

## Distribucija duljine teksta

```{r text-length}
#| label: text-length
#| fig-cap: "Distribucija duljine članaka"

if ("text_length" %in% names(dt)) {
  ggplot(dt, aes(x = text_length)) +
    geom_histogram(bins = 50, fill = colors_gimes["primary"], alpha = 0.8, color = "white") +
    geom_vline(xintercept = median(dt$text_length, na.rm = TRUE), 
               color = colors_gimes["secondary"], linetype = "dashed", linewidth = 1) +
    annotate("text", x = median(dt$text_length, na.rm = TRUE) + 500, 
             y = Inf, vjust = 2, hjust = 0,
             label = paste("Medijan:", format(round(median(dt$text_length, na.rm = TRUE)), big.mark = ",")),
             color = colors_gimes["secondary"], fontface = "bold") +
    scale_x_continuous(labels = comma) +
    scale_y_continuous(labels = comma) +
    labs(
      title = "Distribucija duljine članaka",
      subtitle = "Broj znakova u punom tekstu",
      x = "Broj znakova",
      y = "Broj članaka"
    )
}
```

# Semantička taksonomija

## Hijerarhijska struktura pojmova

Semantička taksonomija se organizira u osam kategorija koje obuhvaćaju različite aspekte inflacije. Svaka kategorija predstavlja specifičan sektor ili tematsko područje vezano uz inflaciju. Pojmovi se definiraju pomoću korijena riječi (stem) kako bi se osigurala šira morfološka pokrivenost hrvatskog jezika.

::: {.callout-note collapse="true" title="Detaljna metodologija semantičke taksonomije"}

**Princip konstrukcije rječnika:**

1. Kategorije predstavljaju konceptualno različite aspekte inflacije
2. Regex uzorci se koriste za fleksibilno prepoznavanje morfoloških varijanti
3. Korijenski oblici osiguravaju prepoznavanje svih padežnih i glagolskih oblika

**Formula za brojanje:**

$$
\text{count}_{c,d} = \sum_{p \in P_c} \text{matches}(p, d)
$$

gdje je $P_c$ skup regex uzoraka za kategoriju $c$, a $d$ je tekst dokumenta.

:::

```{r semantic-dictionary}
#| label: semantic-dictionary

semantic_terms <- list(
  
  inflacija_direktno = c(
    "inflacij[a-zčćžšđ]*",
    "dezinflacij[a-zčćžšđ]*",
    "hiperinflacij[a-zčćžšđ]*",
    "stagflacij[a-zčćžšđ]*"
  ),
  
  cijene_poskupljenja = c(
    "poskupljenj[a-zčćžšđ]*",
    "poskupi[a-zčćžšđ]*",
    "porast.{0,10}cijen[a-zčćžšđ]*",
    "rast.{0,10}cijen[a-zčćžšđ]*",
    "vi[sš][aeiou]+.{0,10}cijen[a-zčćžšđ]*",
    "skok.{0,10}cijen[a-zčćžšđ]*",
    "skupo[cć][a-zčćžšđ]*",
    "skuplj[a-zčćžšđ]*"
  ),
  
  troskovi_zivota = c(
    "tro[sš]kov[a-zčćžšđ]*.{0,10}[zž]ivot[a-zčćžšđ]*",
    "[zž]ivotn[a-zčćžšđ]*.{0,10}standard[a-zčćžšđ]*",
    "kupovn[a-zčćžšđ]*.{0,10}mo[cć][a-zčćžšđ]*",
    "egzistencij[a-zčćžšđ]*"
  ),
  
  energija_gorivo = c(
    "cijen[a-zčćžšđ]*.{0,10}energij[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}goriv[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}struj[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}plin[a-zčćžšđ]*",
    "energetsk[a-zčćžšđ]*.{0,10}kriz[a-zčćžšđ]*"
  ),
  
  hrana = c(
    "cijen[a-zčćžšđ]*.{0,10}hran[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}namirnic[a-zčćžšđ]*",
    "prehramben[a-zčćžšđ]*.{0,10}proizvod[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}kruh[a-zčćžšđ]*",
    "cijen[a-zčćžšđ]*.{0,10}mlijeka?"
  ),
  
  monetarna_politika = c(
    "kamatn[a-zčćžšđ]*.{0,10}stop[a-zčćžšđ]*",
    "kamat[a-zčćžšđ]*",
    "\\bhnb\\b",
    "\\becb\\b",
    "monetarn[a-zčćžšđ]*.{0,10}politik[a-zčćžšđ]*",
    "euroz[ao]n[a-zčćžšđ]*"
  ),
  
  place_primanja = c(
    "pla[cć][a-zčćžšđ]*",
    "primanj[a-zčćžšđ]*",
    "mirovin[a-zčćžšđ]*",
    "realn[a-zčćžšđ]*.{0,10}pla[cć][a-zčćžšđ]*",
    "rast.{0,10}pla[cć][a-zčćžšđ]*"
  ),
  
  indeksi_mjere = c(
    "\\bhicp\\b",
    "indeks.{0,10}potro[sš][a-zčćžšđ]*",
    "\\bcpi\\b",
    "bazn[a-zčćžšđ]*.{0,10}inflacij[a-zčćžšđ]*",
    "jezgren[a-zčćžšđ]*.{0,10}inflacij[a-zčćžšđ]*"
  )
)

category_display <- c(
  "inflacija_direktno" = "Inflacija (direktno)",
  "cijene_poskupljenja" = "Cijene i poskupljenja",
  "troskovi_zivota" = "Troškovi života",
  "energija_gorivo" = "Energija i gorivo",
  "hrana" = "Hrana",
  "monetarna_politika" = "Monetarna politika",
  "place_primanja" = "Plaće i primanja",
  "indeksi_mjere" = "Indeksi i mjere"
)

term_summary <- data.table(
  Kategorija = names(semantic_terms),
  Broj_pojmova = sapply(semantic_terms, length),
  Primjeri = sapply(semantic_terms, function(x) paste(head(x, 2), collapse = ", "))
)
term_summary[, Kategorija_display := category_display[Kategorija]]

kable(term_summary[, .(Kategorija_display, Broj_pojmova, Primjeri)], 
      col.names = c("Kategorija", "Broj pojmova", "Primjeri regex uzoraka"),
      caption = "Pregled rječnika semantičkih pojmova za inflaciju") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Brojanje semantičkih pojmova

```{r count-semantic-terms}
#| label: count-semantic-terms

count_terms <- function(text, patterns) {
  if (is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) {
    stri_count_regex(text_lower, p)
  }))
}

for (cat_name in names(semantic_terms)) {
  col_name <- paste0("count_", cat_name)
  dt[, (col_name) := sapply(FULL_TEXT, count_terms, patterns = semantic_terms[[cat_name]])]
}

dt[, count_all_semantic := rowSums(.SD), .SDcols = patterns("^count_")]
```

## Dinamika semantičkih kategorija

```{r monthly-semantic}
#| label: monthly-semantic

semantic_cols <- names(dt)[grepl("^count_", names(dt))]

monthly_semantic <- dt[, c(
  .(N = .N),
  lapply(.SD, sum, na.rm = TRUE),
  lapply(.SD, mean, na.rm = TRUE) |> setNames(paste0(names(.SD), "_avg"))
), by = yearmonth, .SDcols = semantic_cols][order(yearmonth)]

monthly_semantic[, total_mentions := count_all_semantic]
```

```{r semantic-time-series}
#| label: semantic-time-series
#| fig-cap: "Dinamika semantičkih kategorija kroz vrijeme"
#| fig-height: 10

semantic_long <- melt(
  monthly_semantic[, .(yearmonth, 
                       count_inflacija_direktno,
                       count_cijene_poskupljenja,
                       count_troskovi_zivota,
                       count_energija_gorivo,
                       count_hrana,
                       count_monetarna_politika,
                       count_place_primanja,
                       count_indeksi_mjere)],
  id.vars = "yearmonth",
  variable.name = "kategorija",
  value.name = "broj"
)

category_labels <- c(
  "count_inflacija_direktno" = "Inflacija (direktno)",
  "count_cijene_poskupljenja" = "Cijene/Poskupljenja",
  "count_troskovi_zivota" = "Troškovi života",
  "count_energija_gorivo" = "Energija/Gorivo",
  "count_hrana" = "Hrana",
  "count_monetarna_politika" = "Monetarna politika",
  "count_place_primanja" = "Plaće/Primanja",
  "count_indeksi_mjere" = "Indeksi/Mjere"
)

semantic_long[, kategorija_label := category_labels[as.character(kategorija)]]

ggplot(semantic_long, aes(x = yearmonth, y = broj, color = kategorija_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~kategorija_label, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Dinamika semantičkih kategorija inflacije kroz vrijeme",
    subtitle = "Mjesečni broj spominjanja po kategoriji pojmova",
    x = NULL,
    y = "Broj spominjanja",
    color = NULL
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
  )
```

# Konstrukcija indeksa

### Volume Inflation Index (VII)

VII kvantificira obujam medijskog izvještavanja o inflaciji mjeren brojem objavljenih članaka. Konstrukcija se temelji na prebrojavanju članaka koji su prošli filter relevantnosti za inflacijsku tematiku. Mjesečni broj članaka normalizira se na raspon 0 do 100 standardnom min max normalizacijom. Povišene vrijednosti VII indeksa indiciraju razdoblja intenzivnog medijskog izvještavanja o inflaciji.

::: {.callout-note collapse="true"}
## Detaljna metodologija VII indeksa

**Formula:**

$$
\text{VII}_t = \text{normalize}_{0-100}(N_t)
$$

gdje je $N_t$ broj članaka u mjesecu $t$.

**Interpretacija:** Visoke vrijednosti ukazuju na veliku količinu medijskog sadržaja o inflaciji.

:::

### Semantic Inflation Index (SII)

SII mjeri intenzitet korištenja inflacijske terminologije u medijskom diskursu. Indeks se konstruira zbrajanjem pojavljivanja svih semantičkih pojmova iz svih kategorija normaliziranih brojem članaka. Viša vrijednost indicira dublju i analitičniju obradu inflacijske tematike u medijima.

::: {.callout-note collapse="true"}
## Detaljna metodologija SII indeksa

**Formula:**

$$
\text{SII}_t = \text{normalize}_{0-100}\left(\frac{\sum_{c} \text{count}_{c,t}}{N_t}\right)
$$

**Uključene kategorije:** inflacija direktno, cijene i poskupljenja, troškovi života, energija i gorivo, hrana, monetarna politika, plaće i primanja, indeksi i mjere

:::

### Sentiment Inflation Index (SAI)

SAI mjeri ton medijskog izvještavanja o inflaciji na skali od negativnog (zabrinutost, kriza) do pozitivnog (stabilizacija, oporavak). Konstrukcija se temelji na leksičkom pristupu koji broji pozitivne i negativne pojmove u tekstu. Sentiment svakog članka se izračunava kao normalizirana razlika pozitivnih i negativnih pojmova, a mjesečna vrijednost predstavlja prosjek sentimenta svih članaka.

::: {.callout-note collapse="true"}
## Detaljna metodologija SAI indeksa

**Formula za članak:**

$$
S_d = \frac{P_d - N_d}{P_d + N_d + 1}
$$

gdje je $P_d$ broj pozitivnih pojmova, $N_d$ broj negativnih pojmova.

**Mjesečna agregacija:**

$$
\text{SAI}_t = \text{normalize}_{0-100}(\bar{S}_t)
$$

**Napomena:** Za GIMES indeks se koristi invertirana vrijednost (100 minus SAI) tako da viša vrijednost indicira veću zabrinutost.

:::

### GIMES Composite Index (GCI)

GCI predstavlja kompozitni indeks koji kombinira četiri dimenzije medijskog izvještavanja o inflaciji. Indeks agregira volumen izvještavanja, intenzitet analize (duljina članaka), ton sentimenta i doseg članaka. Težine komponenti su: volumen 40%, intenzitet 20%, sentiment 20% i doseg 20%. Viša vrijednost indicira veću ukupnu medijsku pozornost i zabrinutost oko inflacije.

::: {.callout-note collapse="true"}
## Detaljna metodologija GCI indeksa

**Formula:**

$$
\text{GCI}_t = 0.40 \times V_{norm,t} + 0.20 \times I_{norm,t} + 0.20 \times (100 - S_{norm,t}) + 0.20 \times R_{norm,t}
$$

gdje su:
V = normalizirani volumen članaka,
I = normalizirani intenzitet (prosječna duljina),
S = normalizirani sentiment (invertiran),
R = normalizirani doseg (reach)

**Interpretacija vrijednosti:**

Raspon 0 do 25 indicira nisku medijsku pozornost na inflaciju. Raspon 25 do 50 indicira umjerenu medijsku pozornost. Raspon 50 do 75 indicira visoku medijsku pozornost. Raspon 75 do 100 indicira vrlo visoku medijsku pozornost tipičnu za krizna razdoblja.

:::

## Opis indeksa

```{r index-table-summary}
#| label: index-table-summary

index_desc <- data.table(
  Indeks = c("VII", "SII", "SAI", "GCI"),
  Naziv = c("Volume Inflation Index", "Semantic Inflation Index", 
            "Sentiment Inflation Index", "GIMES Composite Index"),
  Opis = c("Obujam medijskog izvještavanja (broj članaka)",
           "Intenzitet korištenja inflacijske terminologije",
           "Ton izvještavanja (negativan do pozitivan)",
           "Kompozitni indeks svih dimenzija")
)

kable(index_desc, caption = "Pregled konstruiranih indeksa") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

```{r sentiment-lexicon}
#| label: sentiment-lexicon

sentiment_negative_stems <- c(
  "kriz[aeiou]*", "katastro[a-zčćžšđ]*", "kolaps[a-zčćžšđ]*", "propast[a-zčćžšđ]*",
  "strah[aeiou]*", "panik[aeiou]*", "zabrinut[a-zčćžšđ]*", "neizvjesn[a-zčćžšđ]*",
  "pogor[sš]anj[aeiou]*", "pad[aeiou]*", "smanjenj[aeiou]*", "gubit[a-zčćžšđ]*",
  "problem[aeiou]*", "pote[sš]ko[cć][aeiou]*", "nedostat[a-zčćžšđ]*",
  "hiperinflacij[aeiou]*", "stagflacij[aeiou]*", "poskupljenj[aeiou]*", "skupo[cć][aeiou]*",
  "recesij[aeiou]*", "nezaposlen[a-zčćžšđ]*", "siroma[sš]tv[aeiou]*", "du[gž][aeiou]*"
)

sentiment_positive_stems <- c(
  "stabilizacij[aeiou]*", "stabilan[a-zčćžšđ]*", "oporav[a-zčćžšđ]*",
  "pobolj[sš]anj[aeiou]*", "rast[aeiou]*", "porast[aeiou]*", "pove[cć]anj[aeiou]*",
  "prosperitet[aeiou]*", "blagostanj[aeiou]*", "napred[a-zčćžšđ]*",
  "dezinflacij[aeiou]*", "usporavanj[aeiou]*", "sniz[aeiou]*",
  "rje[sš]enj[aeiou]*", "mjer[aeiou]*", "potpor[aeiou]*", "pomo[cć][aeiou]*"
)

count_sentiment <- function(text, patterns) {
  if (is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) stri_count_regex(text_lower, p)))
}

dt[, neg_count := sapply(FULL_TEXT, count_sentiment, patterns = sentiment_negative_stems)]
dt[, pos_count := sapply(FULL_TEXT, count_sentiment, patterns = sentiment_positive_stems)]
dt[, sentiment_score := (pos_count - neg_count) / (pos_count + neg_count + 1)]
dt[, AUTO_SENTIMENT := fcase(
  sentiment_score < -0.2, -1,
  sentiment_score > 0.2, 1,
  default = 0
)]
```

```{r index-calculation}
#| label: index-calculation

normalize <- function(x) {
  if (all(is.na(x))) return(rep(50, length(x)))
  min_x <- min(x, na.rm = TRUE)
  max_x <- max(x, na.rm = TRUE)
  if (max_x == min_x) return(rep(50, length(x)))
  (x - min_x) / (max_x - min_x) * 100
}

index_data <- dt[, .(
  volume = .N,
  avg_length = mean(text_length, na.rm = TRUE),
  avg_sentiment = mean(sentiment_score, na.rm = TRUE),
  avg_reach = if ("REACH" %in% names(.SD)) mean(REACH, na.rm = TRUE) else NA_real_,
  semantic_total = sum(count_all_semantic, na.rm = TRUE),
  semantic_inflacija = sum(count_inflacija_direktno, na.rm = TRUE),
  semantic_cijene = sum(count_cijene_poskupljenja, na.rm = TRUE),
  semantic_troskovi = sum(count_troskovi_zivota, na.rm = TRUE),
  semantic_energija = sum(count_energija_gorivo, na.rm = TRUE),
  semantic_hrana = sum(count_hrana, na.rm = TRUE),
  semantic_monetarna = sum(count_monetarna_politika, na.rm = TRUE),
  semantic_place = sum(count_place_primanja, na.rm = TRUE),
  semantic_indeksi = sum(count_indeksi_mjere, na.rm = TRUE)
), by = yearmonth][order(yearmonth)]

index_data[, `:=`(
  VII = normalize(volume),
  SII = normalize(semantic_total / volume),
  SAI = normalize(avg_sentiment),
  length_norm = normalize(avg_length),
  reach_norm = normalize(avg_reach)
)]

index_data[, GCI := 
  0.40 * VII + 
  0.20 * length_norm + 
  0.20 * (100 - SAI) +
  0.20 * fifelse(is.na(reach_norm), 50, reach_norm)
]

index_cols <- c("VII", "SII", "SAI", "GCI")
for (col in index_cols) {
  ma_col <- paste0(col, "_MA3")
  index_data[, (ma_col) := frollmean(get(col), n = 3, align = "center")]
}
```

# Vizualizacija indeksa

## Glavni indeksi

```{r gci-plot}
#| label: gci-plot
#| fig-cap: "GIMES Composite Index (GCI)"
#| fig-height: 7

ggplot(index_data, aes(x = yearmonth)) +
  geom_ribbon(aes(ymin = 0, ymax = GCI), fill = colors_gimes["accent"], alpha = 0.3) +
  geom_line(aes(y = GCI), color = colors_gimes["accent"], linewidth = 0.8, alpha = 0.5) +
  geom_line(aes(y = GCI_MA3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = GCI_MA3), color = colors_gimes["primary"], size = 2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20)) +
  labs(
    title = "GIMES Composite Index (GCI)",
    subtitle = "Kompozitni indeks medijske pozornosti na inflaciju (0 do 100) | Tamna linija = 3 mj. klizni prosjek",
    x = NULL,
    y = "GCI"
  )
```

## Komponente indeksa

```{r component-indices-plot}
#| label: component-indices-plot
#| fig-cap: "Komponente GIMES indeksa: VII, SII, SAI"
#| fig-height: 8

p_vii <- ggplot(index_data, aes(x = yearmonth, y = VII)) +
  geom_line(color = colors_gimes["primary"], linewidth = 1) +
  labs(title = "Volume Inflation Index (VII)", x = NULL, y = "Indeks (0 do 100)")

p_sii <- ggplot(index_data, aes(x = yearmonth, y = SII)) +
  geom_line(color = colors_gimes["accent"], linewidth = 1) +
  labs(title = "Semantic Inflation Index (SII)", x = NULL, y = "Indeks (0 do 100)")

p_sai <- ggplot(index_data, aes(x = yearmonth, y = SAI)) +
  geom_line(color = colors_gimes["success"], linewidth = 1) +
  labs(title = "Sentiment Inflation Index (SAI)", x = NULL, y = "Indeks (0 do 100)")

p_gci <- ggplot(index_data, aes(x = yearmonth, y = GCI)) +
  geom_line(color = colors_gimes["secondary"], linewidth = 1) +
  labs(title = "GIMES Composite Index (GCI)", x = NULL, y = "Indeks (0 do 100)")

(p_vii | p_sii) / (p_sai | p_gci)
```

## Tablica indeksa

```{r index-table}
#| label: index-table

index_table <- index_data[, .(
  Mjesec = format(yearmonth, "%b %Y"),
  `Broj članaka` = format(volume, big.mark = ","),
  VII = round(VII, 1),
  SII = round(SII, 1),
  SAI = round(SAI, 1),
  GCI = round(GCI, 1)
)]

kable(tail(index_table, 12), 
      caption = "Indeksi inflacije: zadnjih 12 mjeseci",
      align = c("l", "r", rep("r", 4))) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
  row_spec(0, bold = TRUE, background = colors_gimes["primary"], color = "white")
```

# Sektorska analiza

## Dinamika po sektorima

```{r sector-indices}
#| label: sector-indices

monthly_semantic[, `:=`(
  idx_inflacija = normalize(count_inflacija_direktno),
  idx_cijene = normalize(count_cijene_poskupljenja),
  idx_troskovi = normalize(count_troskovi_zivota),
  idx_energija = normalize(count_energija_gorivo),
  idx_hrana = normalize(count_hrana),
  idx_monetarna = normalize(count_monetarna_politika),
  idx_place = normalize(count_place_primanja),
  idx_indeksi = normalize(count_indeksi_mjere)
)]
```

```{r sector-indices-plot}
#| label: sector-indices-plot
#| fig-cap: "Sektorski indeksi medijske pozornosti"
#| fig-height: 10

sector_long <- melt(
  monthly_semantic[, .(yearmonth, 
                       idx_inflacija, idx_cijene, idx_troskovi, idx_energija,
                       idx_hrana, idx_monetarna, idx_place, idx_indeksi)],
  id.vars = "yearmonth",
  variable.name = "sektor",
  value.name = "indeks"
)

sector_labels <- c(
  "idx_inflacija" = "Inflacija (direktno)",
  "idx_cijene" = "Cijene i poskupljenja",
  "idx_troskovi" = "Troškovi života",
  "idx_energija" = "Energija i gorivo",
  "idx_hrana" = "Hrana",
  "idx_monetarna" = "Monetarna politika",
  "idx_place" = "Plaće i primanja",
  "idx_indeksi" = "Indeksi i mjere"
)

sector_long[, sektor_label := sector_labels[as.character(sektor)]]

ggplot(sector_long, aes(x = yearmonth, y = indeks, color = sektor_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~sektor_label, ncol = 2, scales = "fixed") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 25)) +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Sektorski indeksi medijske pozornosti na inflaciju",
    subtitle = "Normalizirani indeksi (0 do 100) po semantičkim kategorijama",
    x = NULL,
    y = "Indeks (0 do 100)",
    color = NULL
  ) +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Heatmapa sektorske aktivnosti

```{r sector-heatmap}
#| label: sector-heatmap
#| fig-cap: "Heatmapa sektorske aktivnosti"
#| fig-height: 8

heatmap_data <- sector_long[, .(yearmonth, sektor_label, indeks)]

ggplot(heatmap_data, aes(x = yearmonth, y = sektor_label, fill = indeks)) +
  geom_tile(color = "white", linewidth = 0.5) +
  scale_fill_gradient2(low = "white", mid = colors_gimes["accent"], high = colors_gimes["primary"],
                       midpoint = 50, limits = c(0, 100)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "Heatmapa sektorske medijske aktivnosti",
    subtitle = "Intenzitet izvještavanja po sektorima kroz vrijeme (0 = minimum, 100 = maksimum)",
    x = NULL,
    y = NULL,
    fill = "Indeks"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
        axis.text.y = element_text(size = 10))
```

## Korelacijska struktura

```{r correlation-matrix}
#| label: correlation-matrix
#| fig-cap: "Korelacijska matrica indeksa inflacije"
#| fig-height: 10

cor_data <- merge(
  index_data[, .(yearmonth, VII, SII, SAI, GCI)],
  monthly_semantic[, .(yearmonth, idx_inflacija, idx_cijene, idx_troskovi, 
                       idx_energija, idx_hrana, idx_monetarna, idx_place, idx_indeksi)],
  by = "yearmonth"
)

cor_vars <- c("GCI", "VII", "SII", "SAI",
              "idx_inflacija", "idx_cijene", "idx_troskovi", "idx_energija",
              "idx_hrana", "idx_monetarna", "idx_place", "idx_indeksi")

cor_matrix <- cor(cor_data[, .SD, .SDcols = cor_vars], use = "pairwise.complete.obs")

nice_names <- c("GCI", "VII", "SII", "SAI",
                "S: Inflacija", "S: Cijene", "S: Troškovi", "S: Energija",
                "S: Hrana", "S: Monetarna", "S: Plaće", "S: Indeksi")
rownames(cor_matrix) <- nice_names
colnames(cor_matrix) <- nice_names

corrplot(cor_matrix,
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.7,
         addCoef.col = "black",
         number.cex = 0.5,
         col = colorRampPalette(c(colors_gimes["accent"], "white", colors_gimes["secondary"]))(100),
         title = "Korelacijska matrica indeksa inflacije",
         mar = c(0, 0, 2, 0))
```

# Sentiment analiza

## Dinamika sentimenta kroz vrijeme

```{r sentiment-time}
#| label: sentiment-time
#| fig-cap: "Dinamika sentimenta kroz vrijeme"

sentiment_monthly <- dt[, .(
  avg_sentiment = mean(sentiment_score, na.rm = TRUE),
  N = .N,
  pct_negative = sum(AUTO_SENTIMENT == -1, na.rm = TRUE) / .N * 100,
  pct_positive = sum(AUTO_SENTIMENT == 1, na.rm = TRUE) / .N * 100,
  pct_neutral = sum(AUTO_SENTIMENT == 0, na.rm = TRUE) / .N * 100
), by = yearmonth][order(yearmonth)]

ggplot(sentiment_monthly, aes(x = yearmonth)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_ribbon(aes(ymin = pmin(avg_sentiment, 0), ymax = 0), 
              fill = colors_gimes["secondary"], alpha = 0.3) +
  geom_ribbon(aes(ymin = 0, ymax = pmax(avg_sentiment, 0)), 
              fill = colors_gimes["success"], alpha = 0.3) +
  geom_line(aes(y = avg_sentiment), color = colors_gimes["primary"], linewidth = 1.2) +
  geom_point(aes(y = avg_sentiment, size = N), color = colors_gimes["primary"], alpha = 0.6) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_size_continuous(range = c(2, 6), labels = comma) +
  labs(
    title = "Sentiment Inflation Index (SAI): prosječni sentiment kroz vrijeme",
    subtitle = "Negativne vrijednosti = zabrinutost | Pozitivne vrijednosti = optimizam",
    x = NULL,
    y = "Prosječni sentiment",
    size = "Broj članaka"
  )
```

## Distribucija sentimenta

```{r sentiment-distribution}
#| label: sentiment-distribution
#| fig-cap: "Distribucija sentimenta članaka"

sentiment_dist <- dt[, .(N = .N), by = AUTO_SENTIMENT]
sentiment_dist[, Kategorija := fcase(
  AUTO_SENTIMENT == -1, "Negativan",
  AUTO_SENTIMENT == 0, "Neutralan",
  AUTO_SENTIMENT == 1, "Pozitivan"
)]

ggplot(sentiment_dist, aes(x = Kategorija, y = N, fill = Kategorija)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(format(N, big.mark = ","), "\n(", 
                               round(N/sum(N)*100, 1), "%)")), 
            vjust = -0.2, size = 4) +
  scale_fill_manual(values = c("Negativan" = colors_gimes["secondary"],
                               "Neutralan" = colors_gimes["light"],
                               "Pozitivan" = colors_gimes["success"])) +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Distribucija sentimenta članaka o inflaciji",
    x = NULL,
    y = "Broj članaka"
  )
```

# Volatilnost i momentum

## Konstrukcija volatilnosti i momentuma

```{r volatility-momentum}
#| label: volatility-momentum

daily_by_month <- dt[, .(N = .N), by = .(yearmonth, date)]
volatility <- daily_by_month[, .(
  volatility = sd(N, na.rm = TRUE),
  mean_daily = mean(N, na.rm = TRUE),
  days = .N
), by = yearmonth]

index_data <- merge(index_data, volatility, by = "yearmonth", all.x = TRUE)
index_data[, volatility_norm := normalize(volatility)]

index_data[, `:=`(
  GCI_vol_3m = frollapply(GCI, n = 3, FUN = sd, align = "right"),
  GCI_mom_1m = GCI - shift(GCI, 1),
  GCI_mom_3m = GCI - shift(GCI, 3)
)]

index_data[, `:=`(
  GCI_vol_3m_z = (GCI_vol_3m - mean(GCI_vol_3m, na.rm = TRUE)) / sd(GCI_vol_3m, na.rm = TRUE),
  GCI_mom_1m_z = (GCI_mom_1m - mean(GCI_mom_1m, na.rm = TRUE)) / sd(GCI_mom_1m, na.rm = TRUE),
  GCI_mom_3m_z = (GCI_mom_3m - mean(GCI_mom_3m, na.rm = TRUE)) / sd(GCI_mom_3m, na.rm = TRUE)
)]
```

```{r volatility-plot}
#| label: volatility-plot
#| fig-cap: "GCI volatilnost i momentum"
#| fig-height: 10

p_vol <- ggplot(index_data, aes(x = yearmonth, y = GCI_vol_3m)) +
  geom_line(color = colors_gimes["secondary"], linewidth = 1) +
  geom_hline(yintercept = mean(index_data$GCI_vol_3m, na.rm = TRUE), 
             linetype = "dashed", color = colors_gimes["muted"]) +
  labs(title = "GCI volatilnost (3M rolling SD)", x = NULL, y = "Volatilnost")

p_mom1 <- ggplot(index_data, aes(x = yearmonth, y = GCI_mom_1m)) +
  geom_col(aes(fill = GCI_mom_1m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["danger"])) +
  geom_hline(yintercept = 0, color = "gray50") +
  labs(title = "GCI momentum (M/M)", x = NULL, y = "Promjena")

p_mom3 <- ggplot(index_data, aes(x = yearmonth, y = GCI_mom_3m)) +
  geom_col(aes(fill = GCI_mom_3m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["danger"])) +
  geom_hline(yintercept = 0, color = "gray50") +
  labs(title = "GCI momentum (3M)", x = NULL, y = "Promjena")

p_vol / p_mom1 / p_mom3
```

```{r standardized-plot}
#| label: standardized-plot
#| fig-cap: "Standardizirani indeksi volatilnosti i momentuma"
#| fig-height: 6

std_long <- melt(
  index_data[, .(yearmonth, 
                 `Volatilnost (3M)` = GCI_vol_3m_z,
                 `Momentum (1M)` = GCI_mom_1m_z,
                 `Momentum (3M)` = GCI_mom_3m_z)],
  id.vars = "yearmonth",
  variable.name = "mjera",
  value.name = "z_vrijednost"
)

ggplot(std_long[!is.na(z_vrijednost)], aes(x = yearmonth, y = z_vrijednost, color = mjera)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_line(linewidth = 1) +
  scale_color_manual(values = c(
    "Volatilnost (3M)" = colors_gimes["secondary"],
    "Momentum (1M)" = colors_gimes["accent"],
    "Momentum (3M)" = colors_gimes["success"]
  )) +
  labs(
    title = "Standardizirani indeksi volatilnosti i momentuma (GCI)",
    subtitle = "Z vrijednosti omogućuju usporedbu različitih mjera",
    x = NULL,
    y = "Z vrijednost",
    color = NULL
  )
```

# Koncentracija tema

## Konstrukcija mjera koncentracije

::: {.callout-note collapse="true" title="Metodologija HHI indeksa"}

Herfindahl Hirschman Index (HHI) mjeri koncentraciju tema u medijskom prostoru. Izračunava se kao suma kvadrata udjela svake kategorije. Vrijednosti bliže 1 indiciraju visoku koncentraciju (dominacija jedne teme), dok vrijednosti bliže 0 indiciraju ravnomjerniju raspodjelu pozornosti.

**Formula:**

$$
\text{HHI}_t = \sum_{i=1}^{n} s_{i,t}^2
$$

gdje je $s_{i,t}$ udio kategorije $i$ u ukupnom broju spominjanja u mjesecu $t$.

:::

```{r hhi-calculation}
#| label: hhi-calculation

concentration_data <- monthly_semantic[, .(
  yearmonth,
  s_inflacija = count_inflacija_direktno / count_all_semantic,
  s_cijene = count_cijene_poskupljenja / count_all_semantic,
  s_troskovi = count_troskovi_zivota / count_all_semantic,
  s_energija = count_energija_gorivo / count_all_semantic,
  s_hrana = count_hrana / count_all_semantic,
  s_monetarna = count_monetarna_politika / count_all_semantic,
  s_place = count_place_primanja / count_all_semantic,
  s_indeksi = count_indeksi_mjere / count_all_semantic
)]

share_cols <- names(concentration_data)[grepl("^s_", names(concentration_data))]
concentration_data[, HHI := rowSums(.SD^2, na.rm = TRUE), .SDcols = share_cols]

threshold <- 0.05
concentration_data[, n_active := rowSums(.SD > threshold, na.rm = TRUE), .SDcols = share_cols]

concentration_data[, HHI_norm := (HHI - 0.125) / (1 - 0.125) * 100]
concentration_data[, HHI_MA3 := frollmean(HHI_norm, n = 3, align = "center")]

index_data <- merge(index_data, concentration_data[, .(yearmonth, HHI, HHI_norm, n_active)], 
                    by = "yearmonth", all.x = TRUE)
```

```{r hhi-plot}
#| label: hhi-plot
#| fig-cap: "Koncentracija tema (HHI) i broj aktivnih kategorija"
#| fig-height: 8

p_hhi <- ggplot(concentration_data, aes(x = yearmonth)) +
  geom_line(aes(y = HHI_norm), color = colors_gimes["muted"], linewidth = 0.8) +
  geom_line(aes(y = HHI_MA3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  labs(title = "Herfindahl Hirschman Index (HHI)", 
       subtitle = "Mjera koncentracije tema | Tamna linija = 3M klizni prosjek",
       x = NULL, y = "HHI (norm.)")

p_active <- ggplot(concentration_data, aes(x = yearmonth, y = n_active)) +
  geom_line(color = colors_gimes["accent"], linewidth = 1) +
  labs(title = "Broj aktivnih kategorija", 
       subtitle = "Kategorije s udjelom većim od 5%",
       x = NULL, y = "Broj kategorija")

p_hhi / p_active
```

# Validacija sa službenim podacima

## Dohvaćanje Eurostat HICP podataka

```{r load-official-data}
#| label: load-official-data

eurostat_headline <- NULL
tryCatch({
  hicp_data <- get_eurostat("prc_hicp_manr", 
                            filters = list(geo = "HR", 
                                          coicop = "CP00",
                                          unit = "RCH_A"),
                            time_format = "date")
  setDT(hicp_data)
  eurostat_headline <- hicp_data[time >= min(index_data$yearmonth) & time <= max(index_data$yearmonth), 
                                   .(yearmonth = time, eurostat_hicp = values)]
}, error = function(e) {
  eurostat_headline <<- data.table(
    yearmonth = seq(as.Date("2021-01-01"), as.Date("2024-11-01"), by = "month"),
    eurostat_hicp = c(
      0.2, 0.6, 0.8, 1.9, 2.4, 2.3, 2.6, 3.0, 3.3, 3.8, 4.8, 5.5,
      5.8, 6.3, 7.3, 9.4, 10.8, 12.1, 12.3, 12.4, 12.8, 13.0, 13.0, 12.7,
      12.0, 11.1, 10.5, 9.2, 8.4, 8.2, 7.3, 7.7, 7.1, 5.3, 4.9, 4.7,
      4.3, 4.0, 3.9, 3.7, 3.6, 3.4, 3.2, 2.9, 2.8, 2.6, 2.4
    )
  )
})

comparison <- merge(index_data, eurostat_headline, by = "yearmonth", all.x = TRUE)
```

## GCI vs Eurostat HICP

```{r gci-vs-hicp}
#| label: gci-vs-hicp
#| fig-cap: "GIMES Composite Index (GCI) vs Eurostat HICP inflacija"
#| fig-height: 7

coef_hicp <- 100 / max(comparison$eurostat_hicp, na.rm = TRUE)

ggplot(comparison, aes(x = yearmonth)) +
  geom_line(aes(y = GCI, color = "GCI"), linewidth = 1.2) +
  geom_point(aes(y = GCI), color = colors_gimes["primary"], size = 2, alpha = 0.6) +
  geom_line(aes(y = eurostat_hicp * coef_hicp, color = "Eurostat HICP"), 
            linewidth = 1.2, linetype = "solid") +
  geom_point(aes(y = eurostat_hicp * coef_hicp), color = colors_gimes["secondary"], 
             size = 2, alpha = 0.6) +
  scale_y_continuous(
    name = "GCI (0 do 100)",
    sec.axis = sec_axis(~./coef_hicp, name = "HICP (YoY %)", 
                       labels = function(x) paste0(x, "%"))
  ) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_color_manual(values = c("GCI" = colors_gimes["primary"], 
                                "Eurostat HICP" = colors_gimes["secondary"])) +
  labs(
    title = "GIMES Composite Index (GCI) vs Eurostat HICP",
    subtitle = "Usporedba medijske percepcije i službene inflacije",
    x = NULL,
    color = NULL
  ) +
  theme(
    axis.title.y.right = element_text(color = colors_gimes["secondary"], face = "bold"),
    axis.text.y.right = element_text(color = colors_gimes["secondary"]),
    axis.title.y.left = element_text(color = colors_gimes["primary"], face = "bold")
  )
```

## Korelacije sa službenom inflacijom

```{r correlation-table}
#| label: correlation-table

correlations <- data.table(
  Usporedba = c(
    "GCI vs Eurostat HICP",
    "VII (volumen) vs Eurostat HICP",
    "SII (semantički) vs Eurostat HICP",
    "SAI (sentiment inv.) vs Eurostat HICP"
  ),
  Korelacija = c(
    round(cor(comparison$GCI, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$VII, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(comparison$SII, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(cor(100 - comparison$SAI, comparison$eurostat_hicp, use = "complete.obs"), 3)
  )
)

kable(correlations, caption = "Korelacije između indeksa i službene inflacije") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(which.max(correlations$Korelacija), bold = TRUE, background = colors_gimes["success"])
```

# Export

```{r export-excel}
#| label: export-excel

wb <- createWorkbook()

export_indices <- index_data[, .(
  Datum = yearmonth,
  Godina = year(yearmonth),
  Mjesec = month(yearmonth),
  Broj_clanaka = volume,
  VII = round(VII, 2),
  SII = round(SII, 2),
  SAI = round(SAI, 2),
  GCI = round(GCI, 2),
  GCI_MA3 = round(GCI_MA3, 2)
)]

addWorksheet(wb, "Indeksi")
writeData(wb, "Indeksi", export_indices)

header_style <- createStyle(
  textDecoration = "bold",
  fgFill = "#2C3E50",
  fontColour = "white",
  halign = "center"
)
addStyle(wb, "Indeksi", header_style, rows = 1, cols = 1:ncol(export_indices))
setColWidths(wb, "Indeksi", cols = 1:ncol(export_indices), widths = "auto")

semantic_export <- monthly_semantic[, .(
  Datum = yearmonth,
  Broj_clanaka = N,
  Inflacija_direktno = count_inflacija_direktno,
  Cijene_poskupljenja = count_cijene_poskupljenja,
  Troskovi_zivota = count_troskovi_zivota,
  Energija_gorivo = count_energija_gorivo,
  Hrana = count_hrana,
  Monetarna_politika = count_monetarna_politika,
  Place_primanja = count_place_primanja,
  Indeksi_mjere = count_indeksi_mjere,
  Ukupno = count_all_semantic
)]

addWorksheet(wb, "Semanticke_kategorije")
writeData(wb, "Semanticke_kategorije", semantic_export)
addStyle(wb, "Semanticke_kategorije", header_style, rows = 1, cols = 1:ncol(semantic_export))
setColWidths(wb, "Semanticke_kategorije", cols = 1:ncol(semantic_export), widths = "auto")

dynamics_export <- index_data[, .(
  Datum = yearmonth,
  GCI = round(GCI, 2),
  GCI_vol_3m = round(GCI_vol_3m, 2),
  GCI_mom_1m = round(GCI_mom_1m, 2),
  GCI_mom_3m = round(GCI_mom_3m, 2)
)]

addWorksheet(wb, "Dinamike")
writeData(wb, "Dinamike", dynamics_export)
addStyle(wb, "Dinamike", header_style, rows = 1, cols = 1:ncol(dynamics_export))
setColWidths(wb, "Dinamike", cols = 1:ncol(dynamics_export), widths = "auto")

cor_export <- as.data.table(cor_matrix, keep.rownames = "Indeks")

addWorksheet(wb, "Korelacije")
writeData(wb, "Korelacije", cor_export)
addStyle(wb, "Korelacije", header_style, rows = 1, cols = 1:ncol(cor_export))
setColWidths(wb, "Korelacije", cols = 1:ncol(cor_export), widths = "auto")

output_path <- here("output", "gimes_inflation_indices.xlsx")
dir.create(here("output"), showWarnings = FALSE, recursive = TRUE)
saveWorkbook(wb, output_path, overwrite = TRUE)

message("Excel datoteka spremljena: ", output_path)
```

# Sažetak

```{r summary-findings}
#| label: summary-findings

peak_month <- index_data[which.max(GCI), yearmonth]
peak_value <- index_data[which.max(GCI), GCI]

peak_inflation_month <- comparison[which.max(eurostat_hicp), yearmonth]
peak_inflation_value <- comparison[which.max(eurostat_hicp), eurostat_hicp]

findings <- data.table(
  Nalaz = c(
    "Ukupno analiziranih članaka",
    "Vremenski raspon analize",
    "Broj izvora",
    "",
    "Vrh GCI indeksa",
    "Vrijednost vrha",
    "",
    "Vrh inflacije (HICP)",
    "Vrijednost vrha",
    "",
    "Korelacija GCI vs HICP",
    "Prosječni GCI"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%m/%Y"), " do ", format(max(dt$date), "%m/%Y")),
    as.character(length(unique(dt$FROM))),
    "",
    format(peak_month, "%B %Y"),
    round(peak_value, 1),
    "",
    format(peak_inflation_month, "%B %Y"),
    paste0(round(peak_inflation_value, 1), "%"),
    "",
    round(cor(comparison$GCI, comparison$eurostat_hicp, use = "complete.obs"), 3),
    round(mean(index_data$GCI, na.rm = TRUE), 1)
  )
)

kable(findings, caption = "Sažetak ključnih nalaza analize") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(c(4, 7, 10), background = colors_gimes["light"])
```

---

*Izvještaj generiran: `r Sys.time()`*

*GIMES Research | Analiza medijske pokrivenosti inflacije v2.0*
