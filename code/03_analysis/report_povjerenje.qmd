---
title: "Analiza medijske pokrivenosti društvenog povjerenja i optimizma u Hrvatskoj"
subtitle: "Semantička analiza, konstrukcija indeksa i vremenske dinamike"
author: "GIMES Research"
date: today
format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    theme: cosmo
    code-fold: true
    code-summary: "Prikaži kod"
    fig-width: 11
    fig-height: 7
    df-print: paged
    embed-resources: true
execute:
  warning: false
  message: false
  echo: false
lang: hr
---

```{r setup}
#| label: setup
#| include: false

# Core data manipulation
library(data.table)
library(lubridate)
library(stringi)

# Visualization
library(ggplot2)
library(scales)
library(plotly)
library(corrplot)
library(patchwork)

# Tables and output
library(knitr)
library(kableExtra)
library(openxlsx)

# Time series
library(zoo)
library(forecast)

# Project management
library(here)

colors_gimes <- c(
  "primary"   = "#2C3E50",
  "secondary" = "#E74C3C",
  "accent"    = "#3498DB",
  "success"   = "#27AE60",
  "warning"   = "#F39C12",
  "danger"    = "#C0392B",
  "light"     = "#ECF0F1",
  "purple"    = "#9B59B6",
  "teal"      = "#1ABC9C",
  "muted"     = "#7F8C8D"
)

# Topic specific colors
colors_gimes["optimism"] <- "#2ECC71"
colors_gimes["pessimism"] <- "#E74C3C"
colors_gimes["neutral"] <- "#95A5A6"

options(scipen = 999)

theme_gimes <- function() {
  theme_minimal(base_size = 12) +
    theme(
      plot.title = element_text(face = "bold", size = 14, color = colors_gimes["primary"]),
      plot.subtitle = element_text(size = 10, color = "gray40"),
      panel.grid.minor = element_blank(),
      legend.position = "bottom",
      axis.text = element_text(size = 9),
      strip.text = element_text(face = "bold", size = 10)
    )
}

theme_set(theme_gimes())
```

# Uvod

U ovom izvještaju se predstavlja sveobuhvatna analiza medijske pokrivenosti društvenog povjerenja i optimizma u Hrvatskoj. Analizom se obuhvaća praćenje institucionalnog povjerenja, zadovoljstva životom, društvenog raspoloženja i perspektiva za budućnost temeljem članaka iz hrvatskih online medija.

## Motivacija i kontekst

Društveno povjerenje i optimizam predstavljaju ključne indikatore socijalne kohezije i kvalitete života u suvremenim društvima. Ovim izvještajem se nastoji odgovoriti na ključna pitanja:

1. Kako se medijsko izvještavanje o povjerenju i optimizmu razvijalo kroz vrijeme?
2. Koje institucije uživaju najviše/najmanje povjerenja prema medijskom diskursu?
3. Kako se kreću indikatori zadovoljstva životom i perspektiva za budućnost?
4. Postoje li sezonski obrasci u izvještavanju o društvenom raspoloženju?

## Struktura izvještaja

U izvještaju se obrađuju sljedeće teme: metodologija identifikacije relevantnih članaka, eksploratorni pregled dataseta, semantička taksonomija pojmova vezanih uz povjerenje i optimizam, konstrukcija specijaliziranih indeksa, vizualizacija indeksa, sektorska analiza, sentiment analiza, volatilnost i momentum, koncentracija tema te korelacije između indeksa.

```{r load-data}
#| label: load-data

#dt <- as.data.table(read.xlsx(here("data", "trust_filtered.xlsx")))
dt <- as.data.table(read.xlsx("C:/Users/lsikic/Desktop/trust_filtered.xlsx"))

if (is.numeric(dt$DATE)) {
  dt[, DATE := as.Date(DATE, origin = "1899-12-30")]
} else {
  dt[, DATE := as.Date(DATE)]
}

if ("text_length" %in% names(dt)) dt[, text_length := as.numeric(text_length)]
if ("REACH" %in% names(dt)) dt[, REACH := as.numeric(REACH)]
if ("INTERACTIONS" %in% names(dt)) dt[, INTERACTIONS := as.numeric(INTERACTIONS)]

dt[, `:=`(
  date = DATE,
  year = year(DATE),
  month = month(DATE),
  week = isoweek(DATE),
  quarter = quarter(DATE),
  yearmonth = floor_date(DATE, "month"),
  yearweek = floor_date(DATE, "week"),
  yearquarter = floor_date(DATE, "quarter")
)]

date_min <- min(dt$date, na.rm = TRUE)
date_max <- max(dt$date, na.rm = TRUE)

cat("Učitano", format(nrow(dt), big.mark = ","), "članaka\n")
cat("Vremenski raspon:", format(date_min, "%d.%m.%Y"), "do", format(date_max, "%d.%m.%Y"), "\n")
```

# Metodologija identifikacije članaka

## Pregled procesa filtriranja

Identifikacija relevantnih članaka se provodi kroz sedmostupanjski proces filtriranja koji kombinira strukturne kriterije, ključne riječi i kontekstualnu validaciju. Proces osigurava da u analizu ulaze samo članci koji su stvarno relevantni za tematiku društvenog povjerenja i optimizma u hrvatskom kontekstu.

::: {.callout-note collapse="true" title="Detaljna metodologija filtriranja"}

**Filter 1: Tip izvora**

Odabiru se samo web izvori kako bi se osigurala konzistentnost formata i dostupnost punog teksta članka.

**Filter 2: Relevantni news portali**

Koristi se lista verificiranih hrvatskih news portala kategoriziranih u pet skupina: nacionalni mediji, poslovni mediji, regionalni mediji, specijalizirani mediji i opinion portali.

**Filter 3: Minimalna duljina teksta**

Članci moraju sadržavati minimalno 500 znakova u punom tekstu.

**Filter 4: Naslov članka**

Naslov članka mora sadržavati pojmove vezane uz povjerenje, optimizam, zadovoljstvo, istraživanja javnog mnijenja ili kvalitetu života.

**Filter 5: Core pojmovi**

Puni tekst članka mora sadržavati core pojmove koji potvrđuju relevantnost za tematiku društvenog povjerenja i optimizma.

**Filter 6: Isključivanje irelevantnog sadržaja**

Isključuju se članci o sportu, zabavi i zadovoljstvu korisnika/kupaca, osim ako sadrže snažne override pojmove.

**Filter 7: Hrvatski kontekst**

Članci moraju sadržavati reference na hrvatsko društvo i institucije.

:::

# Eksploratorni pregled podataka

## Osnovne statistike

```{r basic-stats}
#| label: basic-stats

stats_summary <- data.table(
  Metrika = c(
    "Ukupan broj članaka",
    "Vremenski raspon",
    "Broj dana",
    "Prosječno članaka dnevno",
    "Broj izvora (portala)",
    "Broj kategorija izvora"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%d.%m.%Y"), "do", format(max(dt$date), "%d.%m.%Y")),
    as.character(as.numeric(max(dt$date) - min(dt$date))),
    round(nrow(dt) / as.numeric(max(dt$date) - min(dt$date)), 2),
    length(unique(dt$FROM)),
    length(unique(dt$source_category))
  )
)

kable(stats_summary, col.names = c("Metrika", "Vrijednost"),
      caption = "Osnovne statistike dataseta") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Distribucija po kategorijama izvora

```{r source-category}
#| label: source-category
#| fig-cap: "Distribucija članaka po kategorijama izvora"

cat_summary <- dt[, .(
  N = .N,
  Postotak = round(.N / nrow(dt) * 100, 1)
), by = source_category][order(-N)]

ggplot(cat_summary, aes(x = reorder(source_category, N), y = N, fill = source_category)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(format(N, big.mark = ","), "\n(", Postotak, "%)")), 
            hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_manual(values = c("national" = colors_gimes["primary"],
                               "business" = colors_gimes["accent"],
                               "regional" = colors_gimes["success"],
                               "specialized" = colors_gimes["warning"],
                               "opinion" = colors_gimes["purple"])) +
  labs(
    title = "Broj članaka po kategoriji izvora",
    x = NULL,
    y = "Broj članaka"
  )
```

## Top 20 izvora

```{r top-sources}
#| label: top-sources
#| fig-cap: "20 najaktivnijih izvora"

top_sources <- dt[, .(N = .N), by = FROM][order(-N)][1:20]

ggplot(top_sources, aes(x = reorder(FROM, N), y = N)) +
  geom_col(fill = colors_gimes["primary"]) +
  geom_text(aes(label = format(N, big.mark = ",")), hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(labels = comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "Top 20 izvora po broju članaka o povjerenju i optimizmu",
    x = NULL,
    y = "Broj članaka"
  )
```

## Distribucija duljine teksta

```{r text-length}
#| label: text-length
#| fig-cap: "Distribucija duljine članaka"

if ("text_length" %in% names(dt)) {
  ggplot(dt, aes(x = text_length)) +
    geom_histogram(bins = 50, fill = colors_gimes["primary"], alpha = 0.8, color = "white") +
    geom_vline(xintercept = median(dt$text_length, na.rm = TRUE), 
               color = colors_gimes["danger"], linetype = "dashed", linewidth = 1) +
    annotate("text", x = median(dt$text_length, na.rm = TRUE) + 500, 
             y = Inf, vjust = 2, hjust = 0,
             label = paste("Medijan:", format(round(median(dt$text_length, na.rm = TRUE)), big.mark = ",")),
             color = colors_gimes["danger"], fontface = "bold") +
    scale_x_continuous(labels = comma) +
    scale_y_continuous(labels = comma) +
    labs(
      title = "Distribucija duljine članaka",
      subtitle = "Broj znakova u punom tekstu",
      x = "Broj znakova",
      y = "Broj članaka"
    )
}
```

## Dnevna frekvencija članaka

```{r daily-frequency}
#| label: daily-frequency
#| fig-cap: "Dnevni broj članaka o povjerenju i optimizmu"
#| fig-height: 8

daily <- dt[, .(N = .N), by = date][order(date)]
daily[, MA7 := frollmean(N, n = 7, align = "center")]
daily[, MA30 := frollmean(N, n = 30, align = "center")]

ggplot(daily, aes(x = date)) +
  geom_col(aes(y = N), fill = colors_gimes["light"], alpha = 0.5, width = 1) +
  geom_line(aes(y = MA7, color = "7-dnevni prosjek"), linewidth = 0.8, na.rm = TRUE) +
  geom_line(aes(y = MA30, color = "30-dnevni prosjek"), linewidth = 1.2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(labels = comma) +
  scale_color_manual(values = c("7-dnevni prosjek" = colors_gimes["accent"],
                                "30-dnevni prosjek" = colors_gimes["success"])) +
  labs(
    title = "Dnevna frekvencija članaka o društvenom povjerenju i optimizmu",
    subtitle = "Broj članaka po danu sa kliznim prosjekom",
    x = NULL,
    y = "Broj članaka",
    color = "Klizni prosjek"
  )
```

## Mjesečna dinamika

```{r monthly-trend}
#| label: monthly-trend
#| fig-cap: "Mjesečni broj članaka"

monthly <- dt[, .(N = .N), by = yearmonth][order(yearmonth)]
monthly[, MA3 := frollmean(N, n = 3, align = "center")]

ggplot(monthly, aes(x = yearmonth)) +
  geom_col(aes(y = N), fill = colors_gimes["primary"], alpha = 0.7, width = 25) +
  geom_line(aes(y = MA3), color = colors_gimes["success"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = MA3), color = colors_gimes["success"], size = 2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(labels = comma) +
  labs(
    title = "Mjesečni broj članaka o povjerenju i optimizmu",
    subtitle = "Zelena linija = 3-mjesečni klizni prosjek",
    x = NULL,
    y = "Broj članaka"
  )
```

## Godišnja usporedba

```{r yearly-comparison}
#| label: yearly-comparison
#| fig-cap: "Usporedba mjesečne dinamike po godinama"

yearly_monthly <- dt[, .(N = .N), by = .(year, month)][order(year, month)]

ggplot(yearly_monthly, aes(x = month, y = N, color = factor(year), group = year)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2.5) +
  scale_x_continuous(breaks = 1:12, labels = c("Sij", "Velj", "Ožu", "Tra", "Svi", "Lip",
                                                "Srp", "Kol", "Ruj", "Lis", "Stu", "Pro")) +
  scale_y_continuous(labels = comma) +
  scale_color_brewer(palette = "Set1") +
  labs(
    title = "Mjesečna dinamika po godinama",
    x = "Mjesec",
    y = "Broj članaka",
    color = "Godina"
  )
```

# Semantička taksonomija

## Hijerarhijska struktura pojmova

Semantički rječnik se temelji na pojmovima identificiranima u procesu filtriranja članaka. Taksonomija se organizira u 12 kategorija koje obuhvaćaju različite aspekte povjerenja, zadovoljstva i društvenog raspoloženja u hrvatskom kontekstu. Pojmovi se definiraju pomoću korijena riječi (stem) kako bi se osigurala šira morfološka pokrivenost hrvatskog jezika.

::: {.callout-note collapse="true" title="Detaljna metodologija semantičke taksonomije"}

**Princip konstrukcije rječnika:**

1. Kategorije predstavljaju konceptualno različite aspekte povjerenja i optimizma
2. Regex uzorci se koriste za fleksibilno prepoznavanje morfoloških varijanti
3. Korijenski oblici osiguravaju prepoznavanje svih padežnih i glagolskih oblika

**Morfološka pokrivenost:**

Za hrvatski jezik koji ima bogatu morfologiju, koriste se korijenski oblici s opcionalnim nastavcima, alternativni oblici za palatalizaciju i wildcard znakovi koji dopuštaju varijabilnost između riječi.

**Formula za brojanje:**

$$
\text{count}_{c,d} = \sum_{p \in P_c} \text{matches}(p, d)
$$

gdje je $P_c$ skup regex uzoraka za kategoriju $c$, a $d$ je tekst dokumenta.

:::

```{r semantic-dictionary}
#| label: semantic-dictionary

semantic_terms <- list(
  
  povjerenje_opce = c(
    "povjerenj[a-zčćžšđ]*",
    "nepovjerenj[a-zčćžšđ]*",
    "vjeruj[a-zčćžšđ]*",
    "ne vjeruj[a-zčćžšđ]*",
    "(rast|pad|gubitak|kriza).{0,10}povjerenj",
    "me[dđ]uljudsk[a-zčćžšđ]*.{0,10}povjerenj"
  ),
  
  povjerenje_vlada = c(
    "povjerenj[a-zčćžšđ]*.{0,15}vlad[a-zčćžšđ]*",
    "povjerenj[a-zčćžšđ]*.{0,15}sabor[a-zčćžšđ]*",
    "povjerenj[a-zčćžšđ]*.{0,15}predsjedni[a-zčćžšđ]*",
    "vlad[a-zčćžšđ]*.{0,15}povjerenj",
    "sabor[a-zčćžšđ]*.{0,15}povjerenj",
    "(ne)?povjerenj[a-zčćžšđ]*.{0,10}politi[cč]ar"
  ),
  
  povjerenje_pravosude = c(
    "povjerenj[a-zčćžšđ]*.{0,15}(sud|sudstv|pravosud|pravosud)",
    "povjerenj[a-zčćžšđ]*.{0,15}dr[zž]avn[a-zčćžšđ]*.{0,10}odvjetni[sš]tv",
    "(sud|pravosud)[a-zčćžšđ]*.{0,15}povjerenj",
    "povjerenj[a-zčćžšđ]*.{0,15}uskok",
    "povjerenj[a-zčćžšđ]*.{0,15}pravosu[dđ][a-zčćžšđ]*"
  ),
  
  povjerenje_sigurnost = c(
    "povjerenj[a-zčćžšđ]*.{0,15}policij[a-zčćžšđ]*",
    "povjerenj[a-zčćžšđ]*.{0,15}vojsk[a-zčćžšđ]*",
    "povjerenj[a-zčćžšđ]*.{0,15}oru[zž]an[a-zčćžšđ]*.{0,10}snag",
    "policij[a-zčćžšđ]*.{0,15}povjerenj",
    "vojsk[a-zčćžšđ]*.{0,15}povjerenj"
  ),
  
  povjerenje_mediji = c(
    "povjerenj[a-zčćžšđ]*.{0,15}medij[a-zčćžšđ]*",
    "povjerenj[a-zčćžšđ]*.{0,15}novin[a-zčćžšđ]*",
    "medij[a-zčćžšđ]*.{0,15}povjerenj",
    "povjerenj[a-zčćžšđ]*.{0,15}televizij",
    "(ne)?vjeruj[a-zčćžšđ]*.{0,10}medij"
  ),
  
  povjerenje_crkva = c(
    "povjerenj[a-zčćžšđ]*.{0,15}crkv[a-zčćžšđ]*",
    "crkv[a-zčćžšđ]*.{0,15}povjerenj",
    "povjerenj[a-zčćžšđ]*.{0,15}(katoličk|vjers)"
  ),
  
  povjerenje_eu = c(
    "povjerenj[a-zčćžšđ]*.{0,15}(eu|europsk[a-zčćžšđ]*\\s+unij)",
    "(eu|europsk[a-zčćžšđ]*\\s+unij).{0,15}povjerenj",
    "eurobarometar[a-zčćžšđ]*"
  ),
  
  optimizam_pesimizam = c(
    "optimiz[a-zčćžšđ]*",
    "pesimiz[a-zčćžšđ]*",
    "optimisti[cč][a-zčćžšđ]*",
    "pesimisti[cč][a-zčćžšđ]*",
    "(gra[dđ]ani|hrvati|stanovni[sš]tvo).{0,15}(optimist|pesimist)"
  ),
  
  zadovoljstvo_zivotom = c(
    "zadovoljstv[a-zčćžšđ]*.{0,10}[zž]ivot[a-zčćžšđ]*",
    "nezadovoljstv[a-zčćžšđ]*.{0,10}[zž]ivot[a-zčćžšđ]*",
    "kvalitet[a-zčćžšđ]*.{0,10}[zž]ivot[a-zčćžšđ]*",
    "[zž]ivotn[a-zčćžšđ]*.{0,10}standard[a-zčćžšđ]*",
    "[zž]ivotn[a-zčćžšđ]*.{0,10}uvjet[a-zčćžšđ]*",
    "indeks.{0,10}(dobrobiti|blagostanja|sre[cć]e)"
  ),
  
  drustveno_raspolozenje = c(
    "dru[sš]tven[a-zčćžšđ]*.{0,10}raspolo[zž]enj[a-zčćžšđ]*",
    "raspolo[zž]enj[a-zčćžšđ]*.{0,10}(gra[dđ]an|javn|stanovni|dru[sš]tv)",
    "op[cć][a-zčćžšđ]*.{0,10}raspolo[zž]enj",
    "atmosfer[a-zčćžšđ]*.{0,10}dru[sš]tv"
  ),
  
  strah_zabrinutost = c(
    "(strah|zabrinutost|tjeskob)[a-zčćžšđ]*.{0,15}(gra[dđ]an|javn|stanovni)",
    "(gra[dđ]ani|hrvati|stanovni[sš]tvo).{0,15}(strahuj|zabrinut)",
    "kolektivn[a-zčćžšđ]*.{0,10}(strah|zabrinutost)",
    "(ve[cć]ina|posto).{0,10}(strahuje|zabrinut)"
  ),
  
  buducnost_perspektive = c(
    "(o[cč]ekivanj|izgled|perspektiv)[a-zčćžšđ]*.{0,15}(gra[dđ]an|hrvatsk)",
    "budu[cć]nost[a-zčćžšđ]*.{0,10}(hrvatsk|na[sš])",
    "(gra[dđ]ani|hrvati).{0,15}(o[cč]ekuj|perspektiv)",
    "nada.{0,10}(za|u).{0,10}budu[cć]nost"
  )
)

category_display <- c(
  "povjerenje_opce" = "Opće povjerenje/nepovjerenje",
  "povjerenje_vlada" = "Povjerenje: Vlada i Sabor",
  "povjerenje_pravosude" = "Povjerenje: Pravosuđe",
  "povjerenje_sigurnost" = "Povjerenje: Policija i vojska",
  "povjerenje_mediji" = "Povjerenje: Mediji",
  "povjerenje_crkva" = "Povjerenje: Crkva",
  "povjerenje_eu" = "Povjerenje: EU",
  "optimizam_pesimizam" = "Optimizam/Pesimizam",
  "zadovoljstvo_zivotom" = "Zadovoljstvo životom",
  "drustveno_raspolozenje" = "Društveno raspoloženje",
  "strah_zabrinutost" = "Strah i zabrinutost",
  "buducnost_perspektive" = "Budućnost i perspektive"
)

term_summary <- data.table(
  Kategorija = names(semantic_terms),
  Kategorija_display = category_display[names(semantic_terms)],
  Broj_pojmova = sapply(semantic_terms, length),
  Primjeri = sapply(semantic_terms, function(x) paste(head(x, 2), collapse = ", "))
)

kable(term_summary[, .(Kategorija_display, Broj_pojmova, Primjeri)], 
      col.names = c("Kategorija", "Broj pojmova", "Primjeri regex uzoraka"),
      caption = "Pregled rječnika semantičkih pojmova za povjerenje i optimizam") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Brojanje semantičkih pojmova

```{r count-semantic-terms}
#| label: count-semantic-terms

count_terms <- function(text, patterns) {
  if (is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) {
    stri_count_regex(text_lower, p)
  }))
}

for (cat_name in names(semantic_terms)) {
  col_name <- paste0("count_", cat_name)
  dt[, (col_name) := sapply(FULL_TEXT, count_terms, patterns = semantic_terms[[cat_name]])]
}

dt[, count_all_semantic := rowSums(.SD), .SDcols = patterns("^count_")]
```

## Mjesečna agregacija semantičkih pojmova

```{r monthly-semantic}
#| label: monthly-semantic

semantic_cols <- names(dt)[grepl("^count_", names(dt))]

monthly_semantic <- dt[, c(
  .(N = .N),
  lapply(.SD, sum, na.rm = TRUE),
  lapply(.SD, mean, na.rm = TRUE) |> setNames(paste0(names(.SD), "_avg"))
), by = yearmonth, .SDcols = semantic_cols][order(yearmonth)]

monthly_semantic[, total_mentions := count_all_semantic]
```

## Vizualizacija semantičkih kategorija kroz vrijeme

```{r semantic-time-series}
#| label: semantic-time-series
#| fig-cap: "Dinamika semantičkih kategorija kroz vrijeme"
#| fig-height: 12

semantic_long <- melt(
  monthly_semantic[, .(yearmonth, 
                       count_povjerenje_opce,
                       count_povjerenje_vlada,
                       count_povjerenje_pravosude,
                       count_povjerenje_sigurnost,
                       count_povjerenje_mediji,
                       count_povjerenje_crkva,
                       count_povjerenje_eu,
                       count_optimizam_pesimizam,
                       count_zadovoljstvo_zivotom,
                       count_drustveno_raspolozenje,
                       count_strah_zabrinutost,
                       count_buducnost_perspektive)],
  id.vars = "yearmonth",
  variable.name = "kategorija",
  value.name = "broj"
)

category_labels <- c(
  "count_povjerenje_opce" = "Opće povjerenje",
  "count_povjerenje_vlada" = "Povj: Vlada/Sabor",
  "count_povjerenje_pravosude" = "Povj: Pravosuđe",
  "count_povjerenje_sigurnost" = "Povj: Policija/Vojska",
  "count_povjerenje_mediji" = "Povj: Mediji",
  "count_povjerenje_crkva" = "Povj: Crkva",
  "count_povjerenje_eu" = "Povj: EU",
  "count_optimizam_pesimizam" = "Optimizam/Pesimizam",
  "count_zadovoljstvo_zivotom" = "Zadovoljstvo životom",
  "count_drustveno_raspolozenje" = "Društveno raspoloženje",
  "count_strah_zabrinutost" = "Strah/Zabrinutost",
  "count_buducnost_perspektive" = "Budućnost/Perspektive"
)

semantic_long[, kategorija_label := category_labels[as.character(kategorija)]]

ggplot(semantic_long, aes(x = yearmonth, y = broj, color = kategorija_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~kategorija_label, ncol = 3, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_brewer(palette = "Set3") +
  labs(
    title = "Dinamika semantičkih kategorija povjerenja i optimizma kroz vrijeme",
    subtitle = "Mjesečni broj spominjanja po kategoriji pojmova",
    x = NULL,
    y = "Broj spominjanja",
    color = NULL
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
  )
```

# Konstrukcija indeksa

### General Trust Index (GTI)

GTI kvantificira intenzitet diskursa o povjerenju i nepovjerenju u općem smislu, bez specifičnog institucionalnog fokusa. Konstrukcija se temelji na prebrojavanju pojavljivanja korijena riječi koje signaliziraju povjerenje ili nepovjerenje, kao što su povjerenj, nepovjerenj, vjeruj i slično. Suma tih pojavljivanja normalizira se brojem članaka kako bi se dobila prosječna mjesečna frekvencija pojmova povjerenja. Rezultat se skalira na raspon 0 do 100 standardnom normalizacijom. Povišene vrijednosti GTI indeksa indiciraju razdoblja intenzivnog medijskog diskursa o temi povjerenja.

::: {.callout-note collapse="true"}
## Detaljna metodologija GTI indeksa

**Formula:**

$$
\text{GTI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_opce,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje, nepovjerenje, vjeruju/ne vjeruju, rast/pad/gubitak povjerenja, međuljudsko povjerenje

**Normalizacija (min-max):**

$$
X_{norm} = \frac{X - \min(X)}{\max(X) - \min(X)} \times 100
$$

:::

### Political Trust Index (PTI)

PTI prati intenzitet diskursa o povjerenju u političke institucije, uključujući Vladu, Sabor, predsjednika i političare općenito. Indeks se konstruira identifikacijom kolokacija pojmova povjerenja s političkim akterima i institucijama. Normalizacija brojem članaka osigurava usporedivost kroz različite periode medijske aktivnosti. Vrhovi PTI indeksa koincidiraju s političkim krizama, izbornim ciklusima i skandalima koji utječu na percepciju političkog sustava.

::: {.callout-note collapse="true"}
## Detaljna metodologija PTI indeksa

**Formula:**

$$
\text{PTI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_vlada,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje u vladu, povjerenje u Sabor, povjerenje u predsjednika, (ne)povjerenje u političare

:::

### Judicial Trust Index (JTI)

JTI mjeri povjerenje u pravosuđe i pravni sustav. Indeks obuhvaća reference na sudove, državno odvjetništvo, USKOK i pravosuđe općenito u kontekstu povjerenja. Konstrukcija prati istu metodologiju normalizacije kao ostali indeksi. Varijacije JTI indeksa reflektiraju medijsku percepciju efikasnosti i nepristranosti pravosudnog sustava.

::: {.callout-note collapse="true"}
## Detaljna metodologija JTI indeksa

**Formula:**

$$
\text{JTI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_pravosude,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje u sudove, pravosuđe, državno odvjetništvo, USKOK

:::

### Security Trust Index (STI)

STI prati povjerenje u sigurnosne institucije, primarno policiju i vojsku. Indeks identificira kolokacije pojmova povjerenja sa sigurnosnim aparatom države. Stabilne vrijednosti STI indeksa tradicionalno ukazuju na visoku razinu povjerenja građana u sigurnosne institucije, dok nagle promjene mogu signalizirati kontroverzne slučajeve ili krize.

::: {.callout-note collapse="true"}
## Detaljna metodologija STI indeksa

**Formula:**

$$
\text{STI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_sigurnost,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje u policiju, vojsku, oružane snage

:::

### Media Trust Index (MTI)

MTI mjeri intenzitet diskursa o povjerenju u medije. Indeks obuhvaća reference na novine, televiziju i medije općenito u kontekstu (ne)povjerenja. Pad MTI indeksa može signalizirati eroziju povjerenja u medijske institucije, dok rast može ukazivati na pojačanu debatu o ulozi medija u društvu.

::: {.callout-note collapse="true"}
## Detaljna metodologija MTI indeksa

**Formula:**

$$
\text{MTI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_mediji,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje u medije, novine, televiziju

:::

### Religious Trust Index (RTI)

RTI prati povjerenje u Crkvu i vjerske institucije. Indeks identificira kolokacije pojmova povjerenja s crkvenim i religijskim referentima. Dinamika RTI indeksa reflektira ulogu Crkve u javnom diskursu i percepciju njenog društvenog utjecaja.

::: {.callout-note collapse="true"}
## Detaljna metodologija RTI indeksa

**Formula:**

$$
\text{RTI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_crkva,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje u Crkvu, katoličke i vjerske institucije

:::

### EU Trust Index (ETI)

ETI mjeri povjerenje u Europsku uniju i europske institucije. Indeks koristi podatke iz Eurobarometra i reference na EU u kontekstu povjerenja. Dinamika ETI indeksa prati europske integracije i percepciju EU članstva u hrvatskom javnom diskursu.

::: {.callout-note collapse="true"}
## Detaljna metodologija ETI indeksa

**Formula:**

$$
\text{ETI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{povjerenje\_eu,t}}{N_t}\right)
$$

**Uključeni pojmovi:** povjerenje u EU, europske institucije, Eurobarometar

:::

### Optimism-Pessimism Index (OPI)

OPI mjeri balans između optimizma i pesimizma u medijskom diskursu o društvenom raspoloženju. Indeks kombinira reference na optimizam i pesimizam građana, omogućujući praćenje kolektivnog sentimenta. Visoke vrijednosti OPI indeksa ukazuju na intenzivan diskurs o kolektivnom raspoloženju, bez nužne implikacije o smjeru tog raspoloženja.

::: {.callout-note collapse="true"}
## Detaljna metodologija OPI indeksa

**Formula:**

$$
\text{OPI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{optimizam\_pesimizam,t}}{N_t}\right)
$$

**Uključeni pojmovi:** optimizam, pesimizam, optimističan/pesimističan, kolektivno raspoloženje

:::

### Life Satisfaction Index (LSI)

LSI prati intenzitet diskursa o kvaliteti života i zadovoljstvu životom. Indeks obuhvaća reference na životni standard, životne uvjete i indekse dobrobiti. Povišene vrijednosti LSI indeksa indiciraju pojačan interes za teme kvalitete života, često u kontekstu komparativnih analiza ili istraživanja.

::: {.callout-note collapse="true"}
## Detaljna metodologija LSI indeksa

**Formula:**

$$
\text{LSI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{zadovoljstvo\_zivotom,t}}{N_t}\right)
$$

**Uključeni pojmovi:** zadovoljstvo životom, kvaliteta života, životni standard, životni uvjeti, indeks dobrobiti/blagostanja/sreće

:::

### Social Mood Index (SMI)

SMI mjeri opće društveno raspoloženje percipirano kroz medijski diskurs. Indeks identificira reference na kolektivnu atmosferu, javno raspoloženje i društvenu klimu. Varijacije SMI indeksa reflektiraju percepciju društvene kohezije i općeg stanja u društvu.

::: {.callout-note collapse="true"}
## Detaljna metodologija SMI indeksa

**Formula:**

$$
\text{SMI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{drustveno\_raspolozenje,t}}{N_t}\right)
$$

**Uključeni pojmovi:** društveno raspoloženje, javna atmosfera, opće raspoloženje

:::

### Fear-Worry Index (FWI)

FWI kvantificira intenzitet diskursa o kolektivnom strahu i zabrinutosti građana. Indeks identificira reference na strahove, tjeskobe i zabrinutosti u kontekstu javnog mnijenja. Vrhovi FWI indeksa koincidiraju s kriznim razdobljima poput pandemije, rata ili ekonomskih šokova koji generiraju kolektivnu anksioznost.

::: {.callout-note collapse="true"}
## Detaljna metodologija FWI indeksa

**Formula:**

$$
\text{FWI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{strah\_zabrinutost,t}}{N_t}\right)
$$

**Uključeni pojmovi:** strah/zabrinutost/tjeskoba građana, kolektivni strah

:::

### Future Outlook Index (FOI)

FOI mjeri intenzitet diskursa o perspektivama i očekivanjima za budućnost. Indeks obuhvaća reference na izglede, perspektive i nadanja građana. Dinamika FOI indeksa reflektira kolektivnu orijentaciju prema budućnosti i percepciju razvojnih mogućnosti.

::: {.callout-note collapse="true"}
## Detaljna metodologija FOI indeksa

**Formula:**

$$
\text{FOI}_t = \text{normalize}_{0-100}\left(\frac{\text{count}_{buducnost\_perspektive,t}}{N_t}\right)
$$

**Uključeni pojmovi:** očekivanja, izgledi, perspektive, nada za budućnost

:::

### Composite Trust Index (CTI)

CTI predstavlja kompozitni indeks koji agregira svih 12 specijaliziranih indeksa u jedinstvenu mjeru intenziteta diskursa o povjerenju i optimizmu. Konstrukcija se temelji na jednostavnom prosjeku normaliziranih vrijednosti svih komponenti. CTI pruža holističku sliku medijske percepcije društvenog povjerenja i raspoloženja.

::: {.callout-note collapse="true"}
## Detaljna metodologija CTI indeksa

**Formula:**

$$
\text{CTI}_t = \frac{1}{12} \sum_{i=1}^{12} \text{Indeks}_{i,t}
$$

**Interpretacija vrijednosti:**

- 0-25: Niska razina diskursa o temi
- 25-50: Umjerena razina
- 50-75: Visoka razina
- 75-100: Vrlo visoka razina (intenzivna medijska pozornost)

:::

## Opis indeksa

```{r index-calculation}
#| label: index-calculation

index_data <- dt[, .(
  volume = .N,
  avg_length = mean(text_length, na.rm = TRUE),
  avg_reach = if ("REACH" %in% names(.SD)) mean(REACH, na.rm = TRUE) else NA_real_,
  
  sem_povjerenje_opce = sum(count_povjerenje_opce, na.rm = TRUE),
  sem_povjerenje_vlada = sum(count_povjerenje_vlada, na.rm = TRUE),
  sem_povjerenje_pravosude = sum(count_povjerenje_pravosude, na.rm = TRUE),
  sem_povjerenje_sigurnost = sum(count_povjerenje_sigurnost, na.rm = TRUE),
  sem_povjerenje_mediji = sum(count_povjerenje_mediji, na.rm = TRUE),
  sem_povjerenje_crkva = sum(count_povjerenje_crkva, na.rm = TRUE),
  sem_povjerenje_eu = sum(count_povjerenje_eu, na.rm = TRUE),
  sem_optimizam = sum(count_optimizam_pesimizam, na.rm = TRUE),
  sem_zadovoljstvo = sum(count_zadovoljstvo_zivotom, na.rm = TRUE),
  sem_raspolozenje = sum(count_drustveno_raspolozenje, na.rm = TRUE),
  sem_strah = sum(count_strah_zabrinutost, na.rm = TRUE),
  sem_buducnost = sum(count_buducnost_perspektive, na.rm = TRUE),
  sem_total = sum(count_all_semantic, na.rm = TRUE)
), by = yearmonth][order(yearmonth)]

normalize <- function(x) {
  if (all(is.na(x))) return(rep(50, length(x)))
  min_x <- min(x, na.rm = TRUE)
  max_x <- max(x, na.rm = TRUE)
  if (max_x == min_x) return(rep(50, length(x)))
  (x - min_x) / (max_x - min_x) * 100
}

index_data[, `:=`(
  GTI = normalize(sem_povjerenje_opce / volume),
  PTI = normalize(sem_povjerenje_vlada / volume),
  JTI = normalize(sem_povjerenje_pravosude / volume),
  STI = normalize(sem_povjerenje_sigurnost / volume),
  MTI = normalize(sem_povjerenje_mediji / volume),
  RTI = normalize(sem_povjerenje_crkva / volume),
  ETI = normalize(sem_povjerenje_eu / volume),
  OPI = normalize(sem_optimizam / volume),
  LSI = normalize(sem_zadovoljstvo / volume),
  SMI = normalize(sem_raspolozenje / volume),
  FWI = normalize(sem_strah / volume),
  FOI = normalize(sem_buducnost / volume)
)]

index_data[, CTI := (GTI + PTI + JTI + STI + MTI + RTI + ETI + OPI + LSI + SMI + FWI + FOI) / 12]

index_cols <- c("GTI", "PTI", "JTI", "STI", "MTI", "RTI", "ETI", "OPI", "LSI", "SMI", "FWI", "FOI", "CTI")
for (col in index_cols) {
  ma_col <- paste0(col, "_MA3")
  index_data[, (ma_col) := frollmean(get(col), n = 3, align = "center")]
}
```

```{r index-summary-table}
#| label: index-summary-table

index_desc <- data.table(
  Indeks = c("GTI", "PTI", "JTI", "STI", "MTI", "RTI", "ETI", "OPI", "LSI", "SMI", "FWI", "FOI", "CTI"),
  Naziv = c("General Trust Index", "Political Trust Index", "Judicial Trust Index", 
            "Security Trust Index", "Media Trust Index", "Religious Trust Index",
            "EU Trust Index", "Optimism-Pessimism Index", "Life Satisfaction Index",
            "Social Mood Index", "Fear-Worry Index", "Future Outlook Index", 
            "Composite Trust Index"),
  Opis = c("Opći diskurs o povjerenju/nepovjerenju",
           "Povjerenje u Vladu, Sabor, političare",
           "Povjerenje u pravosuđe i sudove",
           "Povjerenje u policiju i vojsku",
           "Povjerenje u medije",
           "Povjerenje u Crkvu",
           "Povjerenje u EU institucije",
           "Diskurs o optimizmu i pesimizmu",
           "Kvaliteta života i zadovoljstvo",
           "Opće društveno raspoloženje",
           "Kolektivni strah i zabrinutost",
           "Perspektive i očekivanja za budućnost",
           "Kompozitni prosjek svih indeksa")
)

kable(index_desc, caption = "Pregled konstruiranih indeksa") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

# Vizualizacija indeksa

## Glavni indeksi

### Composite Trust Index (CTI)

```{r cti-plot}
#| label: cti-plot
#| fig-cap: "Composite Trust Index (CTI)"
#| fig-height: 7

ggplot(index_data, aes(x = yearmonth)) +
  geom_ribbon(aes(ymin = 0, ymax = CTI), fill = colors_gimes["success"], alpha = 0.3) +
  geom_line(aes(y = CTI), color = colors_gimes["success"], linewidth = 0.8, alpha = 0.5) +
  geom_line(aes(y = CTI_MA3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  geom_point(aes(y = CTI_MA3), color = colors_gimes["primary"], size = 2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20)) +
  labs(
    title = "Composite Trust Index (CTI)",
    subtitle = "Prosjek svih kategorija (0-100) | Tamna linija = 3-mj. klizni prosjek",
    x = NULL,
    y = "CTI"
  )
```

### General Trust Index (GTI)

```{r gti-plot}
#| label: gti-plot
#| fig-cap: "General Trust Index (GTI)"

ggplot(index_data, aes(x = yearmonth)) +
  geom_line(aes(y = GTI), color = colors_gimes["primary"], linewidth = 1) +
  geom_line(aes(y = GTI_MA3), color = colors_gimes["danger"], linewidth = 1.2, linetype = "dashed", na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(limits = c(0, 100)) +
  labs(
    title = "General Trust Index (GTI)",
    subtitle = "Crvena isprekidana linija = 3-mj. klizni prosjek",
    x = NULL,
    y = "GTI (0-100)"
  )
```

## Institucionalni indeksi povjerenja

```{r institutional-trust-plot}
#| label: institutional-trust-plot
#| fig-cap: "Indeksi institucionalnog povjerenja (PTI, JTI, STI, MTI, RTI, ETI)"
#| fig-height: 10

inst_labels <- c(
  "PTI" = "Political Trust Index (PTI)",
  "JTI" = "Judicial Trust Index (JTI)",
  "STI" = "Security Trust Index (STI)",
  "MTI" = "Media Trust Index (MTI)",
  "RTI" = "Religious Trust Index (RTI)",
  "ETI" = "EU Trust Index (ETI)"
)

inst_indices <- melt(
  index_data[, .(yearmonth, PTI, JTI, STI, MTI, RTI, ETI)],
  id.vars = "yearmonth",
  variable.name = "indeks",
  value.name = "vrijednost"
)

inst_indices[, indeks_label := inst_labels[as.character(indeks)]]

ggplot(inst_indices, aes(x = yearmonth, y = vrijednost, color = indeks_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~indeks_label, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_brewer(palette = "Set2") +
  labs(
    title = "Indeksi institucionalnog povjerenja kroz vrijeme",
    subtitle = "Normalizirane vrijednosti (0-100)",
    x = NULL,
    y = "Vrijednost indeksa",
    color = NULL
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
  )
```

## Indeksi raspoloženja i perspektiva

```{r mood-indices-plot}
#| label: mood-indices-plot
#| fig-cap: "Indeksi raspoloženja i perspektiva (OPI, LSI, SMI, FWI, FOI)"
#| fig-height: 10

mood_labels <- c(
  "OPI" = "Optimism-Pessimism Index (OPI)",
  "LSI" = "Life Satisfaction Index (LSI)",
  "SMI" = "Social Mood Index (SMI)",
  "FWI" = "Fear-Worry Index (FWI)",
  "FOI" = "Future Outlook Index (FOI)"
)

mood_indices <- melt(
  index_data[, .(yearmonth, OPI, LSI, SMI, FWI, FOI)],
  id.vars = "yearmonth",
  variable.name = "indeks",
  value.name = "vrijednost"
)

mood_indices[, indeks_label := mood_labels[as.character(indeks)]]

ggplot(mood_indices, aes(x = yearmonth, y = vrijednost, color = indeks_label)) +
  geom_line(linewidth = 1) +
  facet_wrap(~indeks_label, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c(
    "Optimism-Pessimism Index (OPI)" = colors_gimes["success"],
    "Life Satisfaction Index (LSI)" = colors_gimes["accent"],
    "Social Mood Index (SMI)" = colors_gimes["purple"],
    "Fear-Worry Index (FWI)" = colors_gimes["danger"],
    "Future Outlook Index (FOI)" = colors_gimes["warning"]
  )) +
  labs(
    title = "Indeksi raspoloženja i perspektiva kroz vrijeme",
    subtitle = "Normalizirane vrijednosti (0-100)",
    x = NULL,
    y = "Vrijednost indeksa",
    color = NULL
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1, size = 7)
  )
```

## Usporedba svih indeksa

```{r all-indices-stacked}
#| label: all-indices-stacked
#| fig-cap: "Svi indeksi povjerenja i optimizma"
#| fig-height: 12

p1 <- ggplot(index_data, aes(x = yearmonth)) +
  geom_line(aes(y = CTI), color = colors_gimes["primary"], linewidth = 1.2) +
  labs(title = "Composite Trust Index (CTI)", x = NULL, y = "Indeks (0-100)")

p2 <- ggplot(index_data, aes(x = yearmonth)) +
  geom_line(aes(y = GTI), color = colors_gimes["accent"], linewidth = 1) +
  labs(title = "General Trust Index (GTI)", x = NULL, y = "Indeks (0-100)")

p3 <- ggplot(index_data, aes(x = yearmonth)) +
  geom_line(aes(y = OPI), color = colors_gimes["success"], linewidth = 1) +
  labs(title = "Optimism-Pessimism Index (OPI)", x = NULL, y = "Indeks (0-100)")

p4 <- ggplot(index_data, aes(x = yearmonth)) +
  geom_line(aes(y = FWI), color = colors_gimes["danger"], linewidth = 1) +
  labs(title = "Fear-Worry Index (FWI)", x = NULL, y = "Indeks (0-100)")

p1 / p2 / p3 / p4
```

# Sektorska analiza

## Dinamika po sektorima

```{r sector-dynamics}
#| label: sector-dynamics
#| fig-cap: "Dinamika po kategorijama izvora"
#| fig-height: 8

sector_monthly <- dt[, .(
  N = .N,
  semantic_intensity = sum(count_all_semantic, na.rm = TRUE) / .N
), by = .(yearmonth, source_category)][order(yearmonth)]

ggplot(sector_monthly, aes(x = yearmonth, y = N, color = source_category)) +
  geom_line(linewidth = 1) +
  facet_wrap(~source_category, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c("national" = colors_gimes["primary"],
                                "business" = colors_gimes["accent"],
                                "regional" = colors_gimes["success"],
                                "specialized" = colors_gimes["warning"],
                                "opinion" = colors_gimes["purple"])) +
  labs(
    title = "Dinamika broja članaka po kategorijama izvora",
    x = NULL,
    y = "Broj članaka",
    color = NULL
  ) +
  theme(legend.position = "none")
```

## Heatmapa sektorske aktivnosti

```{r sector-heatmap}
#| label: sector-heatmap
#| fig-cap: "Heatmapa intenziteta diskursa po sektorima"
#| fig-height: 8

sector_heatmap <- dt[, .(
  semantic_intensity = sum(count_all_semantic, na.rm = TRUE) / .N
), by = .(yearmonth, source_category)]

ggplot(sector_heatmap, aes(x = yearmonth, y = source_category, fill = semantic_intensity)) +
  geom_tile() +
  scale_fill_viridis_c(option = "viridis", name = "Intenzitet") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b %y") +
  labs(
    title = "Heatmapa intenziteta semantičkog diskursa po kategorijama izvora",
    subtitle = "Tamnije boje indiciraju viši intenzitet pojmova povjerenja/optimizma",
    x = NULL,
    y = NULL
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))
```

## Korelacijska struktura

```{r sector-correlation}
#| label: sector-correlation
#| fig-cap: "Korelacija između kategorija izvora"

sector_wide <- dcast(sector_monthly, yearmonth ~ source_category, value.var = "N")
sector_cor <- cor(sector_wide[, -1, with = FALSE], use = "pairwise.complete.obs")

corrplot(sector_cor,
         method = "color",
         type = "upper",
         tl.col = "black",
         tl.srt = 45,
         addCoef.col = "black",
         number.cex = 0.8,
         col = colorRampPalette(c(colors_gimes["accent"], "white", colors_gimes["success"]))(100),
         title = "Korelacija aktivnosti između kategorija izvora",
         mar = c(0, 0, 2, 0))
```

# Sentiment analiza

## Komponente sentimenta

```{r sentiment-components}
#| label: sentiment-components
#| fig-cap: "Komponente sentimenta kroz vrijeme"
#| fig-height: 8

sentiment_data <- index_data[, .(
  yearmonth,
  Pozitivno = (OPI + LSI + FOI) / 3,
  Negativno = FWI,
  Neto = (OPI + LSI + FOI) / 3 - FWI
)]

sentiment_long <- melt(sentiment_data, id.vars = "yearmonth",
                       variable.name = "komponenta", value.name = "vrijednost")

ggplot(sentiment_long, aes(x = yearmonth, y = vrijednost, color = komponenta)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_line(linewidth = 1) +
  facet_wrap(~komponenta, ncol = 1, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c(
    "Pozitivno" = colors_gimes["success"],
    "Negativno" = colors_gimes["danger"],
    "Neto" = colors_gimes["primary"]
  )) +
  labs(
    title = "Komponente sentimenta povjerenja i optimizma",
    subtitle = "Pozitivno = (OPI + LSI + FOI) / 3 | Negativno = FWI | Neto = Pozitivno - Negativno",
    x = NULL,
    y = "Vrijednost indeksa",
    color = NULL
  ) +
  theme(legend.position = "none")
```

## Neto sentiment ratio

```{r net-sentiment}
#| label: net-sentiment
#| fig-cap: "Neto sentiment ratio kroz vrijeme"

index_data[, net_sentiment := ((OPI + LSI + FOI) / 3 - FWI)]
index_data[, net_sentiment_MA3 := frollmean(net_sentiment, n = 3, align = "center")]

ggplot(index_data, aes(x = yearmonth)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed", linewidth = 1) +
  geom_ribbon(aes(ymin = pmin(net_sentiment, 0), ymax = pmax(net_sentiment, 0)), 
              fill = colors_gimes["muted"], alpha = 0.3) +
  geom_line(aes(y = net_sentiment), color = colors_gimes["muted"], linewidth = 0.8) +
  geom_line(aes(y = net_sentiment_MA3), color = colors_gimes["primary"], linewidth = 1.2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "Neto Sentiment Ratio",
    subtitle = "Razlika između pozitivnih i negativnih komponenti sentimenta | Tamna linija = 3-mj. MA",
    x = NULL,
    y = "Neto sentiment"
  )
```

# Volatilnost i momentum

## Konstrukcija volatilnosti i momentuma

```{r volatility-momentum}
#| label: volatility-momentum

index_data[, `:=`(
  CTI_vol_3m = frollapply(CTI, n = 3, FUN = sd, align = "right"),
  CTI_mom_1m = CTI - shift(CTI, 1),
  CTI_mom_3m = CTI - shift(CTI, 3)
)]

index_data[, `:=`(
  CTI_vol_3m_z = (CTI_vol_3m - mean(CTI_vol_3m, na.rm = TRUE)) / sd(CTI_vol_3m, na.rm = TRUE),
  CTI_mom_1m_z = (CTI_mom_1m - mean(CTI_mom_1m, na.rm = TRUE)) / sd(CTI_mom_1m, na.rm = TRUE),
  CTI_mom_3m_z = (CTI_mom_3m - mean(CTI_mom_3m, na.rm = TRUE)) / sd(CTI_mom_3m, na.rm = TRUE)
)]
```

```{r volatility-plot}
#| label: volatility-plot
#| fig-cap: "Volatilnost CTI (3M rolling SD)"

ggplot(index_data[!is.na(CTI_vol_3m)], aes(x = yearmonth, y = CTI_vol_3m)) +
  geom_line(color = colors_gimes["warning"], linewidth = 1) +
  geom_point(color = colors_gimes["warning"], size = 2) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "CTI volatilnost (3M rolling SD)",
    subtitle = "Standardna devijacija CTI u kliznom prozoru od 3 mjeseca",
    x = NULL,
    y = "Volatilnost (SD)"
  )
```

```{r momentum-plot}
#| label: momentum-plot
#| fig-cap: "Momentum CTI"
#| fig-height: 8

p_mom1 <- ggplot(index_data[!is.na(CTI_mom_1m)], aes(x = yearmonth, y = CTI_mom_1m)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_col(aes(fill = CTI_mom_1m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["danger"])) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  labs(title = "CTI Momentum (1M)", x = NULL, y = "Promjena")

p_mom3 <- ggplot(index_data[!is.na(CTI_mom_3m)], aes(x = yearmonth, y = CTI_mom_3m)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_col(aes(fill = CTI_mom_3m > 0), show.legend = FALSE) +
  scale_fill_manual(values = c("TRUE" = colors_gimes["success"], "FALSE" = colors_gimes["danger"])) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  labs(title = "CTI Momentum (3M)", x = NULL, y = "Promjena")

p_mom1 / p_mom3
```

```{r standardized-indices}
#| label: standardized-indices
#| fig-cap: "Standardizirani indeksi volatilnosti i momentuma"
#| fig-height: 8

std_long <- melt(
  index_data[!is.na(CTI_vol_3m_z), .(yearmonth, CTI_vol_3m_z, CTI_mom_1m_z, CTI_mom_3m_z)],
  id.vars = "yearmonth",
  variable.name = "indeks",
  value.name = "z_score"
)

std_labels <- c(
  "CTI_vol_3m_z" = "Volatilnost (3M)",
  "CTI_mom_1m_z" = "Momentum (1M)",
  "CTI_mom_3m_z" = "Momentum (3M)"
)

std_long[, indeks_label := std_labels[as.character(indeks)]]

ggplot(std_long, aes(x = yearmonth, y = z_score, color = indeks_label)) +
  geom_hline(yintercept = 0, color = "gray50", linetype = "dashed") +
  geom_hline(yintercept = c(-2, 2), color = "gray70", linetype = "dotted") +
  geom_line(linewidth = 1) +
  facet_wrap(~indeks_label, ncol = 1) +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  scale_color_manual(values = c(
    "Volatilnost (3M)" = colors_gimes["warning"],
    "Momentum (1M)" = colors_gimes["accent"],
    "Momentum (3M)" = colors_gimes["purple"]
  )) +
  labs(
    title = "Standardizirani indeksi volatilnosti i momentuma CTI",
    subtitle = "Z-scores | Horizontalne linije na ±2 SD",
    x = NULL,
    y = "Z-score",
    color = NULL
  ) +
  theme(legend.position = "none")
```

# Koncentracija tema

## Konstrukcija mjera koncentracije

::: {.callout-note collapse="true" title="Interpretacija HHI indeksa"}

Herfindahl-Hirschman Index (HHI) mjeri koncentraciju aktivnosti među kategorijama. Niže vrijednosti HHI ukazuju na ravnomjerniju distribuciju tema, dok više vrijednosti signaliziraju dominaciju pojedinih kategorija u medijskom diskursu.

**Formula:**

$$
\text{HHI}_t = \sum_{i=1}^{n} s_{i,t}^2
$$

gdje je $s_{i,t}$ udio kategorije $i$ u ukupnom broju spominjanja u mjesecu $t$.

:::

```{r concentration-calculation}
#| label: concentration-calculation

semantic_shares <- monthly_semantic[, .(
  yearmonth,
  s_opce = count_povjerenje_opce / count_all_semantic,
  s_vlada = count_povjerenje_vlada / count_all_semantic,
  s_pravosude = count_povjerenje_pravosude / count_all_semantic,
  s_sigurnost = count_povjerenje_sigurnost / count_all_semantic,
  s_mediji = count_povjerenje_mediji / count_all_semantic,
  s_crkva = count_povjerenje_crkva / count_all_semantic,
  s_eu = count_povjerenje_eu / count_all_semantic,
  s_optimizam = count_optimizam_pesimizam / count_all_semantic,
  s_zadovoljstvo = count_zadovoljstvo_zivotom / count_all_semantic,
  s_raspolozenje = count_drustveno_raspolozenje / count_all_semantic,
  s_strah = count_strah_zabrinutost / count_all_semantic,
  s_buducnost = count_buducnost_perspektive / count_all_semantic
)]

semantic_shares[, HHI := s_opce^2 + s_vlada^2 + s_pravosude^2 + s_sigurnost^2 + 
                  s_mediji^2 + s_crkva^2 + s_eu^2 + s_optimizam^2 + 
                  s_zadovoljstvo^2 + s_raspolozenje^2 + s_strah^2 + s_buducnost^2]

semantic_shares[, n_active := rowSums(.SD > 0.01), .SDcols = patterns("^s_")]
```

```{r hhi-plot}
#| label: hhi-plot
#| fig-cap: "Herfindahl-Hirschman Index koncentracije tema"

ggplot(semantic_shares, aes(x = yearmonth, y = HHI)) +
  geom_line(color = colors_gimes["primary"], linewidth = 1) +
  geom_point(color = colors_gimes["primary"], size = 2) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "Herfindahl-Hirschman Index (HHI) koncentracije tema",
    subtitle = "Niže vrijednosti = ravnomjernija distribucija | Više vrijednosti = dominacija pojedinih tema",
    x = NULL,
    y = "HHI"
  )
```

```{r active-topics-plot}
#| label: active-topics-plot
#| fig-cap: "Broj aktivnih kategorija kroz vrijeme"

ggplot(semantic_shares, aes(x = yearmonth, y = n_active)) +
  geom_line(color = colors_gimes["accent"], linewidth = 1) +
  geom_point(color = colors_gimes["accent"], size = 2) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  scale_y_continuous(breaks = 1:12) +
  labs(
    title = "Broj aktivnih kategorija (udio > 1%)",
    subtitle = "Pokazatelj tematske širine medijskog diskursa",
    x = NULL,
    y = "Broj kategorija"
  )
```

# Korelacije između indeksa

## Korelacijska matrica indeksa

```{r correlation-matrix}
#| label: correlation-matrix
#| fig-cap: "Korelacijska matrica indeksa povjerenja i optimizma"
#| fig-height: 10

cor_vars <- c("GTI", "PTI", "JTI", "STI", "MTI", "RTI", "ETI", "OPI", "LSI", "SMI", "FWI", "FOI", "CTI")
cor_data <- index_data[, .SD, .SDcols = cor_vars]
cor_matrix <- cor(cor_data, use = "pairwise.complete.obs")

corrplot(cor_matrix,
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.8,
         addCoef.col = "black",
         number.cex = 0.6,
         col = colorRampPalette(c(colors_gimes["accent"], "white", colors_gimes["success"]))(100),
         title = "Korelacijska matrica indeksa povjerenja i optimizma",
         mar = c(0, 0, 2, 0))
```

## Korelacijska tablica

```{r correlation-table}
#| label: correlation-table

cti_correlations <- data.table(
  Indeks = cor_vars[cor_vars != "CTI"],
  Korelacija_s_CTI = sapply(cor_vars[cor_vars != "CTI"], function(x) {
    round(cor(index_data[[x]], index_data$CTI, use = "complete.obs"), 3)
  })
)[order(-Korelacija_s_CTI)]

kable(cti_correlations, 
      col.names = c("Indeks", "Korelacija s CTI"),
      caption = "Korelacije pojedinačnih indeksa s Composite Trust Index") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

# Export

```{r export-excel}
#| label: export-excel

wb <- createWorkbook()

export_indices <- index_data[, .(
  Datum = yearmonth,
  Godina = year(yearmonth),
  Mjesec = month(yearmonth),
  Broj_clanaka = volume,
  CTI = round(CTI, 2),
  CTI_MA3 = round(CTI_MA3, 2),
  GTI = round(GTI, 2),
  PTI = round(PTI, 2),
  JTI = round(JTI, 2),
  STI = round(STI, 2),
  MTI = round(MTI, 2),
  RTI = round(RTI, 2),
  ETI = round(ETI, 2),
  OPI = round(OPI, 2),
  LSI = round(LSI, 2),
  SMI = round(SMI, 2),
  FWI = round(FWI, 2),
  FOI = round(FOI, 2)
)]

addWorksheet(wb, "Indeksi")
writeData(wb, "Indeksi", export_indices)

header_style <- createStyle(
  textDecoration = "bold",
  fgFill = "#2C3E50",
  fontColour = "white",
  halign = "center"
)
addStyle(wb, "Indeksi", header_style, rows = 1, cols = 1:ncol(export_indices))
setColWidths(wb, "Indeksi", cols = 1:ncol(export_indices), widths = "auto")

semantic_export <- monthly_semantic[, .(
  Datum = yearmonth,
  Broj_clanaka = N,
  Povjerenje_opce = count_povjerenje_opce,
  Povjerenje_vlada = count_povjerenje_vlada,
  Povjerenje_pravosude = count_povjerenje_pravosude,
  Povjerenje_sigurnost = count_povjerenje_sigurnost,
  Povjerenje_mediji = count_povjerenje_mediji,
  Povjerenje_crkva = count_povjerenje_crkva,
  Povjerenje_EU = count_povjerenje_eu,
  Optimizam_pesimizam = count_optimizam_pesimizam,
  Zadovoljstvo_zivotom = count_zadovoljstvo_zivotom,
  Drustveno_raspolozenje = count_drustveno_raspolozenje,
  Strah_zabrinutost = count_strah_zabrinutost,
  Buducnost_perspektive = count_buducnost_perspektive,
  Ukupno = count_all_semantic
)]

addWorksheet(wb, "Semanticke_kategorije")
writeData(wb, "Semanticke_kategorije", semantic_export)
addStyle(wb, "Semanticke_kategorije", header_style, rows = 1, cols = 1:ncol(semantic_export))
setColWidths(wb, "Semanticke_kategorije", cols = 1:ncol(semantic_export), widths = "auto")

dynamics_export <- index_data[, .(
  Datum = yearmonth,
  CTI_original = round(CTI, 2),
  CTI_MA3 = round(CTI_MA3, 2),
  CTI_vol_3m = round(CTI_vol_3m, 2),
  CTI_mom_1m = round(CTI_mom_1m, 2),
  CTI_mom_3m = round(CTI_mom_3m, 2)
)]

addWorksheet(wb, "Dinamike")
writeData(wb, "Dinamike", dynamics_export)
addStyle(wb, "Dinamike", header_style, rows = 1, cols = 1:ncol(dynamics_export))
setColWidths(wb, "Dinamike", cols = 1:ncol(dynamics_export), widths = "auto")

cor_export <- as.data.table(cor_matrix, keep.rownames = "Indeks")

addWorksheet(wb, "Korelacije")
writeData(wb, "Korelacije", cor_export)
addStyle(wb, "Korelacije", header_style, rows = 1, cols = 1:ncol(cor_export))
setColWidths(wb, "Korelacije", cols = 1:ncol(cor_export), widths = "auto")

output_path <- here("output", "gimes_trust_indices.xlsx")
dir.create(here("output"), showWarnings = FALSE, recursive = TRUE)
saveWorkbook(wb, output_path, overwrite = TRUE)

message("Excel datoteka spremljena: ", output_path)
```

# Sažetak

```{r summary-findings}
#| label: summary-findings

peak_month <- index_data[which.max(CTI), yearmonth]
peak_value <- index_data[which.max(CTI), CTI]

all_indices <- c("GTI", "PTI", "JTI", "STI", "MTI", "RTI", "ETI", "OPI", "LSI", "SMI", "FWI", "FOI")
index_labels_full <- c(
  "GTI" = "General Trust Index",
  "PTI" = "Political Trust Index",
  "JTI" = "Judicial Trust Index",
  "STI" = "Security Trust Index",
  "MTI" = "Media Trust Index",
  "RTI" = "Religious Trust Index",
  "ETI" = "EU Trust Index",
  "OPI" = "Optimism-Pessimism Index",
  "LSI" = "Life Satisfaction Index",
  "SMI" = "Social Mood Index",
  "FWI" = "Fear-Worry Index",
  "FOI" = "Future Outlook Index"
)

category_means <- colMeans(index_data[, .SD, .SDcols = all_indices], na.rm = TRUE)
dominant_category <- names(which.max(category_means))

findings <- data.table(
  Nalaz = c(
    "Ukupno analiziranih članaka",
    "Vremenski raspon analize",
    "Broj izvora",
    "",
    "Vrh CTI indeksa",
    "Vrijednost vrha",
    "",
    "Dominantna kategorija",
    "Prosječna vrijednost",
    "",
    "Prosječni CTI",
    "Standardna devijacija CTI"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(min(dt$date), "%m/%Y"), "-", format(max(dt$date), "%m/%Y")),
    as.character(length(unique(dt$FROM))),
    "",
    format(peak_month, "%B %Y"),
    round(peak_value, 1),
    "",
    index_labels_full[dominant_category],
    round(category_means[dominant_category], 1),
    "",
    round(mean(index_data$CTI, na.rm = TRUE), 1),
    round(sd(index_data$CTI, na.rm = TRUE), 1)
  )
)

kable(findings, caption = "Sažetak ključnih nalaza analize") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  row_spec(c(4, 7, 10), background = colors_gimes["light"])
```

---

*Izvještaj generiran: `r Sys.time()`*

*GIMES Research | Analiza medijske pokrivenosti društvenog povjerenja i optimizma v2.0*
