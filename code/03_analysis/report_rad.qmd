---
title: "Semantički indeks tržišta rada"
subtitle: "Mjerenje dinamike tržišta rada kroz analizu medijskog diskursa"
author: "GIMES Research"
date: today
format:
  html:
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    theme: cosmo
    code-fold: true
    code-summary: "Prikaži kod"
    fig-width: 11
    fig-height: 7
    df-print: paged
    embed-resources: true
execute:
  warning: false
  message: false
  echo: false
lang: hr
---

```{r setup}
#| label: setup
#| include: false

library(data.table)
library(ggplot2)
library(scales)
library(lubridate)
library(stringi)
library(knitr)
library(kableExtra)
library(zoo)
library(openxlsx)
library(here)
library(corrplot)
library(patchwork)
library(viridis)

options(scipen = 999)
theme_set(theme_minimal(base_size = 12))

pal <- list(
  dark = "#1a1a2e",
  primary = "#16213e",
  accent = "#0f3460",
  highlight = "#e94560",
  warm = "#f39c12",
  cool = "#3498db",
  success = "#27ae60",
  muted = "#7f8c8d",
  light = "#ecf0f1",
  purple = "#9b59b6",
  teal = "#1abc9c"
)
```

# Uvod

U ovom dokumentu se konstruiraju semantički indeksi tržišta rada temeljeni na analizi medijskog diskursa o zapošljavanju, plaćama, radnim uvjetima i povezanim temama. Metodologija se temelji na brojanju pojmova iz unaprijed definirane semantičke taksonomije, pri čemu se za svaki članak zbrajaju pojavljivanja relevantnih pojmova, a zatim se provodi mjesečna agregacija i normalizacija.

```{r load-data}
#| label: load-data

#dt <- as.data.table(read.xlsx(here("data", "labor_filtered.xlsx")))
dt <- as.data.table(read.xlsx("C:/Users/lsikic/Desktop/labor_filtered.xlsx"))
if (is.numeric(dt$DATE)) {
  dt[, DATE := as.Date(DATE, origin = "1899-12-30")]
} else {
  dt[, DATE := as.Date(DATE)]
}

if ("text_length" %in% names(dt)) dt[, text_length := as.numeric(text_length)]
if ("REACH" %in% names(dt)) dt[, REACH := as.numeric(REACH)]

dt[, `:=`(
  date = DATE,
  year = year(DATE),
  month = month(DATE),
  quarter = quarter(DATE),
  yearmonth = floor_date(DATE, "month"),
  yearquarter = floor_date(DATE, "quarter")
)]

date_min <- min(dt$date, na.rm = TRUE)
date_max <- max(dt$date, na.rm = TRUE)

cat("Učitano", nrow(dt), "članaka\n")
cat("Vremenski raspon:", as.character(date_min), "do", as.character(date_max), "\n")
```

# Eksploratorni pregled

U ovom poglavlju se prikazuju osnovne deskriptivne statistike dataseta. Analizom se obuhvaćaju broj članaka, vremenski raspon, distribucija izvora i dinamika objavljivanja kroz vrijeme.

```{r basic-stats}
#| label: basic-stats

stats_summary <- data.table(
  Metrika = c(
    "Ukupan broj članaka",
    "Vremenski raspon",
    "Broj dana",
    "Prosječno članaka dnevno",
    "Broj izvora",
    "Medijan duljine članka"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(date_min, "%d.%m.%Y"), "do", format(date_max, "%d.%m.%Y")),
    as.character(as.numeric(date_max - date_min)),
    round(nrow(dt) / as.numeric(date_max - date_min), 2),
    length(unique(dt$FROM)),
    format(median(dt$text_length, na.rm = TRUE), big.mark = ",")
  )
)

kable(stats_summary, caption = "Osnovne statistike dataseta") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

```{r source-distribution}
#| label: source-distribution
#| fig-cap: "Top 20 izvora po broju članaka"

top_sources <- dt[, .(N = .N), by = FROM][order(-N)][1:20]

ggplot(top_sources, aes(x = reorder(FROM, N), y = N)) +
  geom_col(fill = pal$primary, alpha = 0.8) +
  geom_text(aes(label = format(N, big.mark = ",")), hjust = -0.1, size = 3) +
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  labs(title = "Top 20 izvora po broju članaka", x = NULL, y = "Broj članaka") +
  theme(plot.title = element_text(face = "bold"))
```

```{r time-distribution}
#| label: time-distribution
#| fig-cap: "Mjesečni broj članaka"
#| fig-height: 6

monthly_count <- dt[, .(N = .N), by = yearmonth][order(yearmonth)]
monthly_count[, MA3 := frollmean(N, n = 3, align = "center")]

ggplot(monthly_count, aes(x = yearmonth)) +
  geom_col(aes(y = N), fill = pal$light, alpha = 0.7) +
  geom_line(aes(y = MA3), color = pal$highlight, linewidth = 1.2, na.rm = TRUE) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "Mjesečni broj članaka o tržištu rada",
    subtitle = "Crvena linija = 3 mjesečni klizni prosjek",
    x = NULL, y = "Broj članaka"
  ) +
  theme(plot.title = element_text(face = "bold"))
```

# Semantička taksonomija tržišta rada

## Hijerarhijska struktura pojmova

Semantička taksonomija se organizira u hijerarhijsku strukturu s makro kategorijama (npr. zaposlenost, plaće) i meso kategorijama (npr. nezaposlenost, minimalna plaća). Za svaku kategoriju se definira skup regularnih izraza (regex pattern) koji obuhvaćaju relevantne pojmove i njihove morfološke varijante.

Pojmovi se definiraju pomoću korijena riječi (stem) kako bi se osigurala šira morfološka pokrivenost. Na primjer, korijen "zaposlen" će prepoznati "zaposlenost", "zaposleni", "zaposlenih", "zaposlenike" itd.

::: {.callout-note collapse="true" title="Detaljna metodologija semantičke taksonomije"}

**Princip konstrukcije taksonomije:**

1. **Makro kategorije** predstavljaju široke tematske domene tržišta rada (npr. zaposlenost, plaće, radni odnosi)
2. **Meso kategorije** predstavljaju specifičnije podteme unutar makro kategorija
3. **Regex uzorci** se koriste za fleksibilno prepoznavanje morfoloških varijanti

**Morfološka pokrivenost:**

Za hrvatski jezik koji ima bogatu morfologiju, koriste se:

- Korijenski oblici s opcionalnim nastavcima: `zaposlen[aeiou]+` prepoznaje zaposlenost, zaposleni, zaposlenih
- Alternativni oblici: `(plaća|primanje)` prepoznaje oba sinonima
- Wildcard znakovi: `.{0,10}` dopušta do 10 bilo kojih znakova između riječi

**Formula za brojanje:**

$$
\text{count}_{c,d} = \sum_{p \in P_c} \text{matches}(p, d)
$$

gdje je $P_c$ skup regex uzoraka za kategoriju $c$, a $d$ je tekst dokumenta.

:::

```{r semantic-taxonomy}
#| label: semantic-taxonomy

labor_taxonomy <- list(
  
  # === 1. ZAPOSLENOST I NEZAPOSLENOST ===
  zaposlenost = list(
    zaposlenost_opce = c(
      "zaposlenost[aeiou]?", "zaposlen[aeiou]+",
      "broj.{0,10}zaposlen", "stopa.{0,10}zaposlen",
      "razina.{0,10}zaposlen", "puna.{0,10}zaposlen"
    ),
    nezaposlenost = c(
      "nezaposlenost[aeiou]?", "nezaposlen[aeiou]+",
      "stopa.{0,10}nezaposlen", "razina.{0,10}nezaposlen",
      "evidencij[aeiou]+.{0,10}nezaposlen", "broj.{0,10}nezaposlen",
      "dugotrajn[aeiou]+.{0,10}nezaposlen"
    ),
    hzz = c(
      "\\bHZZ\\b", "Hrvatski.{0,10}zavod.{0,10}zapo[sš]ljavanje",
      "zavod.{0,10}zapo[sš]ljavanje", "burza.{0,10}rada"
    ),
    anketna = c(
      "anketn[aeiou]+.{0,10}nezaposlen", "anketn[aeiou]+.{0,10}zaposlen",
      "ILO.{0,10}metod", "me[dđ]unarod.{0,10}definicij"
    )
  ),
  
  # === 2. PLAĆE I PRIMANJA ===
  place = list(
    place_opce = c(
      "pla[cć][aeiou]?", "primanj[aeiou]?", "zarad[aeiou]?",
      "dohodak", "dohod[aeikou]+", "prihod.{0,10}rad"
    ),
    prosjecna_placa = c(
      "prosje[cč]n[aeiou]+.{0,10}pla[cć]", "srednja.{0,10}pla[cć]",
      "medijan.{0,10}pla[cć]"
    ),
    minimalna_placa = c(
      "minimaln[aeiou]+.{0,10}pla[cć]", "minimalac",
      "najni[zž][aeiou]+.{0,10}pla[cć]", "minimalna.{0,10}satnica"
    ),
    neto_bruto = c(
      "neto.{0,10}pla[cć]", "bruto.{0,10}pla[cć]",
      "neto.{0,10}primanj", "bruto.{0,10}primanj"
    ),
    rast_place = c(
      "rast.{0,10}pla[cć]", "pove[cć]anje.{0,10}pla[cć]",
      "porast.{0,10}pla[cć]", "povi[sš]ic[aeiou]?",
      "revaloriza[cč]ij", "uskla[dđ]ivanj[aeu]?.{0,10}pla[cć]"
    ),
    realna_placa = c(
      "realn[aeiou]+.{0,10}pla[cć]", "kupovn[aeiou]+.{0,10}mo[cć]",
      "inflacij[aeiou]?.{0,10}pla[cć]", "pla[cć][aeiou]?.{0,10}inflacij"
    )
  ),
  
  # === 3. ZAPOŠLJAVANJE I OTPUŠTANJE ===
  dinamika_rada = list(
    zaposljavanje = c(
      "zapo[sš]ljavanje", "zapo[sš]ljavanj[aeu]?",
      "novo.{0,10}zaposlen", "primanj[aeu]?.{0,10}radn",
      "nova.{0,10}radna.{0,10}mjesta?"
    ),
    otpustanje = c(
      "otpu[sš]tanj[aeiou]?", "otkaziv", "otkaz[aeiou]?",
      "gubitak.{0,10}posla?", "vi[sš]ak.{0,10}radn",
      "smanjivanje.{0,10}broja.{0,10}zaposlen"
    ),
    oglasi_posao = c(
      "oglas[aeiou]?.{0,10}posao", "oglas[aeiou]?.{0,10}rad",
      "natje[cč]aj.{0,10}posao", "slobodn[aeiou]+.{0,10}radn[aeiou]+.{0,10}mjest",
      "tra[zž]i.{0,10}se.{0,10}radn"
    ),
    fluktuacija = c(
      "fluktuacij[aeiou]?", "rotacij[aeiou]+.{0,10}zaposlen",
      "odljev.{0,10}kadr", "zadržavanje.{0,10}zaposlen"
    )
  ),
  
  # === 4. RADNI ODNOSI ===
  radni_odnosi = list(
    ugovor_rad = c(
      "ugovor.{0,10}rad[aeu]?", "radn[aeiou]+.{0,10}odnos",
      "neodre[dđ]en[aeiou]+.{0,10}vrijemae?", "odre[dđ]en[aeiou]+.{0,10}vrijeme"
    ),
    sindikati = c(
      "sindikat[aeiou]?", "sindikaln[aeiou]+",
      "kolektiv.{0,10}ugovor", "kolektiv.{0,10}pregovar",
      "reprezentativnost"
    ),
    strajk = c(
      "[sš]trajk[aeiou]?", "obustav[aeiou]+.{0,10}rad",
      "protest[aeiou]?.{0,10}radn", "industrijska.{0,10}akcij"
    ),
    socijalni_dijalog = c(
      "socijalni.{0,10}dijalog", "socijalni.{0,10}partner",
      "tripartit", "\\bGSV\\b", "Gospodarsk.{0,10}socijalno.{0,10}vije[cć]"
    )
  ),
  
  # === 5. UVJETI RADA ===
  uvjeti_rada = list(
    radno_vrijeme = c(
      "radn[aeiou]+.{0,10}vrijeme", "radni.{0,10}sat[aeiou]?",
      "prekovremeni?.{0,10}rad", "no[cć]ni.{0,10}rad",
      "smjenski.{0,10}rad", "fleksibiln.{0,10}rad"
    ),
    rad_od_kuce = c(
      "rad.{0,10}od.{0,10}ku[cć]e", "rad.{0,10}na.{0,10}dalj",
      "remote.{0,10}work", "home.{0,10}office",
      "hibridn[aeiou]+.{0,10}rad", "teleton"
    ),
    sigurnost_rad = c(
      "sigurnost.{0,10}rad[aeu]?", "za[sš]tit[aeiou]+.{0,10}rad[aeu]?",
      "ozljed[aeiou]+.{0,10}rad[aeu]?", "nesre[cć][aeiou]+.{0,10}rad[aeu]?"
    ),
    bolovanje = c(
      "bolovanj[aeiou]?", "privremena.{0,10}nesposobnost",
      "bolnički.{0,10}sta[zž]"
    )
  ),
  
  # === 6. DEMOGRAFIJA RADNE SNAGE ===
  demografija = list(
    radna_snaga = c(
      "radn[aeiou]+.{0,10}snag[aeiou]?", "radna.{0,10}populacija",
      "radno.{0,10}sposobn[aeiou]+", "aktivn[aeiou]+.{0,10}stanovni[sš]tv"
    ),
    migracije = c(
      "emigracij[aeiou]?", "iseljavanje", "odlazak.{0,10}mlad",
      "odljev.{0,10}mozgov", "brain.{0,10}drain"
    ),
    strani_radnici = c(
      "stran[aeiou]+.{0,10}radn[aeiou]+", "uvoz.{0,10}radn",
      "radn[aeiou]+.{0,10}dozvol", "kvota?.{0,10}stran.{0,10}radn",
      "sezonski.{0,10}radn"
    ),
    starenje = c(
      "starenj[aeiou]+.{0,10}radne.{0,10}snage",
      "starij[aeiou]+.{0,10}radn", "demografski.{0,10}izazov",
      "odr[zž]ivost.{0,10}mirovins"
    )
  ),
  
  # === 7. OBRAZOVANJE I KVALIFIKACIJE ===
  obrazovanje = list(
    kvalifikacije = c(
      "kvalifikacij[aeiou]?", "stru[cč]n[aeiou]+.{0,10}sprem",
      "obrazovn[aeiou]+.{0,10}struktur", "razin[aeiou]+.{0,10}obrazovanj"
    ),
    vjestine = c(
      "vje[sš]tin[aeiou]?", "kompetencij[aeiou]?",
      "skills?", "znanj[aeiou]?", "sposobnost[aeiou]?"
    ),
    prekvalifikacija = c(
      "prekvalifikacij[aeiou]?", "dokvalifikacij[aeiou]?",
      "cjelo[zž]ivotn[aeiou]+.{0,10}u[cč]enje", "usavr[sš]avanj"
    ),
    neuskladenost = c(
      "neuskla[dđ]enost", "skill.{0,10}gap", "skill.{0,10}mismatch",
      "manjak.{0,10}kadrova?", "nedostat[aeikou]+.{0,10}radn"
    )
  ),
  
  # === 8. SEKTORI I ZANIMANJA ===
  sektori = list(
    javni_sektor = c(
      "javn[aeiou]+.{0,10}sektor", "dr[zž]avn[aeiou]+.{0,10}slu[zž]b",
      "javn[aeiou]+.{0,10}slu[zž]b", "dr[zž]avn[aeiou]+.{0,10}slu[zž]beni"
    ),
    privatni_sektor = c(
      "privatn[aeiou]+.{0,10}sektor", "poduzetni[sš]tvo",
      "privatn[aeiou]+.{0,10}poslodav"
    ),
    deficitarna_zanimanja = c(
      "deficitarn[aeiou]+.{0,10}zanimanj", "tra[zž]en[aeiou]+.{0,10}zanimanj",
      "nedostat[aeikou]+.{0,10}kadr", "\\bIT\\b.{0,10}kadr",
      "stru[cč]njak.{0,10}nedostaj"
    ),
    turisticki_sektor = c(
      "sezonski.{0,10}radn", "turizam.{0,10}zaposlen",
      "ugostiteljstv.{0,10}radn", "sezon.{0,10}zapo[sš]ljavanje"
    )
  ),
  
  # === 9. SOCIJALNA ZAŠTITA ===
  socijalna_zastita = list(
    mirovine = c(
      "mirovin[aeiou]?", "umirovljenj[aeiou]?",
      "mirovinski.{0,10}sustav", "mirovinski.{0,10}fond",
      "mirovinski.{0,10}stup", "\\bHZMO\\b"
    ),
    naknade = c(
      "naknada.{0,10}nezaposlen", "socijalna.{0,10}pomo[cć]",
      "nov[cč]ana.{0,10}naknada", "potpora?.{0,10}nezaposlen"
    ),
    doprinosi = c(
      "doprinos[aeiou]?", "porez.{0,10}dohodak",
      "porezn[aeiou]+.{0,10}optere[cć]enje", "porezni.{0,10}klin"
    )
  ),
  
  # === 10. PRODUKTIVNOST I KONKURENTNOST ===
  produktivnost = list(
    produktivnost_rada = c(
      "produktivnost[aeiou]?", "produktivnost.{0,10}rad[aeu]?",
      "u[cč]inkovitost.{0,10}rad[aeu]?", "efik[aeiou]+snost"
    ),
    konkurentnost = c(
      "konkurentnost[aeiou]?", "konkuren[cč][aeiou]+",
      "tr[zž]i[sš]n[aeiou]+.{0,10}pozicij"
    ),
    automatizacija = c(
      "automatizacij[aeiou]?", "robotizacij[aeiou]?",
      "digitalizacij[aeiou]+.{0,10}rad", "\\bAI\\b.{0,10}rad",
      "tehnolo[sš]k[aeiou]+.{0,10}nezaposlen"
    )
  ),
  
  # === 11. RANJIVE SKUPINE ===
  ranjive_skupine = list(
    mladi = c(
      "nezaposlen.{0,10}mlad", "mlad[aeiou]+.{0,10}nezaposlen",
      "prvo.{0,10}zaposlenje", "pripravni[sš]tvo",
      "student.{0,10}rad", "\\bNEET\\b"
    ),
    zene = c(
      "[zž]en[aeiou]+.{0,10}zaposlen", "rodn[aeiou]+.{0,10}jaz",
      "gender.{0,10}gap", "majke?.{0,10}zaposlen",
      "[zž]en[aeiou]+.{0,10}tr[zž]i[sš]t[aeu]+.{0,10}rad"
    ),
    osobe_invaliditetom = c(
      "osob[aeiou]+.{0,10}invaliditet", "osob[aeiou]+.{0,10}s.{0,5}te[sš]ko[cć]",
      "zapo[sš]ljavanje.{0,10}invalid", "kvota?.{0,10}invalid"
    ),
    dugotrajno_nezaposleni = c(
      "dugotrajn[aeiou]+.{0,10}nezaposlen",
      "dulje.{0,10}od.{0,10}godin.{0,10}nezaposlen"
    )
  ),
  
  # === 12. INSTITUCIJE I POLITIKE ===
  institucije = list(
    ministarstvo = c(
      "ministarstvo.{0,10}rada?", "ministar.{0,10}rada?",
      "ministarstvo.{0,10}socijalne?"
    ),
    zakonodavstvo = c(
      "zakon.{0,10}rad[aeu]?", "radn[aeiou]+.{0,10}zakonodavstv",
      "izmjen[aeiou]+.{0,10}zakon.{0,10}rad", "ZOR"
    ),
    aktivna_politika = c(
      "aktivn[aeiou]+.{0,10}politika?.{0,10}zapo[sš]ljavanje",
      "mjer[aeiou]+.{0,10}zapo[sš]ljavanje", "poticaj.{0,10}zapo[sš]ljavanje",
      "subvencij[aeiou]+.{0,10}zapo[sš]ljavanje", "samozapo[sš]ljavanje"
    ),
    eu_fondovi = c(
      "\\bESF\\b", "Europski.{0,10}socijalni.{0,10}fond",
      "EU.{0,10}fondov.{0,10}zapo[sš]ljavanje"
    )
  )
)

flatten_taxonomy <- function(taxonomy) {
  result <- list()
  for (macro in names(taxonomy)) {
    for (meso in names(taxonomy[[macro]])) {
      key <- paste0(macro, "_", meso)
      result[[key]] <- taxonomy[[macro]][[meso]]
    }
  }
  result
}

flat_terms <- flatten_taxonomy(labor_taxonomy)

tax_summary <- rbindlist(lapply(names(labor_taxonomy), function(macro) {
  rbindlist(lapply(names(labor_taxonomy[[macro]]), function(meso) {
    data.table(
      Makro_kategorija = macro,
      Meso_kategorija = meso,
      Broj_pojmova = length(labor_taxonomy[[macro]][[meso]])
    )
  }))
}))
```

<details>
<summary>**Kliknite za prikaz kompletne tablice semantičke taksonomije**</summary>

```{r taxonomy-table}
#| label: taxonomy-table

kable(tax_summary, caption = "Struktura semantičke taksonomije tržišta rada") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

</details>

## Leksikoni sentimenta i neizvjesnosti

Za mjerenje sentimenta i neizvjesnosti na tržištu rada koriste se specijalizirani leksikoni. Leksikon sentimenta se dijeli na pozitivne i negativne pojmove specifične za tržište rada, dok leksikon neizvjesnosti obuhvaća pojmove koji signaliziraju nesigurnost zaposlenja i ekonomsku neizvjesnost. Svi pojmovi se definiraju pomoću korijena riječi (stem) kako bi se osigurala šira morfološka pokrivenost.

::: {.callout-note collapse="true" title="Detaljna metodologija leksikona"}

**Pozitivan sentiment na tržištu rada** se mjeri brojenjem pojmova koji signaliziraju poboljšanje uvjeta, rast zapošljavanja i povećanje plaća. Koriste se korijenski oblici riječi poput `rast.{0,10}zaposlen`, `nova.{0,10}radn.{0,10}mjest`, `povi[sš]ic`, `napredovanj`.

**Negativan sentiment** se mjeri brojenjem pojmova koji signaliziraju pogoršanje uvjeta, gubitak posla i ekonomske poteškoće. Koriste se korijenski oblici poput `otpu[sš]tanj`, `otkaz`, `gubitak.{0,10}posl`, `ste[cč]aj`, `emigracij`.

**Formula za neto sentiment:**

$$
\text{Sentiment}_{net} = \text{Pozitivno} - \text{Negativno}
$$

**Formula za omjer sentimenta:**

$$
\text{Sentiment}_{ratio} = \frac{\text{Pozitivno} - \text{Negativno}}{\text{Pozitivno} + \text{Negativno}}
$$

Vrijednosti omjera se kreću od -1 (potpuno negativan sentiment) do +1 (potpuno pozitivan sentiment).

**Neizvjesnost na tržištu rada** se mjeri brojenjem pojmova koji signaliziraju nesigurnost zaposlenja, mogućnost otkaza i ekonomsku nestabilnost.

:::

```{r sentiment-uncertainty-lexicons}
#| label: sentiment-uncertainty-lexicons

# Labor market sentiment leksikon (pozitivno/negativno) - STEMMED VERSION
labor_sentiment_lexicon <- list(
  positive = c(
    # Pozitivni pojmovi - korijenski oblici
    "rast.{0,10}zaposlen[aeiou]*", "nov[aeiou]+.{0,10}radn[aeiou]+.{0,10}mjest[aeiou]*", 
    "zapo[sš]ljavanj[aeiou]*", "pove[cć]anj[aeiou]+.{0,10}pla[cć]", "rast.{0,10}pla[cć]", 
    "povi[sš]ic[aeiou]*", "napredovanj[aeiou]*", "unapre[dđ]enj[aeiou]*", 
    "stabilnost[aeiou]*", "pad.{0,10}nezaposlen[aeiou]*", "smanj[aeiou]+.{0,10}nezaposlen",
    "oporavak.{0,10}tr[zž]i[sš]t[aeiou]+.{0,10}rad", "deficitarn[aeiou]+.{0,10}zanimanj",
    "tra[zž]en[aeiou]+.{0,10}kadr", "konkurentn[aeiou]+.{0,10}pla[cć]",
    "pobolj[sš]anj[aeiou]+.{0,10}uvjet", "socijalni.{0,10}dijalog", 
    "dogovor[aeiou]*", "sporazum[aeiou]*", "otvaranj[aeiou]+.{0,10}radn[aeiou]+.{0,10}mjest",
    "investicij[aeiou]*", "[sš]irenj[aeiou]+.{0,10}poslovanj", "zapo[sš]ljav[aeiou]*",
    "tra[zž]i.{0,10}radnik", "nedostaj[aeiou]+.{0,10}radnik", "produktivnost.{0,10}rast"
  ),
  negative = c(
    # Negativni pojmovi - korijenski oblici
    "pad.{0,10}zaposlen[aeiou]*", "rast.{0,10}nezaposlen[aeiou]*", "otpu[sš]tanj[aeiou]*", 
    "otkaz[aeiou]*", "gubitak.{0,10}posl[aeiou]*", "vi[sš]ak.{0,10}radn[aeiou]*", 
    "smanj[aeiou]+.{0,10}pla[cć]", "rezanj[aeiou]+.{0,10}tro[sš]k", "zatvaranj[aeiou]*", 
    "ste[cč]aj[aeiou]*", "bankrot[aeiou]*", "likvidacij[aeiou]*", "restrukturiranj[aeiou]*",
    "[sš]trajk[aeiou]*", "obustav[aeiou]+.{0,10}rad", "prosvjed[aeiou]*", 
    "nesigurnost.{0,10}zaposlenj", "prekarn[aeiou]+.{0,10}rad", "siv[aeiou]+.{0,10}ekonomij",
    "rad.{0,10}na.{0,10}crno", "nepla[cć]en[aeiou]+.{0,10}prekovrem",
    "iseljav[aeiou]*", "odljev.{0,10}mozgov", "emigracij[aeiou]*", 
    "nedostat[aeikou]+.{0,10}perspektiv", "diskriminacij[aeiou]*", "mobbing[aeiou]*", 
    "zlostavljanj[aeiou]+.{0,10}rad"
  )
)

# Labor market uncertainty leksikon - STEMMED VERSION
labor_uncertainty_lexicon <- c(
  # Neizvjesnost - korijenski oblici
  "neizvjesnost[aeiou]*", "nesigurnost[aeiou]*", "rizik[aeiou]*", "nestabilnost[aeiou]*", 
  "volatilnost[aeiou]*", "mogu[cć][aeiou]+.{0,10}otkaz", "potencijalno.{0,10}otpu[sš]t",
  "upitn[aeiou]*", "nejasn[aeiou]*", "pregovor[aeiou]*", "[sš]trajk.{0,10}u.{0,10}najav",
  "mogu[cć][aeiou]+.{0,10}[sš]trajk", "tenzij[aeiou]*", "restrukturiranj[aeiou]*",
  "reorganizacij[aeiou]*", "spajanj[aeiou]*", "akvizicij[aeiou]*",
  "automatizacij[aeiou]*", "robotizacij[aeiou]*", "zamjen[aeiou]+.{0,10}radnik",
  "sezonalnost[aeiou]*", "privremeni.{0,10}ugovor", "istje[cč][aeiou]+.{0,10}ugovor",
  "kriz[aeiou]*", "recesij[aeiou]*", "usporavanj[aeiou]*"
)

# Labor market forward looking leksikon - STEMMED VERSION
labor_forward_lexicon <- c(
  # Forward looking - korijenski oblici
  "planira.{0,10}zaposli", "namjerav[aeiou]+.{0,10}zaposli", "otvorit.{0,10}[cć]e.{0,10}radn",
  "o[cč]eku[aeiou]+.{0,10}rast", "prognoz[aeiou]+.{0,10}zaposlen", "plan.{0,10}zapo[sš]ljavanj",
  "strategij[aeiou]+.{0,10}zapo[sš]ljavanj", "budu[cć][aeiou]+.{0,10}potra[zž]nj",
  "trend[aeiou]+.{0,10}zapo[sš]ljavanj", "sljede[cć][aeiou]+.{0,10}godin",
  "idu[cć][aeiou]+.{0,10}sezon", "o[cč]ekivan[aeiou]+.{0,10}pla[cć]",
  "projekcij[aeiou]*", "scenarij[aeiou]*", "plan[aeiou]+.{0,10}[sš]irenj",
  "investicijsk[aeiou]+.{0,10}plan", "reform[aeiou]+.{0,10}tr[zž]i[sš]t[aeiou]+.{0,10}rad",
  "nov[aeiou]+.{0,10}zakon.{0,10}rad", "promjen[aeiou]+.{0,10}regulativ"
)

# Labor market intensity leksikon - STEMMED VERSION
labor_intensity_lexicon <- list(
  high = c(
    # Visoki intenzitet - korijenski oblici
    "zna[cč]ajan.{0,10}rast", "drasti[cč]n[aeiou]+.{0,10}pove[cć]anj", 
    "rekordan.{0,10}broj", "masovn[aeiou]+.{0,10}otpu[sš]tanj",
    "drasti[cč]n[aeiou]+.{0,10}smanj", "kriti[cč]an.{0,10}nedostat",
    "alarmantn[aeiou]*", "hitn[aeiou]*", "izvanredn[aeiou]*", 
    "najvi[sš][aeiou]+.{0,10}u.{0,10}povijesti", "najni[zž][aeiou]+.{0,10}ikad",
    "eksplozivan.{0,10}rast", "kolaps[aeiou]*"
  ),
  moderate = c(
    # Umjereni intenzitet - korijenski oblici
    "umjeren.{0,10}rast", "blag[aeiou]+.{0,10}porast", "postupn[aeiou]+.{0,10}pove[cć]anj",
    "stabiln[aeiou]*", "konstantn[aeiou]*", "uobi[cč]ajen[aeiou]*", "prosje[cč]n[aeiou]*",
    "u.{0,10}skladu.{0,10}s.{0,10}o[cč]ekivanj", "normaliziran[aeiou]*"
  ),
  low = c(
    # Niski intenzitet - korijenski oblici
    "minimaln[aeiou]*", "zanemariv[aeiou]*", "neznatan[aeiou]*", "marginaln[aeiou]*",
    "simboli[cč]n[aeiou]*", "tek.{0,10}neznatn[aeiou]*", "jedva.{0,10}primjet[aeiou]*"
  )
)

cat("Definirano", length(labor_sentiment_lexicon$positive), "pozitivnih i", 
    length(labor_sentiment_lexicon$negative), "negativnih labor sentiment pojmova\n")
cat("Definirano", length(labor_uncertainty_lexicon), "labor neizvjesnost pojmova\n")
cat("Definirano", length(labor_forward_lexicon), "labor forward looking pojmova\n")
```

## Brojanje pojmova

Za svaki članak se zbrajaju pojavljivanja pojmova iz svake kategorije. Brojanje se provodi korištenjem regularnih izraza (regex) koji prepoznaju morfološke varijante pojmova. Rezultati se agregiraju na razini makro kategorija zbrajanjem svih pripadajućih meso kategorija.

```{r count-terms}
#| label: count-terms

count_patterns <- function(text, patterns) {
  if (is.na(text) || text == "") return(0)
  text_lower <- tolower(text)
  sum(sapply(patterns, function(p) {
    tryCatch(stri_count_regex(text_lower, p), error = function(e) 0)
  }))
}

# Broji sve kategorije iz taksonomije
for (cat_name in names(flat_terms)) {
  col_name <- paste0("sem_", cat_name)
  dt[, (col_name) := sapply(FULL_TEXT, count_patterns, patterns = flat_terms[[cat_name]])]
}

# Agregatne mjere po makro kategorijama
macro_categories <- unique(tax_summary$Makro_kategorija)

for (macro in macro_categories) {
  meso_cats <- tax_summary[Makro_kategorija == macro, Meso_kategorija]
  col_names <- paste0("sem_", macro, "_", meso_cats)
  existing_cols <- col_names[col_names %in% names(dt)]
  if (length(existing_cols) > 0) {
    dt[, paste0("macro_", macro) := rowSums(.SD, na.rm = TRUE), .SDcols = existing_cols]
  }
}

# Sentiment scoring
dt[, sent_positive := sapply(FULL_TEXT, count_patterns, patterns = labor_sentiment_lexicon$positive)]
dt[, sent_negative := sapply(FULL_TEXT, count_patterns, patterns = labor_sentiment_lexicon$negative)]
dt[, sent_net := sent_positive - sent_negative]
dt[, sent_ratio := fifelse(sent_positive + sent_negative > 0,
                           (sent_positive - sent_negative) / (sent_positive + sent_negative), 0)]

# Uncertainty scoring
dt[, uncertainty := sapply(FULL_TEXT, count_patterns, patterns = labor_uncertainty_lexicon)]

# Forward looking scoring
dt[, forward_looking := sapply(FULL_TEXT, count_patterns, patterns = labor_forward_lexicon)]

# Intensity scoring
dt[, intensity_high := sapply(FULL_TEXT, count_patterns, patterns = labor_intensity_lexicon$high)]
dt[, intensity_low := sapply(FULL_TEXT, count_patterns, patterns = labor_intensity_lexicon$low)]
dt[, intensity_net := intensity_high - intensity_low]

# Ukupni semantički score
sem_cols <- names(dt)[grepl("^sem_", names(dt))]
dt[, semantic_total := rowSums(.SD, na.rm = TRUE), .SDcols = sem_cols]

cat("Izračunato", length(sem_cols), "semantičkih varijabli\n")
```

# Konstrukcija indeksa

## Mjesečna agregacija

Podaci se agregiraju na mjesečnoj razini kako bi se omogućila analiza vremenskih trendova. Za svaki mjesec se izračunavaju zbroji i prosjeci svih varijabli tržišta rada, te se dodaju pomoćne mjere poput broja članaka i prosječne duljine teksta.

```{r monthly-aggregation}
#| label: monthly-aggregation

macro_cols <- names(dt)[grepl("^macro_", names(dt))]
sem_cols_all <- c(sem_cols, macro_cols, "semantic_total",
                  "sent_positive", "sent_negative", "sent_net", "sent_ratio",
                  "uncertainty", "forward_looking",
                  "intensity_high", "intensity_low", "intensity_net")

monthly <- dt[, c(
  .(N = .N,
    total_words = sum(text_length, na.rm = TRUE),
    avg_length = mean(text_length, na.rm = TRUE),
    unique_sources = uniqueN(FROM)),
  lapply(.SD, sum, na.rm = TRUE),
  lapply(.SD, mean, na.rm = TRUE) |> setNames(paste0(names(.SD), "_avg"))
), by = yearmonth, .SDcols = sem_cols_all][order(yearmonth)]

# Izračunaj dodatne mjere
monthly[, articles_per_source := N / unique_sources]

cat("Agregirano", nrow(monthly), "mjeseci podataka\n")
```

## Definicija labor indeksa

U ovom poglavlju se definira dvanaest indeksa tržišta rada. Svaki indeks se konstruira na temelju specifične kombinacije varijabli i normalizira se na skalu 0-100. Normalizacija se provodi korištenjem min-max skaliranja kako bi se omogućila usporedivost indeksa kroz vrijeme.

### Pregled indeksa

```{r construct-indices}
#| label: construct-indices

normalize_01 <- function(x) {
  if (all(is.na(x))) return(rep(0.5, length(x)))
  rng <- range(x, na.rm = TRUE)
  if (rng[1] == rng[2]) return(rep(0.5, length(x)))
  (x - rng[1]) / (rng[2] - rng[1])
}

standardize <- function(x) {
  if (all(is.na(x))) return(rep(0, length(x)))
  (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE)
}

# === INDEKS 1: Labor Volume Index (LVI) ===
# Ukupni volumen medijske pokrivenosti tržišta rada
monthly[, LVI := normalize_01(semantic_total / N) * 100]

# === INDEKS 2: Employment Dynamics Index (EDI) ===
# Kombinira zaposlenost i dinamiku tržišta rada
emp_cols <- c("macro_zaposlenost", "macro_dinamika_rada")
emp_cols <- emp_cols[emp_cols %in% names(monthly)]
if (length(emp_cols) > 0) {
  monthly[, EDI := normalize_01(rowMeans(.SD / N, na.rm = TRUE)) * 100, .SDcols = emp_cols]
}

# === INDEKS 3: Wage Pressure Index (WPI) ===
# Fokusiran na plaće i primanja
if ("macro_place" %in% names(monthly)) {
  monthly[, WPI := normalize_01(macro_place / N) * 100]
}

# === INDEKS 4: Labor Market Tightness Index (LMTI) ===
# Kombinira nedostatak radnika, deficitarna zanimanja, strani radnici
tight_patterns <- c("sem_demografija_strani_radnici", "sem_sektori_deficitarna_zanimanja", 
                    "sem_obrazovanje_neuskladenost")
tight_patterns <- tight_patterns[tight_patterns %in% names(monthly)]
if (length(tight_patterns) > 0) {
  monthly[, LMTI := normalize_01(rowSums(.SD / N, na.rm = TRUE)) * 100, .SDcols = tight_patterns]
}

# === INDEKS 5: Labor Sentiment Index (LSI) ===
# Sentiment prilagođen za tržište rada
monthly[, LSI := normalize_01(semantic_total / N * (1 + sent_ratio_avg)) * 100]

# === INDEKS 6: Labor Uncertainty Index (LUI) ===
# Mjera neizvjesnosti na tržištu rada
monthly[, LUI := normalize_01(uncertainty / N) * 100]

# === INDEKS 7: Labor Forward Looking Index (LFLI) ===
# Orijentacija na budućnost
monthly[, LFLI := normalize_01(forward_looking / N) * 100]

# === INDEKS 8: Social Protection Index (SPI) ===
# Fokus na socijalnu zaštitu i mirovine
if ("macro_socijalna_zastita" %in% names(monthly)) {
  monthly[, SPI := normalize_01(macro_socijalna_zastita / N) * 100]
}

# === INDEKS 9: Labor Relations Index (LRI) ===
# Radni odnosi, sindikati, štrajkovi
if ("macro_radni_odnosi" %in% names(monthly)) {
  monthly[, LRI := normalize_01(macro_radni_odnosi / N) * 100]
}

# === INDEKS 10: Vulnerable Groups Index (VGI) ===
# Ranjive skupine na tržištu rada
if ("macro_ranjive_skupine" %in% names(monthly)) {
  monthly[, VGI := normalize_01(macro_ranjive_skupine / N) * 100]
}

# === INDEKS 11: Principal Component Index (PCI) ===
pca_data <- monthly[, .SD, .SDcols = macro_cols]
pca_data_complete <- pca_data[complete.cases(pca_data)]

if (nrow(pca_data_complete) > 10 && ncol(pca_data_complete) > 2) {
  pca_data_scaled <- scale(pca_data_complete)
  pca_result <- prcomp(pca_data_scaled, scale. = FALSE)
  
  var_explained <- summary(pca_result)$importance[2, 1:min(5, ncol(pca_result$rotation))]
  
  pca_matrix <- as.matrix(pca_data)
  pca_matrix[is.na(pca_matrix)] <- 0
  pca_matrix_scaled <- scale(pca_matrix)
  pc1_scores <- as.numeric(pca_matrix_scaled %*% pca_result$rotation[, 1])
  
  monthly[, PCI := normalize_01(pc1_scores) * 100]
  
  cat("PCA: PC1 objašnjava", round(var_explained[1] * 100, 1), "% varijance\n")
} else {
  monthly[, PCI := LVI]
}

# === INDEKS 12: Composite Labor Index (CLI) ===
# Kompozitni indeks koji kombinira ključne dimenzije
core_indices <- c("LVI", "EDI", "WPI", "LSI")
core_indices <- core_indices[core_indices %in% names(monthly)]
if (length(core_indices) > 0) {
  monthly[, CLI := rowMeans(.SD, na.rm = TRUE), .SDcols = core_indices]
}

# Klizni prosjeci
index_cols <- c("LVI", "EDI", "WPI", "LMTI", "LSI", "LUI", "LFLI", "SPI", "LRI", "VGI", "PCI", "CLI")
index_cols <- index_cols[index_cols %in% names(monthly)]

for (idx in index_cols) {
  monthly[, paste0(idx, "_MA3") := frollmean(get(idx), n = 3, align = "center")]
}

cat("Konstruirano", length(index_cols), "indeksa\n")
```

### Detaljni opis indeksa

U nastavku se pruža detaljan opis svakog od dvanaest konstruiranih indeksa. Za svaki indeks se navodi formula, interpretacija vrijednosti i praktična primjena.

```{r index-descriptions}
#| label: index-descriptions

index_desc <- data.table(
  Indeks = c("LVI", "EDI", "WPI", "LMTI", "LSI", "LUI", "LFLI", "SPI", "LRI", "VGI", "PCI", "CLI"),
  Naziv = c(
    "Labor Volume Index",
    "Employment Dynamics Index",
    "Wage Pressure Index",
    "Labor Market Tightness Index",
    "Labor Sentiment Index",
    "Labor Uncertainty Index",
    "Labor Forward Looking Index",
    "Social Protection Index",
    "Labor Relations Index",
    "Vulnerable Groups Index",
    "Principal Component Index",
    "Composite Labor Index"
  ),
  Opis = c(
    "Ukupan volumen medijske pokrivenosti tržišta rada",
    "Dinamika zapošljavanja i otpuštanja",
    "Intenzitet rasprave o plaćama i primanjima",
    "Napetost na tržištu rada (nedostatak radnika, deficitarna zanimanja)",
    "Sentiment medijskog diskursa o tržištu rada",
    "Neizvjesnost na tržištu rada",
    "Forward looking orijentacija (planovi, prognoze)",
    "Pokrivenost tema socijalne zaštite i mirovina",
    "Intenzitet rasprave o radnim odnosima i sindikatima",
    "Pokrivenost tema ranjivih skupina (mladi, žene, invalidi)",
    "Prva glavna komponenta svih dimenzija",
    "Kompozitni indeks ključnih dimenzija"
  )
)

index_desc_filtered <- index_desc[Indeks %in% index_cols]

kable(index_desc_filtered, caption = "Pregled konstruiranih labor indeksa") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

#### Labor Volume Index (LVI)

LVI mjeri ukupnu razinu medijske pozornosti usmjerene na teme tržišta rada. Indeks se izračunava kao zbroj svih pojmova tržišta rada normaliziran po broju članaka u danom mjesecu. Viša vrijednost ukazuje na intenzivnije pokrivanje tema tržišta rada u medijima.

$$
\text{LVI}_t = \text{normalize}_{0-100}\left(\frac{\sum_{c \in C} \text{count}_{c,t}}{N_t}\right)
$$

gdje je $C$ skup svih kategorija tržišta rada, $\text{count}_{c,t}$ zbroj pojmova kategorije $c$ u mjesecu $t$, a $N_t$ broj članaka u mjesecu $t$.

::: {.callout-note collapse="true" title="Tehnička metodologija LVI"}

**Normalizacija:** Koristi se min-max skaliranje na raspon 0-100:

$$
\text{normalize}(x) = \frac{x - \min(x)}{\max(x) - \min(x)} \times 100
$$

**Interpretacija vrijednosti:**

- 0-25: Niska medijska pozornost na tržište rada
- 25-50: Umjerena medijska pozornost
- 50-75: Povišena medijska pozornost
- 75-100: Visoka medijska pozornost (razdoblja reformi, kriza ili značajnih promjena)

**Prednosti i ograničenja:**

- Obuhvaća sve teme tržišta rada jednako
- Normalizacija po broju članaka kontrolira za varijacije u volumenu vijesti
- Ne razlikuje pozitivno od negativnog izvještavanja

:::

#### Employment Dynamics Index (EDI)

EDI mjeri dinamiku zapošljavanja i otpuštanja na tržištu rada. Indeks kombinira kategorije zaposlenost i dinamika_rada, obuhvaćajući pojmove vezane uz stopu zaposlenosti, nezaposlenost, nova zapošljavanja i otpuštanja.

$$
\text{EDI}_t = \text{normalize}_{0-100}\left(\frac{\text{Zaposlenost}_t + \text{Dinamika}_t}{2 \cdot N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija EDI"}

**Komponente:**

- Zaposlenost: stope zaposlenosti/nezaposlenosti, HZZ podaci
- Dinamika rada: zapošljavanje, otpuštanje, oglasi za posao, fluktuacija

**Interpretacija:**

- Visoki EDI: intenzivna rasprava o dinamici zapošljavanja
- Rastući EDI: povećana aktivnost na tržištu rada (bilo pozitivna ili negativna)
- EDI treba interpretirati zajedno s LSI za razumijevanje smjera promjena

:::

#### Wage Pressure Index (WPI)

WPI mjeri intenzitet medijske rasprave o plaćama i primanjima. Indeks se fokusira na makro kategoriju plaće koja obuhvaća prosječne plaće, minimalne plaće, neto/bruto razlike, rast plaća i realne plaće.

$$
\text{WPI}_t = \text{normalize}_{0-100}\left(\frac{\text{Plaće}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija WPI"}

**Komponente makro kategorije plaće:**

- Opći pojmovi: plaća, primanja, zarada, dohodak
- Prosječna plaća: prosjek, medijan
- Minimalna plaća: minimalac, najniža plaća
- Neto/bruto: razlike u izračunu
- Rast plaća: povišica, revalorizacija
- Realne plaće: kupovna moć, inflacija

**Primjena:**

WPI je koristan za praćenje pritiska na rast plaća, pregovora o minimalnoj plaći i rasprava o životnom standardu.

:::

#### Labor Market Tightness Index (LMTI)

LMTI mjeri napetost na tržištu rada, odnosno koliko je teško pronaći radnike. Indeks kombinira pojmove vezane uz strane radnike, deficitarna zanimanja i neusklađenost vještina. Viša vrijednost ukazuje na veći pritisak potražnje za radnicima.

$$
\text{LMTI}_t = \text{normalize}_{0-100}\left(\frac{\text{Strani radnici}_t + \text{Deficitarna}_t + \text{Neusklađenost}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija LMTI"}

**Komponente:**

- Strani radnici: uvoz radne snage, radne dozvole, kvote
- Deficitarna zanimanja: tražena zanimanja, nedostatak kadrova, IT stručnjaci
- Neusklađenost: skill gap, skill mismatch

**Interpretacija:**

- Visoki LMTI: tržište rada je napeto, poslodavci imaju poteškoća s pronalaskom radnika
- Rastući LMTI: povećanje potražnje za radnicima ili odljev radne snage
- LMTI može biti vodeći indikator pritiska na rast plaća

**Povezanost s ekonomskim ciklusom:**

LMTI tipično raste u ekspanzijskoj fazi ekonomskog ciklusa i pada tijekom recesije.

:::

#### Labor Sentiment Index (LSI)

LSI mjeri sentiment medijskog diskursa o tržištu rada. Indeks kombinira ukupni volumen s omjerom pozitivnih i negativnih pojmova, pružajući mjeru ne samo količine već i tona izvještavanja.

$$
\text{LSI}_t = \text{normalize}_{0-100}\left(\frac{\text{Volumen}_t}{N_t} \times (1 + \text{Sentiment}_{ratio,t})\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija LSI"}

**Sentiment prilagodba:**

Multiplikator $(1 + \text{Sentiment}_{ratio})$ povećava ili smanjuje indeks ovisno o tonu izvještavanja:

- Pozitivan sentiment (ratio > 0): povećava LSI
- Negativan sentiment (ratio < 0): smanjuje LSI
- Neutralan sentiment (ratio ≈ 0): bez promjene

**Referentna vrijednost:**

- LSI = 50: neutralan diskurs
- LSI > 50: dominira pozitivan sentiment o tržištu rada
- LSI < 50: dominira negativan sentiment

**Primjena:**

LSI je posebno koristan za praćenje promjena u percepciji stanja na tržištu rada tijekom ekonomskih ciklusa.

:::

#### Labor Uncertainty Index (LUI)

LUI mjeri razinu neizvjesnosti na tržištu rada. Indeks se temelji na frekvenciji pojmova koji signaliziraju nesigurnost zaposlenja, mogućnost otkaza, restrukturiranja i ekonomsku nestabilnost.

$$
\text{LUI}_t = \text{normalize}_{0-100}\left(\frac{\text{Neizvjesnost}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija LUI"}

**Kategorije neizvjesnosti:**

1. Nesigurnost zaposlenja: mogući otkazi, potencijalno otpuštanje
2. Strukturne promjene: restrukturiranje, reorganizacija, spajanja
3. Tehnološke prijetnje: automatizacija, robotizacija
4. Ekonomska neizvjesnost: kriza, recesija, usporavanje
5. Ugovorna nesigurnost: privremeni ugovori, sezonalnost

**Interpretacija:**

- Visoki LUI: povećana neizvjesnost na tržištu rada
- LUI raste prije ekonomskih kriza
- LUI može služiti kao vodeći indikator pogoršanja uvjeta na tržištu rada

:::

#### Labor Forward Looking Index (LFLI)

LFLI mjeri orijentaciju medijskog diskursa prema budućim očekivanjima na tržištu rada. Indeks obuhvaća pojmove koji signaliziraju planove zapošljavanja, prognoze i buduće trendove.

$$
\text{LFLI}_t = \text{normalize}_{0-100}\left(\frac{\text{Forward}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija LFLI"}

**Kategorije forward looking pojmova:**

1. Planovi zapošljavanja: planira zaposliti, otvorit će radna mjesta
2. Prognoze: očekuje se rast, projekcije zaposlenosti
3. Strategije: strategija zapošljavanja, investicijski planovi
4. Reforme: reforma tržišta rada, promjene u regulativi

**Primjena:**

LFLI je koristan za procjenu koliko je medijski diskurs orijentiran prema anticipaciji budućih promjena nasuprot izvještavanju o trenutnom stanju.

:::

#### Social Protection Index (SPI)

SPI mjeri intenzitet medijske pokrivenosti tema socijalne zaštite. Indeks se fokusira na mirovine, naknade za nezaposlene i doprinose.

$$
\text{SPI}_t = \text{normalize}_{0-100}\left(\frac{\text{Socijalna zaštita}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija SPI"}

**Komponente:**

- Mirovine: mirovinski sustav, HZMO, mirovinski stupovi
- Naknade: naknada za nezaposlene, socijalna pomoć
- Doprinosi: porezi na dohodak, porezni klin

**Interpretacija:**

SPI raste tijekom rasprava o mirovinskim reformama, promjenama naknada ili poreznog sustava.

:::

#### Labor Relations Index (LRI)

LRI mjeri intenzitet rasprave o radnim odnosima, sindikatima i industrijskim akcijama. Viša vrijednost ukazuje na pojačanu aktivnost socijalnog dijaloga ili industrijskih sukoba.

$$
\text{LRI}_t = \text{normalize}_{0-100}\left(\frac{\text{Radni odnosi}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija LRI"}

**Komponente:**

- Ugovori o radu: neodređeno/određeno vrijeme
- Sindikati: sindikalna aktivnost, kolektivni ugovori
- Štrajkovi: obustave rada, industrijske akcije
- Socijalni dijalog: GSV, tripartitni pregovori

**Primjena:**

LRI je koristan za praćenje ciklusa kolektivnih pregovora i industrijskih akcija.

:::

#### Vulnerable Groups Index (VGI)

VGI mjeri pokrivenost tema vezanih uz ranjive skupine na tržištu rada: mlade, žene, osobe s invaliditetom i dugotrajno nezaposlene.

$$
\text{VGI}_t = \text{normalize}_{0-100}\left(\frac{\text{Ranjive skupine}_t}{N_t}\right)
$$

::: {.callout-note collapse="true" title="Tehnička metodologija VGI"}

**Komponente:**

- Mladi: nezaposlenost mladih, pripravništvo, NEET
- Žene: rodni jaz, gender gap, zapošljavanje majki
- Osobe s invaliditetom: kvote zapošljavanja, prilagodbe
- Dugotrajno nezaposleni: programi aktivacije

**Primjena:**

VGI je koristan za praćenje fokusa javne politike na socijalno uključivanje na tržištu rada.

:::

#### Principal Component Index (PCI)

PCI se konstruira korištenjem analize glavnih komponenata (PCA) na svim makro kategorijama. Prva glavna komponenta se koristi kao sintetički indeks koji maksimalno objašnjava varijabilitet svih tema tržišta rada.

$$
\text{PCI}_t = \text{normalize}_{0-100}\left(\sum_{i=1}^{k} w_i \cdot z_{i,t}\right)
$$

gdje su $w_i$ težine iz prve glavne komponente, a $z_{i,t}$ standardizirane vrijednosti makro kategorija.

::: {.callout-note collapse="true" title="Tehnička metodologija PCI"}

**Postupak konstrukcije:**

1. Standardizacija svih makro kategorija (z-score)
2. Izračun kovarijacijske/korelacijske matrice
3. Dekompozicija na svojstvene vrijednosti i vektore
4. Odabir prve glavne komponente
5. Projekcija podataka na prvu komponentu
6. Normalizacija na skalu 0-100

**Prednosti:**

- Objektivno ponderiranje tema prema njihovom doprinosu varijabilnosti
- Reducira dimenzionalnost na jednu sintetičku mjeru
- Koristi informaciju iz svih tema

:::

#### Composite Labor Index (CLI)

CLI je kompozitni indeks koji kombinira četiri ključne dimenzije tržišta rada: volumen (LVI), dinamiku zapošljavanja (EDI), plaće (WPI) i sentiment (LSI). Indeks pruža sveobuhvatnu mjeru stanja na tržištu rada.

$$
\text{CLI}_t = \frac{\text{LVI}_t + \text{EDI}_t + \text{WPI}_t + \text{LSI}_t}{4}
$$

::: {.callout-note collapse="true" title="Tehnička metodologija CLI"}

**Komponente:**

- LVI: ukupna medijska pozornost
- EDI: dinamika zapošljavanja
- WPI: pritisak na plaće
- LSI: sentiment

**Prednosti kompozitnog pristupa:**

- Uravnoteženo obuhvaća različite aspekte tržišta rada
- Robusniji od pojedinih indeksa
- Jednostavna interpretacija kao prosječna vrijednost

:::

# Vizualizacija indeksa

## Glavni labor indeksi

Na sljedećim grafikonima se prikazuje dinamika glavnih indeksa tržišta rada kroz vrijeme. LVI i CLI prikazuju ukupnu aktivnost, EDI i WPI prikazuju dinamiku zapošljavanja i plaće, LSI prikazuje sentiment, a LUI prikazuje neizvjesnost.

```{r main-indices-plot}
#| label: main-indices-plot
#| fig-cap: "Glavni semantički indeksi tržišta rada"
#| fig-height: 12

p1 <- ggplot(monthly, aes(x = yearmonth)) +
  geom_line(aes(y = LVI, color = "LVI (Volume)"), linewidth = 1) +
  geom_line(aes(y = CLI, color = "CLI (Composite)"), linewidth = 1.2) +
  scale_color_manual(values = c("LVI (Volume)" = pal$cool, "CLI (Composite)" = pal$primary)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Volume i kompozitni indeks tržišta rada", x = NULL, y = "Indeks (0-100)", color = NULL) +
  theme(legend.position = "bottom")

p2 <- ggplot(monthly, aes(x = yearmonth)) +
  geom_line(aes(y = EDI, color = "EDI (Dynamics)"), linewidth = 1) +
  geom_line(aes(y = WPI, color = "WPI (Wages)"), linewidth = 1) +
  scale_color_manual(values = c("EDI (Dynamics)" = pal$success, "WPI (Wages)" = pal$warm)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Dinamika zapošljavanja i plaće", x = NULL, y = "Indeks (0-100)", color = NULL) +
  theme(legend.position = "bottom")

p3 <- ggplot(monthly, aes(x = yearmonth)) +
  geom_ribbon(aes(ymin = 50, ymax = LSI), fill = pal$success, alpha = 0.3) +
  geom_line(aes(y = LSI), color = pal$primary, linewidth = 1) +
  geom_hline(yintercept = 50, linetype = "dashed", color = pal$muted) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Labor Sentiment Index (LSI)", subtitle = "Iznad 50 = pozitivan sentiment prevladava",
       x = NULL, y = "Indeks (0-100)")

p4 <- ggplot(monthly, aes(x = yearmonth)) +
  geom_area(aes(y = LUI), fill = pal$highlight, alpha = 0.5) +
  geom_line(aes(y = LUI), color = pal$highlight, linewidth = 1) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Labor Uncertainty Index (LUI)", x = NULL, y = "Indeks (0-100)")

(p1 / p2) / (p3 / p4)
```

## Labor Market Tightness

LMTI prikazuje napetost na tržištu rada, odnosno intenzitet rasprave o nedostatku radnika i deficitarnim zanimanjima.

```{r tightness-plot}
#| label: tightness-plot
#| fig-cap: "Labor Market Tightness Index"
#| fig-height: 6

if ("LMTI" %in% names(monthly)) {
  ggplot(monthly, aes(x = yearmonth)) +
    geom_col(aes(y = LMTI), fill = pal$accent, alpha = 0.7) +
    geom_line(aes(y = LMTI_MA3), color = pal$highlight, linewidth = 1.2, na.rm = TRUE) +
    scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
    labs(
      title = "Labor Market Tightness Index (LMTI)",
      subtitle = "Viši = veća napetost (nedostatak radnika, deficitarna zanimanja)",
      x = NULL, y = "Indeks (0-100)"
    )
}
```

## Socijalne dimenzije

Na sljedećim grafikonima se prikazuju indeksi socijalnih dimenzija: socijalna zaštita (SPI), radni odnosi (LRI) i ranjive skupine (VGI).

```{r social-dimensions}
#| label: social-dimensions
#| fig-cap: "Socijalne dimenzije tržišta rada"
#| fig-height: 8

social_indices <- c("SPI", "LRI", "VGI")
social_indices <- social_indices[social_indices %in% names(monthly)]

if (length(social_indices) > 0) {
  social_long <- melt(
    monthly[, c("yearmonth", social_indices), with = FALSE],
    id.vars = "yearmonth",
    variable.name = "indeks",
    value.name = "vrijednost"
  )
  
  index_labels <- c(
    "SPI" = "Social Protection",
    "LRI" = "Labor Relations",
    "VGI" = "Vulnerable Groups"
  )
  social_long[, indeks_label := index_labels[as.character(indeks)]]
  
  ggplot(social_long, aes(x = yearmonth, y = vrijednost)) +
    geom_area(fill = pal$purple, alpha = 0.3) +
    geom_line(color = pal$primary, linewidth = 1) +
    geom_smooth(method = "loess", se = FALSE, color = pal$highlight, linewidth = 1, span = 0.3) +
    facet_wrap(~indeks_label, ncol = 1, scales = "free_y") +
    scale_x_date(date_breaks = "3 months", date_labels = "%b %y") +
    labs(
      title = "Socijalne dimenzije tržišta rada",
      subtitle = "S LOESS trendom",
      x = NULL, y = "Indeks (0-100)"
    ) +
    theme(strip.text = element_text(face = "bold"))
}
```

# Sektorska analiza

## Konstrukcija sektorskih indeksa

Sektorski indeksi se konstruiraju za svaku od 12 makro kategorija semantičke taksonomije. Za svaki sektor se izračunava mjesečni zbroj pojmova, koji se zatim normalizira na skalu 0-100 korištenjem min-max skaliranja unutar svakog sektora.

Sektorski indeksi omogućuju praćenje dinamike specifičnih tema tržišta rada neovisno o ostalim temama. Na primjer, sektor "plaće" može rasti dok sektor "nezaposlenost" pada, što bi signaliziralo pomak fokusa s problema nezaposlenosti na rasprave o plaćama.

::: {.callout-note collapse="true" title="Tehnička metodologija sektorskih indeksa"}

**Formula za sektorski indeks:**

$$
\text{Sektor}_{s,t} = \text{normalize}_{0-100}\left(\text{macro}_{s,t}\right)
$$

gdje je $\text{macro}_{s,t}$ zbroj svih pojmova iz makro kategorije $s$ u mjesecu $t$.

**Napomena o normalizaciji:**

Sektorski indeksi se normaliziraju **unutar svakog sektora**, što znači da vrijednosti različitih sektora nisu izravno usporedive.

**Primjena LOESS izglađivanja:**

Na grafikonima se koristi LOESS (Locally Estimated Scatterplot Smoothing) za prikaz trenda.

:::

## Dinamika sektorskih indeksa

Na sljedećim grafikonima se prikazuje dinamika 12 dimenzija tržišta rada kroz vrijeme.

```{r sector-dynamics}
#| label: sector-dynamics
#| fig-cap: "Dinamika dimenzija tržišta rada kroz vrijeme"
#| fig-height: 16

key_macro <- c("macro_zaposlenost", "macro_place", "macro_dinamika_rada",
               "macro_radni_odnosi", "macro_uvjeti_rada", "macro_demografija",
               "macro_obrazovanje", "macro_sektori", "macro_socijalna_zastita",
               "macro_produktivnost", "macro_ranjive_skupine", "macro_institucije")
key_macro <- key_macro[key_macro %in% names(monthly)]

sector_long <- melt(
  monthly[, c("yearmonth", key_macro), with = FALSE],
  id.vars = "yearmonth",
  variable.name = "dimenzija",
  value.name = "vrijednost"
)

sector_long[, dimenzija := gsub("macro_", "", dimenzija)]
sector_long[, vrijednost_norm := normalize_01(vrijednost) * 100, by = dimenzija]

ggplot(sector_long, aes(x = yearmonth, y = vrijednost_norm)) +
  geom_area(fill = pal$accent, alpha = 0.3) +
  geom_line(color = pal$primary, linewidth = 0.8) +
  geom_smooth(method = "loess", se = FALSE, color = pal$highlight, linewidth = 1, span = 0.3) +
  facet_wrap(~dimenzija, ncol = 2, scales = "free_y") +
  scale_x_date(date_breaks = "6 months", date_labels = "%b %y") +
  labs(
    title = "Dinamika semantičkih dimenzija tržišta rada",
    subtitle = "Normalizirane vrijednosti s LOESS trendom",
    x = NULL, y = "Indeks (0-100)"
  ) +
  theme(
    strip.text = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

## Heatmapa sektorske aktivnosti

Heatmapa pruža vizualni pregled intenziteta svih sektorskih indeksa kroz vrijeme na jednom grafikonu. Svaki redak predstavlja jednu dimenziju, svaki stupac predstavlja jedan mjesec, a boja ćelije predstavlja normalizirani intenzitet aktivnosti.

::: {.callout-note collapse="true" title="Tehnička metodologija heatmape"}

**Konstrukcija heatmape:**

1. Za svaki sektor se uzimaju mjesečne normalizirane vrijednosti (0-100)
2. Podaci se organiziraju u matricu (sektori × mjeseci)
3. Vrijednosti se mapiraju na kontinuiranu skalu boja (plasma paleta)

**Interpretacija:**

- Horizontalni uzorci: promjene aktivnosti jedne dimenzije kroz vrijeme
- Vertikalni uzorci: usporedba aktivnosti različitih dimenzija u istom mjesecu
- Dijagonalni uzorci: prijenos fokusa s jedne dimenzije na drugu

:::

```{r sector-heatmap}
#| label: sector-heatmap
#| fig-cap: "Heatmapa dimenzija tržišta rada"
#| fig-height: 10

heatmap_data <- sector_long[, .(yearmonth, dimenzija, vrijednost_norm)]

ggplot(heatmap_data, aes(x = yearmonth, y = dimenzija, fill = vrijednost_norm)) +
  geom_tile() +
  scale_fill_viridis_c(option = "plasma") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b %y") +
  labs(
    title = "Heatmapa dimenzija tržišta rada",
    x = NULL, y = NULL, fill = "Intenzitet\n(0-100)"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Korelacijska struktura

Korelacijska matrica prikazuje međusobne odnose između svih konstruiranih indeksa i sektorskih kategorija. Pozitivna korelacija (crvena) ukazuje na to da dva indeksa/sektora tendiraju rasti i padati zajedno, dok negativna korelacija (plava) ukazuje na obrnuti odnos.

```{r correlation-matrix}
#| label: correlation-matrix
#| fig-cap: "Korelacijska matrica dimenzija i indeksa"
#| fig-height: 12

cor_vars <- c(macro_cols, index_cols)
cor_vars <- cor_vars[cor_vars %in% names(monthly)]

cor_data <- monthly[, .SD, .SDcols = cor_vars]
cor_matrix <- cor(cor_data, use = "pairwise.complete.obs")

rownames(cor_matrix) <- gsub("macro_", "", rownames(cor_matrix))
colnames(cor_matrix) <- gsub("macro_", "", colnames(cor_matrix))

corrplot(cor_matrix,
         method = "color",
         type = "upper",
         order = "hclust",
         tl.col = "black",
         tl.srt = 45,
         tl.cex = 0.6,
         addCoef.col = "black",
         number.cex = 0.4,
         col = colorRampPalette(c(pal$cool, "white", pal$highlight))(100),
         title = "Korelacijska matrica",
         mar = c(0, 0, 2, 0))
```

# Sentiment analiza

## Konstrukcija sentiment indeksa

Sentiment analiza na tržištu rada se fokusira na razlikovanje pozitivnog i negativnog izvještavanja. Za svaki članak se broje pojmovi iz pozitivnog leksikona (rast zaposlenosti, nova radna mjesta, povišice) i negativnog leksikona (otpuštanja, otkazi, štrajkovi, emigracija).

Na temelju ovih brojeva se izračunavaju tri mjere:

1. **Neto sentiment**: razlika između pozitivnih i negativnih pojmova
2. **Omjer sentimenta**: normalizirana razlika na skalu -1 do +1
3. **LSI (Labor Sentiment Index)**: volumen prilagođen za sentiment na skalu 0-100

::: {.callout-note collapse="true" title="Tehnička metodologija sentiment analize"}

**Formule:**

$$
\text{Neto sentiment}_t = \sum_{p \in P} \text{count}_{p,t} - \sum_{n \in N} \text{count}_{n,t}
$$

gdje je $P$ skup pozitivnih pojmova, a $N$ skup negativnih pojmova.

$$
\text{Omjer sentimenta}_t = \frac{\text{Pozitivno}_t - \text{Negativno}_t}{\text{Pozitivno}_t + \text{Negativno}_t}
$$

**Intenzitet jezika:**

Dodatno se mjeri intenzitet jezika korištenjem leksikona intenziteta:

- Visoki intenzitet: "značajan rast", "masovna otpuštanja", "rekordan"
- Niski intenzitet: "minimalan", "zanemariv", "neznatan"

:::

```{r sentiment-components}
#| label: sentiment-components
#| fig-cap: "Labor sentiment komponente kroz vrijeme"
#| fig-height: 10

p_sent1 <- ggplot(monthly, aes(x = yearmonth)) +
  geom_col(aes(y = sent_positive_avg), fill = pal$success, alpha = 0.7) +
  geom_col(aes(y = -sent_negative_avg), fill = pal$highlight, alpha = 0.7) +
  geom_hline(yintercept = 0, color = "black") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Pozitivni (gore) vs Negativni (dolje) sentiment po članku",
       x = NULL, y = "Prosječan broj pojmova")

p_sent2 <- ggplot(monthly, aes(x = yearmonth, y = sent_ratio_avg)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = pal$muted) +
  geom_area(aes(fill = sent_ratio_avg > 0), alpha = 0.5) +
  geom_line(color = pal$primary, linewidth = 1) +
  scale_fill_manual(values = c("TRUE" = pal$success, "FALSE" = pal$highlight), guide = "none") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Net sentiment ratio", subtitle = "(pozitivno - negativno) / (pozitivno + negativno)",
       x = NULL, y = "Ratio (-1 do 1)")

p_sent3 <- ggplot(monthly, aes(x = yearmonth)) +
  geom_line(aes(y = intensity_high / N * 100, color = "Visoki intenzitet"), linewidth = 1) +
  geom_line(aes(y = intensity_low / N * 100, color = "Niski intenzitet"), linewidth = 1) +
  scale_color_manual(values = c("Visoki intenzitet" = pal$highlight, "Niski intenzitet" = pal$cool)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Intenzitet jezika", x = NULL, y = "Pojmova na 100 članaka", color = NULL) +
  theme(legend.position = "bottom")

p_sent1 / p_sent2 / p_sent3
```

# Volatilnost i momentum

## Konstrukcija mjera volatilnosti i momenta

Volatilnost i momentum se koriste za procjenu stabilnosti i smjera kretanja indeksa tržišta rada. Volatilnost mjeri koliko indeks varira u kratkom roku, dok momentum mjeri smjer i intenzitet promjene.

**Volatilnost** se izračunava kao standardna devijacija indeksa u kliznom prozoru od 3 mjeseca. Viša volatilnost ukazuje na nestabilnije uvjete na tržištu rada.

**Momentum** se izračunava kao razlika između trenutne vrijednosti i vrijednosti u prethodnom razdoblju.

::: {.callout-note collapse="true" title="Tehnička metodologija volatilnosti i momenta"}

**Formula za volatilnost (3M rolling SD):**

$$
\text{Vol}_{t} = \sqrt{\frac{1}{2}\sum_{i=t-2}^{t}(x_i - \bar{x}_{t-2:t})^2}
$$

**Formula za mjesečni momentum:**

$$
\text{Mom}_{1M,t} = x_t - x_{t-1}
$$

**Formula za tromjesečni momentum:**

$$
\text{Mom}_{3M,t} = x_t - x_{t-3}
$$

**Interpretacija:**

- Visoka volatilnost + pozitivan momentum: brzi rast s nestabilnošću
- Visoka volatilnost + negativan momentum: brzi pad s nestabilnošću
- Niska volatilnost + pozitivan momentum: stabilan rast
- Niska volatilnost + negativan momentum: stabilan pad

:::

```{r volatility-momentum}
#| label: volatility-momentum
#| fig-cap: "Volatilnost i momentum labor indeksa"
#| fig-height: 14

# Volatilnost
monthly[, LVI_vol := frollapply(LVI, n = 3, FUN = sd, align = "right")]
monthly[, CLI_vol := frollapply(CLI, n = 3, FUN = sd, align = "right")]
monthly[, WPI_vol := frollapply(WPI, n = 3, FUN = sd, align = "right")]

# Momentum
monthly[, LVI_mom := LVI - shift(LVI, 1)]
monthly[, CLI_mom := CLI - shift(CLI, 1)]
monthly[, LVI_mom3 := LVI - shift(LVI, 3)]

p_vol <- ggplot(monthly[!is.na(LVI_vol)], aes(x = yearmonth)) +
  geom_line(aes(y = LVI_vol, color = "LVI"), linewidth = 1) +
  geom_line(aes(y = WPI_vol, color = "WPI"), linewidth = 1) +
  scale_color_manual(values = c("LVI" = pal$cool, "WPI" = pal$warm)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Volatilnost indeksa (3M rolling SD)", x = NULL, y = "Standardna devijacija", color = NULL) +
  theme(legend.position = "bottom")

p_mom <- ggplot(monthly[!is.na(LVI_mom)], aes(x = yearmonth)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = pal$muted) +
  geom_col(aes(y = LVI_mom, fill = LVI_mom > 0), alpha = 0.7) +
  scale_fill_manual(values = c("TRUE" = pal$success, "FALSE" = pal$highlight), guide = "none") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "LVI momentum (M/M promjena)", x = NULL, y = "Promjena")

p_mom3 <- ggplot(monthly[!is.na(LVI_mom3)], aes(x = yearmonth)) +
  geom_hline(yintercept = 0, linetype = "dashed", color = pal$muted) +
  geom_area(aes(y = LVI_mom3, fill = LVI_mom3 > 0), alpha = 0.5) +
  geom_line(aes(y = LVI_mom3), color = pal$primary, linewidth = 1) +
  scale_fill_manual(values = c("TRUE" = pal$success, "FALSE" = pal$highlight), guide = "none") +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "LVI 3 mjesečni momentum", x = NULL, y = "Promjena")

p_combined <- ggplot(monthly, aes(x = yearmonth)) +
  geom_line(aes(y = scale(LVI)[,1], color = "LVI (std)"), linewidth = 1) +
  geom_line(aes(y = scale(LUI)[,1], color = "LUI (std)"), linewidth = 1) +
  geom_line(aes(y = scale(WPI)[,1], color = "WPI (std)"), linewidth = 1) +
  scale_color_manual(values = c("LVI (std)" = pal$cool, "LUI (std)" = pal$highlight, "WPI (std)" = pal$warm)) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Standardizirani indeksi", x = NULL, y = "Z-score", color = NULL) +
  theme(legend.position = "bottom")

p_vol / p_mom / p_mom3 / p_combined
```

# Koncentracija tema

## Konstrukcija mjera koncentracije

Koncentracija tema mjeri koliko je medijski diskurs fokusiran na mali broj tema nasuprot disperziji na mnogo tema. Za mjerenje koncentracije koristi se Herfindahl-Hirschman indeks (HHI).

**Visoki HHI** (bliže 1) ukazuje na fokus medija na jednu ili nekoliko dominantnih tema, što je tipično za razdoblja kriza kada jedna tema dominira (npr. masovna otpuštanja).

**Niski HHI** (bliže 0) ukazuje na disperziju pažnje na mnogo tema, što je tipično za stabilnija razdoblja.

::: {.callout-note collapse="true" title="Tehnička metodologija koncentracije tema"}

**Herfindahl-Hirschman Index (HHI):**

$$
\text{HHI}_t = \sum_{s=1}^{S} \left(\frac{x_{s,t}}{\sum_{s=1}^{S} x_{s,t}}\right)^2
$$

gdje je $x_{s,t}$ vrijednost sektora $s$ u mjesecu $t$, a $S$ broj sektora.

**Interpretacija HHI:**

- HHI = 1: potpuna koncentracija (samo jedna tema)
- HHI = 1/S: potpuna disperzija (sve teme jednako zastupljene)

**Primjena:**

- Rastući HHI: fokusiranje pažnje na dominantnu temu
- Padajući HHI: disperzija pažnje ili pojava novih tema

:::

```{r topic-concentration}
#| label: topic-concentration
#| fig-cap: "Koncentracija tema tržišta rada"
#| fig-height: 8

calc_hhi <- function(values) {
  values <- values[values > 0]
  if (length(values) == 0) return(0)
  shares <- values / sum(values)
  sum(shares^2)
}

monthly[, topic_hhi := apply(.SD, 1, calc_hhi), .SDcols = macro_cols]
monthly[, topic_count := rowSums(.SD > 0), .SDcols = macro_cols]

p_hhi <- ggplot(monthly, aes(x = yearmonth, y = topic_hhi)) +
  geom_line(color = pal$primary, linewidth = 1) +
  geom_smooth(method = "loess", se = TRUE, color = pal$highlight, span = 0.3) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(
    title = "Herfindahl indeks koncentracije tema",
    subtitle = "Viši = fokusiranije na manje tema | Niži = disperziranije",
    x = NULL, y = "HHI"
  )

p_count <- ggplot(monthly, aes(x = yearmonth, y = topic_count)) +
  geom_col(fill = pal$accent, alpha = 0.7) +
  scale_x_date(date_breaks = "3 months", date_labels = "%b\n%Y") +
  labs(title = "Broj aktivnih dimenzija po mjesecu", x = NULL, y = "Broj dimenzija s pojavljivanjem")

p_hhi / p_count
```

# Korelacije između indeksa

U sljedećoj tablici se prikazuje korelacijska matrica svih konstruiranih indeksa tržišta rada. Korelacije omogućuju razumijevanje međusobnih odnosa između različitih aspekata tržišta rada.

```{r index-correlations}
#| label: index-correlations

index_cor <- cor(monthly[, .SD, .SDcols = index_cols], use = "pairwise.complete.obs")

kable(round(index_cor, 3), caption = "Korelacijska matrica labor indeksa") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

# Export

```{r export-excel}
#| label: export-excel

wb <- createWorkbook()

# Sheet 1: Glavni indeksi
addWorksheet(wb, "Labor_Indeksi")
export_indices <- monthly[, c("yearmonth", "N", index_cols, paste0(index_cols[1:min(5, length(index_cols))], "_MA3")), with = FALSE]
names(export_indices)[1:2] <- c("Datum", "Broj_clanaka")
writeData(wb, "Labor_Indeksi", export_indices)

# Sheet 2: Dimenzije
addWorksheet(wb, "Dimenzije")
export_sectors <- monthly[, c("yearmonth", macro_cols), with = FALSE]
names(export_sectors) <- c("Datum", gsub("macro_", "", macro_cols))
writeData(wb, "Dimenzije", export_sectors)

# Sheet 3: Sentiment
addWorksheet(wb, "Sentiment")
export_sentiment <- monthly[, .(
  Datum = yearmonth,
  Pozitivan = sent_positive,
  Negativan = sent_negative,
  Net = sent_net,
  Ratio = sent_ratio_avg,
  Neizvjesnost = uncertainty,
  Forward_looking = forward_looking,
  Intenzitet_visoki = intensity_high,
  Intenzitet_niski = intensity_low
)]
writeData(wb, "Sentiment", export_sentiment)

# Sheet 4: Volatilnost
addWorksheet(wb, "Volatilnost")
export_vol <- monthly[, .(
  Datum = yearmonth,
  LVI_volatilnost = LVI_vol,
  LVI_momentum = LVI_mom,
  LVI_momentum_3M = LVI_mom3,
  Topic_HHI = topic_hhi
)]
writeData(wb, "Volatilnost", export_vol)

# Stilovi
header_style <- createStyle(
  textDecoration = "bold",
  fgFill = "#1a1a2e",
  fontColour = "white",
  halign = "center"
)

for (sheet in names(wb)) {
  ncols <- switch(sheet,
    "Labor_Indeksi" = ncol(export_indices),
    "Dimenzije" = ncol(export_sectors),
    "Sentiment" = ncol(export_sentiment),
    "Volatilnost" = ncol(export_vol)
  )
  addStyle(wb, sheet, header_style, rows = 1, cols = 1:ncols, gridExpand = TRUE)
  setColWidths(wb, sheet, cols = 1:ncols, widths = "auto")
}

output_path <- here("output", "semantic_labor_indices.xlsx")
dir.create(here("output"), showWarnings = FALSE, recursive = TRUE)
saveWorkbook(wb, output_path, overwrite = TRUE)
cat("Excel exportiran:", output_path, "\n")
```

# Sažetak

U ovoj analizi je konstruirano dvanaest indeksa tržišta rada temeljenih na semantičkoj analizi medijskog diskursa. Indeksi obuhvaćaju različite aspekte tržišta rada: ukupnu pokrivenost (LVI), dinamiku zapošljavanja (EDI), pritisak na plaće (WPI), napetost tržišta (LMTI), sentiment (LSI), neizvjesnost (LUI), prognostičku orijentaciju (LFLI), socijalnu zaštitu (SPI), radne odnose (LRI), ranjive skupine (VGI), sintetičku mjeru temeljenu na PCA (PCI) i kompozitni indeks (CLI).

```{r summary}
#| label: summary

summary_table <- data.table(
  Metrika = c(
    "Broj analiziranih članaka",
    "Vremenski raspon",
    "Broj semantičkih kategorija",
    "Broj makro dimenzija",
    "Broj konstruiranih indeksa",
    "Prosječni LVI",
    "Prosječni sentiment ratio",
    "Prosječni LUI"
  ),
  Vrijednost = c(
    format(nrow(dt), big.mark = ","),
    paste(format(date_min, "%m/%Y"), "-", format(date_max, "%m/%Y")),
    length(sem_cols),
    length(macro_cols),
    length(index_cols),
    round(mean(monthly$LVI, na.rm = TRUE), 1),
    round(mean(monthly$sent_ratio_avg, na.rm = TRUE), 3),
    round(mean(monthly$LUI, na.rm = TRUE), 1)
  )
)

kable(summary_table, caption = "Sažetak analize tržišta rada") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

---

*Izvještaj generiran: `r Sys.time()`*

*GIMES Research | Semantički indeks tržišta rada v2.0*
